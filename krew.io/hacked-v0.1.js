!function(){function s(t,e){var i=e.x-t.x,o=e.z-t.z;return Math.sqrt(i*i+o*o)}function n(t){return new THREE.Vector2(-Math.sin(t),-Math.cos(t))}function a(t,e){return i=new THREE.Vector2(e.position.x-t.position.x,e.position.z-t.position.z),(o=i.angle()+.5*Math.PI)>2*Math.PI&&(o-=2*Math.PI),2*Math.PI-o;var i,o}function t(){}function r(t,e,i){var o="",s=void 0;void 0!==tt[t]&&(o=tt[t].name,void 0!==tt[t].parent&&(s=5===tt[t].parent.netType?tt[t].parent.id:tt[t].parent.anchorIslandId)),this.createProperties(),this.supply=0,this.setShipClass(1),this.hpRegTimer=0,this.hpRegInterval=1,this.arcFront=0,this.muted=["x","z","y"],this.krewMembers={},this.krewCount=0,this.recruiting=!1,this.isLocked=!1,this.departureTime=5,this.lastMoved,this.netType=1,this.steering=0,this.shipState={starting:-1,sailing:0,docking:1,finishedDocking:2,anchored:3,departing:4},this.shipState=-1,this.overall_kills=0,this.overall_cargo=0,this.sentDockingMsg=!1,this.anchorIslandId=s,this.sinktimer=0,t&&tt[t]?(this.captainId=t,this.clan=tt[t].clan):(this.captainId="",this.clan=""),o="string"==typeof o?o:"",this.crewName="string"==typeof e?e:o+"'"+("s"===o.charAt(o.length-1)?"":"s")+" krew",this.hasDoneDeathDrops=!1,this.rottimer=5*Math.random(),this.leanvalue=0,this.setName(this.crewName)}function c(){}function h(t){this.name=void 0!==t&&t.name||"",this.createProperties(),this.position.y=0,this.netType=0,this.size=_.sizePlayer,this.walkForward=0,this.walkSideward=0,this.use=!1,this.useid=0,this.cooldown=0,this.pitch=0,this.score=50,this.salary=0,this.overall_cargo=0,this.last_island="",this.gold=(t.startingItems||{}).gold||0,this.islandBoundary={x:0,z:0},this.shipsSank=0,this.shotsFired=0,this.shotsHit=0,this.sentDockingMsg=!1,this.state={alive:0,dead:1,respawning:2},this.state=0,this.activeWeapon={nothing:-1,cannon:0,fishingRod:1,hammer:2},this.activeWeapon=0,this.justLogged=!0,this.isFishing=!1,this.checkedItemsList=!1,this.rareItemsFound=[],this.rodRotationSpeed=.25*Math.random()+.25,this.isCaptain=!1,this.oldCaptainState=!1,this.sentMessages=[],this.lastMessageSentAt=void 0,this.isSpammer=!1,this.lastMoved=new Date,this.jumping=0,this.jump_count=0,this.itemId,this.ownsCannon=!0,this.ownsFishingRod=!0,this.attackSpeedBonus=0,this.attackDamageBonus=0,this.attackDistanceBonus=0,this.movementSpeedBonus=0,this.armorBonus=0,this.level=0,this.experience=0,this.experienceBase=100,this.experienceMaxLevel=50,this.experienceNeedsUpdate=!0,this.bank={deposit:0},this.casino={},this.clan=""===t.t.cl?void 0:t.t.cl,this.clanLeader=t.t.cll,this.clanOwner=t.t.clo,this.clanRequest=t.t.cr,this.isLoggedIn=t.t.l,this.experienceNeededForLevels=function(t){for(var e={0:{amount:0,total:0},1:{amount:t.experienceBase,total:t.experienceBase}},i=1;i<t.experienceMaxLevel+1;i++)e[i+1]={},e[i+1].amount=Math.ceil(1.07*e[i].amount),e[i+1].total=e[i+1].amount+e[i].total;return e}(this),this.points={fireRate:0,distance:0,damage:0};var e=this;this.pointsFormula={getFireRate:function(){return 1.2*(50<=e.points.fireRate?50:e.points.fireRate)},getDistance:function(){return(50<=e.points.distance?50:e.points.distance)/2},getDamage:function(){return(50<=e.points.damage?50:e.points.damage)/2},getExperience:function(t){return parseInt(2.4*t)}},this.jump=0,this.jumpVel=0,ot[t.id]||(ot[t.id]=this.name),this.notifiscationHeap={},this.setName(this.name),this.crossHair()}function d(t,e,i){switch(this.createProperties(),this.netType=3,this.sendDelta=!1,this.sendSnap=!1,this.sendCreationSnapOnDelta=!0,this.impactType=t,this.size=new THREE.Vector3(1,1,1),this.timeout=1,t){case this.position.y=0:this.baseGeometry=x.impact_water,this.baseMaterial=E.impact_water;for(var o=0;o<3;++o)ve({vx:10*Math.random()-5,vy:4+2*Math.random(),vz:10*Math.random()-5,x:e,z:i,y:0,w:.3,h:.3,d:.3,gravity:5,rotaSpeed:20*Math.random(),duration:5,sizeSpeed:-.6,material:E.impact_water,geometry:k.box});break;case 1:GameAnalytics("addDesignEvent","Game:Session:Hit");for(o=0;o<5;++o)ve({vx:20*Math.random()-10,vy:5+5*Math.random(),vz:20*Math.random()-10,x:e,z:i,y:0,w:.2+.5*Math.random(),h:.2+.5*Math.random(),d:.2+.5*Math.random(),gravity:12,rotaSpeed:10*Math.random(),duration:2,sizeSpeed:-.8,material:E.splinter,geometry:k.box})}this.position.x=e,this.position.z=i}function u(t,e,i,o){this.createProperties(),this.netType=4,this.bonusValues=[50,75,100,1e4],this.pickupSize=t,this.bonus=this.bonusValues[this.pickupSize]||25,this.captainsCutRatio=.3,this.sendDelta=1!=o,this.sendSnap=1!=o,this.sendCreationSnapOnDelta=!0,this.spawnPacket=!1;var s=1;0===o&&(s=parseInt(t)+1),1===o&&(s=.05*t,GameAnalytics("addDesignEvent","Game:Session:CatchFish")),3!==o&&2!==o||(s=.02),this.size=new THREE.Vector3(s,s,s),this.modelscale=new THREE.Vector3(s,s,s),this.position.x=e,this.position.z=i,this.pickerId="",this.type=o,this.picking=1==o,this.catchingFish=!1,this.timeout=1,0===this.type&&(this.baseGeometry=x.boat,this.baseMaterial=E.crate),1===this.type&&(this.baseModel=A.fish,this.modeloffset=_.modeloffsetFishShellClam),2===this.type&&(Math.round(Math.random())?(this.baseModel=A.shell,this.modeloffset=_.modeloffsetFishShellClam):(this.baseModel=A.clam,this.modeloffset=_.modeloffsetFishShellClam,this.modelscale=new THREE.Vector3(.03,.03,.03))),3===this.type&&(this.baseModel=A.crab,this.modeloffset=_.modeloffsetCrab,this.modelrotation=new THREE.Vector3(0,Math.PI,0)),4===this.type&&(this.baseModel=A.chest),this.type<=1||4===this.type?(this.floattimer=0==this.type?5*Math.random():5*Math.random()+.5,this.rotationspeed=.5*Math.random()+.5):(this.floattimer=1,this.rotationspeed=0)}function m(t,e,i,o){this.createProperties(),this.name=o.name||"",this.netType=5,this.landmarkType=t,this.dockType=1,this.dockRadius=o.dockRadius,this.spawnPlayers=o.spawnPlayers,this.onlySellOwnShips=o.onlySellOwnShips,this.sendDelta=!1,this.sendSnap=!1,this.sendCreationSnapOnDelta=!0,this.size=new THREE.Vector3(this.dockRadius,20,this.dockRadius),this.position.x=e,this.position.z=i,this.collisionRadius=30,this.baseGeometry=x.island,this.baseMaterial=E.colorset,"Jamaica"==this.name&&(this.palm=new THREE.Mesh(x.palm,E.colorset),this.palm.position.set(850,0,850),this.palm.scale.x=8,this.palm.scale.y=8,this.palm.scale.z=8,Rt.add(this.palm));var s=this.dockRadius/10/8*9;this.modelscale.set(s,s,s),this.modeloffset.set(0,1,0),this.visualCue=new THREE.Mesh(new THREE.RingBufferGeometry(this.dockRadius-1,this.dockRadius,30),E.islandradius),this.visualCue.rotation.x=-Math.PI/2,this.visualCue.position.set(this.position.x,1,this.position.z),this.wavetimer=0,Rt.add(this.visualCue),this.setName(this.name)}function f(t){this.createProperties(),this.netType=2,this.size=_.sizeProjectile,this.sendDelta=!1,this.sendSnap=!1,this.sendCreationSnapOnDelta=!0,this.muted=["x","z"],this.shooterid="",this.shooterStartPos=new THREE.Vector3,this.reel=!1,this.impact=void 0,this.type=-1,this.airtime=0,this.spawnPacket=!1,this.setProjectileModel=!0,this.particletimer=0,this.startPoint=new THREE.Vector3(0,0,0),this.endPoint=new THREE.Vector3(0,0,0)}function g(t){for(var e,i=0,o=t.length;i<o;i++)if(!(47<(e=t.charCodeAt(i))&&e<58||64<e&&e<91||96<e&&e<123))return!1;return!0}function y(t){this.vx=t.vx,this.vy=t.vy,this.vz=t.vz,this.gravity=t.gravity,this.rotaSpeed=t.rotaSpeed,this.duration=t.duration,this.timeleft=this.duration,this.sizeSpeed=t.sizeSpeed,this.globalscale=1,this.w=t.w,this.h=t.h,this.d=t.d,this.x=t.x,this.y=t.y,this.z=t.z,this.geometry=new THREE.Mesh(t.geometry,t.material),this.geometry.position.set(t.x,t.y,t.z),this.geometry.scale.set(t.w,t.h,t.d),this.deleteMe=!1,Rt.add(this.geometry)}function q(){var t={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var i,o=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var o={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&0<e.length?e[e.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(o),o},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&1<this.materials.length)for(var i=this.materials.length-1;0<=i;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},o&&o.name&&"function"==typeof o.clone&&((i=o.clone(0)).inherited=!0,this.object.materials.push(i)),this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var i=parseInt(t,10);return 3*(0<=i?i-1:i+e/3)},parseNormalIndex:function(t,e){var i=parseInt(t,10);return 3*(0<=i?i-1:i+e/3)},parseUVIndex:function(t,e){var i=parseInt(t,10);return 2*(0<=i?i-1:i+e/2)},addVertex:function(t,e,i){var o=this.vertices,s=this.object.geometry.vertices;s.push(o[t+0],o[t+1],o[t+2]),s.push(o[e+0],o[e+1],o[e+2]),s.push(o[i+0],o[i+1],o[i+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,i){var o=this.normals,s=this.object.geometry.normals;s.push(o[t+0],o[t+1],o[t+2]),s.push(o[e+0],o[e+1],o[e+2]),s.push(o[i+0],o[i+1],o[i+2])},addUV:function(t,e,i){var o=this.uvs,s=this.object.geometry.uvs;s.push(o[t+0],o[t+1]),s.push(o[e+0],o[e+1]),s.push(o[i+0],o[i+1])},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,i,o,s,n,a,r,l){var c,h,d=this.vertices.length,p=this.parseVertexIndex(t,d),u=this.parseVertexIndex(e,d),m=this.parseVertexIndex(i,d);this.addVertex(p,u,m),void 0!==o&&(c=this.uvs.length,p=this.parseUVIndex(o,c),u=this.parseUVIndex(s,c),m=this.parseUVIndex(n,c),this.addUV(p,u,m)),void 0!==a&&(h=this.normals.length,p=this.parseNormalIndex(a,h),u=a===r?p:this.parseNormalIndex(r,h),m=a===l?p:this.parseNormalIndex(l,h),this.addNormal(p,u,m))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var i=this.vertices.length,o=this.uvs.length,s=0,n=t.length;s<n;s++)this.addVertexLine(this.parseVertexIndex(t[s],i));for(var a=0,n=e.length;a<n;a++)this.addUVLine(this.parseUVIndex(e[a],o))}};return t.startObject("",!1),t}function b(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.materials=null}var B,N,F;window.CONFIG={setProperties:{inVision:!1},Labels:{redrawInterval:250,fontFamily:"Arial, Helvetica, sans-serif",distanceMultiplier:{0:40,1:160,5:300},boats:{useMethod:"inRange"}}},window.updateInputRange=function(t){var e=t.parent().find("output"),i=t.attr("min"),o=(t.attr("max")-i)/100,s=t.val(),n=(s-i)/o;e.html(s),t.attr("style","--value:"+n),e.attr("style","left:"+n+"%; transform: translate(-"+n+"%);")},window.inputRange=function(t){t.on("input change",function(){updateInputRange(t)}),updateInputRange(t)},window,window.CanvasMap=function(t,e,i,o){var s={};return s.element=t,s.contextMode=o||"2d",s.context=s.element.getContext(s.contextMode),s.useRadians=!1,s.zoom=1,s.world={width:e,height:i,rotation:0},s.scale={width:0,height:0},s.elements={},s.randomId=function(){var t=(0|9e6*Math.random()).toString(36);return void 0!==s.elements[t]&&(t=s.randomId()),t},s.add=function(t){return t&&(t.id=t.id||s.randomId(),void 0===s.elements[t.id]&&(s.elements[t.id]=t)),s},s.remove=function(t){return t&&t.id&&s.elements[t.id]&&delete s.elements[t.id],s},s.draw=function(){var t,e=s.context.canvas.width*s.zoom,i=s.context.canvas.height*s.zoom;for(t in s.scale.width=1/s.world.width*s.context.canvas.width,s.scale.height=1/s.world.height*s.context.canvas.height,s.context.resetTransform(),s.context.clearRect(0,0,s.context.canvas.width,s.context.canvas.height),s.world.rotation&&(s.context.translate(s.context.canvas.width/2,s.context.canvas.height/2),s.context.rotate(s.useRadians?s.world.rotation:Math.PI/180*s.world.rotation),s.context.translate(-s.context.canvas.width/2,-s.context.canvas.height/2)),s.context.translate(-(e-s.context.canvas.width)/2,-(i-s.context.canvas.height)/2),s.context.scale(s.zoom,s.zoom),s.elements)s.elements[t].draw&&s.elements[t].draw();return s},s.toWorld=function(t){var e=Object.assign({},t);return t.x&&0!==t.x&&(e.x=t.x*s.scale.width),t.y&&0!==t.y&&(e.y=t.y*s.scale.height),t.r&&0!==t.r&&(e.r=t.r*s.scale.width),t.width&&0!==t.width&&(e.width=t.width*s.scale.width),t.height&&0!==t.height&&(e.height=t.height*s.scale.height),t.size&&0!==t.size&&(e.size=t.size*s.scale.width),t.rotation&&0!==t.rotation&&(e.rotation=s.useRadians?t.rotation:Math.PI/180*t.rotation),delete e.draw,delete e.id,delete e.toWorld,e},s.point=function(t){var e=Object.assign({id:void 0,x:0,y:0,r:1,fill:void 0,stroke:t.stroke?{color:t.stroke.color||"black",width:t.stroke.width||1}:void 0},t);return e.toWorld=function(){return s.toWorld(e)},e.draw=function(){var t=e.toWorld();e.fill&&(s.context.fillStyle=e.fill,s.context.beginPath(),s.context.arc(t.x,t.y,t.r,0,2*Math.PI,!0),s.context.fill()),e.stroke&&(s.context.strokeStyle=e.stroke.color,s.context.lineWidth=e.stroke.width*s.scale.width,s.context.beginPath(),s.context.arc(t.x,t.y,t.r,0,2*Math.PI,!0),s.context.stroke())},e},s.rect=function(t){var e=Object.assign({id:void 0,x:0,y:0,width:1,height:1,fill:void 0,stroke:t.stroke?{color:t.stroke.color||"black",width:t.stroke.width||1}:void 0},t);return e.toWorld=function(){return s.toWorld(e)},e.draw=function(){var t=e.toWorld();e.fill&&(s.context.fillStyle=e.fill,s.context.fillRect(t.x,t.y,t.width,t.height)),e.stroke&&(s.context.strokeStyle=e.stroke.color,s.context.lineWidth=e.stroke.width*s.scale.width,s.context.strokeRect(t.x,t.y,t.width,t.height))},e},s.triangle=function(t){var i=Object.assign({id:void 0,x:0,y:0,size:1,rotation:0,fill:void 0,stroke:t.stroke?{color:t.stroke.color||"black",width:t.stroke.width||1}:void 0},t);return i.toWorld=function(){return s.toWorld(i)},i.draw=function(){var t=i.toWorld(),e=t.size/2;s.context.save(),s.context.translate(t.x,t.y),s.context.rotate(t.rotation),s.context.translate(-t.x,-t.y),i.fill&&(s.context.fillStyle=i.fill,s.context.beginPath(),s.context.moveTo(t.x-e,t.y+e),s.context.lineTo(t.x,t.y-e),s.context.lineTo(t.x+e,t.y+e),s.context.lineTo(t.x-e,t.y+e),s.context.fill()),i.stroke&&(s.context.strokeStyle=i.stroke.color,s.context.lineWidth=i.stroke.width*s.scale.width,s.context.beginPath(),s.context.moveTo(t.x-e,t.y+e),s.context.lineTo(t.x,t.y-t.size),s.context.lineTo(t.x+e,t.y+e),s.context.lineTo(t.x-e,t.y+e),s.context.stroke()),s.context.restore()},i},s.text=function(t){var e=Object.assign({id:void 0,x:0,y:0,text:"",width:void 0,font:"serif",size:48,align:"center",baseline:"alphabetic",fill:void 0,stroke:t.stroke?{color:t.stroke.color||"black",width:t.stroke.width||1}:void 0},t);return e.toWorld=function(){return s.toWorld(e)},e.draw=function(){var t=e.toWorld();s.context.textAlign=e.align,s.context.textBaseline=e.baseline,s.context.font=t.size+"px "+e.font,e.fill&&(s.context.fillStyle=e.fill,s.context.fillText(e.text,t.x,t.y,t.width)),e.stroke&&(s.context.strokeStyle=e.stroke.color,s.context.lineWidth=e.stroke.width*s.scale.width,s.context.strokeText(e.text,t.x,t.y,t.width))},e},s},function(t,e){"use strict";function i(t){return function(){return t.test(o)}}var o=t.navigator&&e.userAgent||"",s={isChrome:i(/webkit\W.*(chrome|chromium)\W/i),isFirefox:i(/mozilla.*\Wfirefox\W/i),isGecko:i(/mozilla(?!.*webkit).*\Wgecko\W/i),isIE:function(){return"Microsoft Internet Explorer"===e.appName||!!i(/\bTrident\b/)},isKindle:i(/\W(kindle|silk)\W/i),isMobile:i(/(iphone|ipod|((?:android)?.*?mobile)|blackberry|nokia)/i),isOpera:i(/opera.*\Wpresto\W|OPR/i),isSafari:i(/webkit\W(?!.*chrome).*safari\W/i),isTablet:i(/(ipad|android(?!.*mobile)|tablet)/i),isTV:i(/googletv|sonydtv/i),isWebKit:i(/webkit\W/i),isAndroid:i(/android/i),isIOS:i(/(ipad|iphone|ipod)/i),isIPad:i(/ipad/i),isIPhone:i(/iphone/i),isIPod:i(/ipod/i),whoami:function(){return o}};"function"==typeof define&&define.amd?define([],function(){return s}):"undefined"!=typeof module&&module.exports?(module.exports=s.attach,module.exports.UA=s):t.UA=s}(window,navigator),function(){function l(t){var e,i;for(e in t)v.call(t,e)&&!1!==(i=t[e])&&(this[e]=i);this.keys=this.keys||[],this.count=this.count||0}var c,h,s,d,u,p,a,r,m,f,o,g,y,b,n,v={}.hasOwnProperty,w=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},k={is_unordered:!1,is_counting:!1,is_exclusive:!1,is_solitary:!1,prevent_default:!1,prevent_repeat:!1},x="meta alt option ctrl shift cmd".split(" "),E="ctrl",t={debug:!1};l.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&"function"==typeof this.on_keydown},l.prototype.reset=function(){return this.count=0,this.keyup_fired=null};function e(t,e){var i,o;for(i in"undefined"!=typeof jQuery&&null!==jQuery&&t instanceof jQuery&&(1!==t.length&&y("Warning: your jQuery selector should have exactly one object."),t=t[0]),this.should_force_event_defaults=this.should_suppress_event_defaults=!1,this.sequence_delay=800,this._registered_combos=[],this._keys_down=[],this._active_combos=[],this._sequence=[],this._sequence_timer=null,this._prevent_capture=!1,this._defaults=e||{},k)v.call(k,i)&&(o=k[i],this._defaults[i]=this._defaults[i]||o);this.element=t||document.body,i=function(t,e,i){return t.addEventListener?t.addEventListener(e,i):t.attachEvent&&t.attachEvent("on"+e,i),i};var s=this;this.keydown_event=i(this.element,"keydown",function(t){return t=t||window.event,s._receive_input(t,!0),s._bug_catcher(t)});var n=this;this.keyup_event=i(this.element,"keyup",function(t){return t=t||window.event,n._receive_input(t,!1)});var a=this;this.blur_event=i(window,"blur",function(){for(var t,e=a._keys_down,i=0,o=e.length;i<o;i++)t=e[i],a._key_up(t,{});return a._keys_down=[]})}e.prototype.destroy=function(){var t=function(t,e,i){return null!=t.removeEventListener?t.removeEventListener(e,i):null!=t.removeEvent?t.removeEvent("on"+e,i):void 0};return t(this.element,"keydown",this.keydown_event),t(this.element,"keyup",this.keyup_event),t(window,"blur",this.blur_event)},e.prototype._bug_catcher=function(t){var e,i;if("cmd"===E&&0<=w.call(this._keys_down,"cmd")&&"cmd"!==(e=s(null!=(i=t.keyCode)?i:t.key))&&"shift"!==e&&"alt"!==e&&"caps"!==e&&"tab"!==e)return this._receive_input(t,!1)},e.prototype._cmd_bug_check=function(t){return!("cmd"===E&&0<=w.call(this._keys_down,"cmd")&&w.call(t,"cmd")<0)},e.prototype._prevent_default=function(t,e){if((e||this.should_suppress_event_defaults)&&!this.should_force_event_defaults&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation))return t.stopPropagation()},e.prototype._get_active_combos=function(e){var i,o,s=[],t=u(this._keys_down,function(t){return t!==e});return t.push(e),this._match_combo_arrays(t,(o=this,function(t){if(o._cmd_bug_check(t.keys))return s.push(t)})),this._fuzzy_match_combo_arrays(t,(i=this,function(t){if(!(0<=w.call(s,t))&&!t.is_solitary&&i._cmd_bug_check(t.keys))return s.push(t)})),s},e.prototype._get_potential_combos=function(t){for(var e,i=[],o=this._registered_combos,s=0,n=o.length;s<n;s++)(e=o[s]).is_sequence||0<=w.call(e.keys,t)&&this._cmd_bug_check(e.keys)&&i.push(e);return i},e.prototype._add_to_active_combos=function(t){var e,i,o,s,n,a,r,l,c=!1,h=!0,d=!1;if(0<=w.call(this._active_combos,t))return!0;if(this._active_combos.length)for(o=s=0,r=this._active_combos.length;0<=r?s<r:r<s;o=0<=r?++s:--s)if((e=this._active_combos[o])&&e.is_exclusive&&t.is_exclusive){if(e=e.keys,!c)for(n=0,a=e.length;n<a;n++)if(i=e[n],c=!0,w.call(t.keys,i)<0){c=!1;break}if(h&&!c)for(n=0,a=(l=t.keys).length;n<a;n++)if(i=l[n],h=!1,w.call(e,i)<0){h=!0;break}c&&(d?null!=(e=this._active_combos.splice(o,1)[0])&&e.reset():(null!=(e=this._active_combos.splice(o,1,t)[0])&&e.reset(),d=!0),h=!1)}return h&&this._active_combos.unshift(t),c||h},e.prototype._remove_from_active_combos=function(t){for(var e,i=e=0,o=this._active_combos.length;0<=o?e<o:o<e;i=0<=o?++e:--e)if(this._active_combos[i]===t){(t=this._active_combos.splice(i,1)[0]).reset();break}},e.prototype._get_possible_sequences=function(){for(var t,e,i,o,s,n,a,r,l=[],c=this._registered_combos,h=0,d=c.length;h<d;h++)for(t=c[h],e=s=1,a=this._sequence.length;1<=a?s<=a:a<=s;e=1<=a?++s:--s)if(o=this._sequence.slice(-e),t.is_sequence){if(w.call(t.keys,"shift")<0&&!(o=u(o,function(t){return"shift"!==t})).length)continue;for(e=n=0,r=o.length;0<=r?n<r:r<n;e=0<=r?++n:--n){if(t.keys[e]!==o[e]){i=!1;break}i=!0}i&&l.push(t)}return l},e.prototype._add_key_to_sequence=function(t,e){var i,o,s,n;if(this._sequence.push(t),(o=this._get_possible_sequences()).length){for(s=0,n=o.length;s<n;s++)i=o[s],this._prevent_default(e,i.prevent_default);this._sequence_timer&&clearTimeout(this._sequence_timer),-1<this.sequence_delay&&(this._sequence_timer=setTimeout(function(){return this._sequence=[]},this.sequence_delay))}else this._sequence=[]},e.prototype._get_sequence=function(t){for(var e,i,o,s,n,a,r,l,c,h=this._registered_combos,d=0,p=h.length;d<p;d++)if((e=h[d]).is_sequence){for(i=a=1,l=this._sequence.length;1<=l?a<=l:l<=a;i=1<=l?++a:--a)if(n=u(this._sequence,function(t){return 0<=w.call(e.keys,"shift")||"shift"!==t}).slice(-i),e.keys.length===n.length)for(i=r=0,c=n.length;0<=c?r<c:c<r;i=0<=c?++r:--r)if(s=n[i],!(w.call(e.keys,"shift")<0&&"shift"===s||"shift"===t&&w.call(e.keys,"shift")<0)){if(e.keys[i]!==s){o=!1;break}o=!0}if(o)return e.is_exclusive&&(this._sequence=[]),e}return!1},e.prototype._receive_input=function(t,e){var i,o;if(this._prevent_capture)this._keys_down.length&&(this._keys_down=[]);else if(i=s(null!=(o=t.keyCode)?o:t.key),(e||this._keys_down.length||"alt"!==i&&i!==E)&&i)return e?this._key_down(i,t):this._key_up(i,t)},e.prototype._fire=function(t,e,i,o){if("function"==typeof e["on_"+t]&&this._prevent_default(i,!0!==e["on_"+t].call(e.this,i,e.count,o)),"release"===t&&(e.count=0),"keyup"===t)return e.keyup_fired=!0},e.prototype._match_combo_arrays=function(t,e){for(var i,o=this._registered_combos,s=0,n=o.length;s<n;s++)(!(i=o[s]).is_unordered&&h(t,i.keys)||i.is_unordered&&c(t,i.keys))&&e(i)},e.prototype._fuzzy_match_combo_arrays=function(t,e){for(var i,o=this._registered_combos,s=0,n=o.length;s<n;s++)(!(i=o[s]).is_unordered&&r(i.keys,t)||i.is_unordered&&a(i.keys,t))&&e(i)},e.prototype._keys_remain=function(t){for(var e,i=t.keys,o=0,s=i.length;o<s;o++)if(t=i[o],0<=w.call(this._keys_down,t)){e=!0;break}return e},e.prototype._key_down=function(t,e){var i,o,s,n,a;for(s in(i=d(t,e))&&(t=i),this._add_key_to_sequence(t,e),(i=this._get_sequence(t))&&this._fire("keydown",i,e),b)e[i=b[s]]&&(s===t||0<=w.call(this._keys_down,s)||this._keys_down.push(s));for(s in b)if(i=b[s],s!==t&&0<=w.call(this._keys_down,s)&&!e[i]&&("cmd"!==s||"cmd"===E))for(i=o=0,n=this._keys_down.length;0<=n?o<n:n<o;i=0<=n?++o:--o)this._keys_down[i]===s&&this._keys_down.splice(i,1);for(o=this._get_active_combos(t),s=this._get_potential_combos(t),n=0,a=o.length;n<a;n++)i=o[n],this._handle_combo_down(i,s,t,e);if(s.length)for(o=0,n=s.length;o<n;o++)i=s[o],this._prevent_default(e,i.prevent_default);w.call(this._keys_down,t)<0&&this._keys_down.push(t)},e.prototype._handle_combo_down=function(t,e,i,o){var s,n,a,r,l;if(w.call(t.keys,i)<0)return!1;if(this._prevent_default(o,t&&t.prevent_default),s=!1,0<=w.call(this._keys_down,i)&&(s=!0,!t.allows_key_repeat()))return!1;if(a=this._add_to_active_combos(t,i),i=t.keyup_fired=!1,t.is_exclusive)for(r=0,l=e.length;r<l;r++)if((n=e[r]).is_exclusive&&n.keys.length>t.keys.length){i=!0;break}return!i&&(t.is_counting&&"function"==typeof t.on_keydown&&(t.count+=1),a)?this._fire("keydown",t,o,s):void 0},e.prototype._key_up=function(t,e){var i,o,s,n,a,r=t;if((o=d(t,e))&&(t=o),o=g[r],e.shiftKey?o&&0<=w.call(this._keys_down,o)||(t=r):r&&0<=w.call(this._keys_down,r)||(t=o),(s=this._get_sequence(t))&&this._fire("keyup",s,e),w.call(this._keys_down,t)<0)return!1;for(s=n=0,a=this._keys_down.length;0<=a?n<a:a<n;s=0<=a?++n:--n)if((i=this._keys_down[s])===t||i===o||i===r){this._keys_down.splice(s,1);break}for(i=this._active_combos.length,o=[],s=0,n=(a=this._active_combos).length;s<n;s++)r=a[s],0<=w.call(r.keys,t)&&o.push(r);for(s=0,n=o.length;s<n;s++)r=o[s],this._handle_combo_up(r,e,t);if(1<i)for(i=0,s=(n=this._active_combos).length;i<s;i++)void 0===(r=n[i])||0<=w.call(o,r)||this._keys_remain(r)||this._remove_from_active_combos(r)},e.prototype._handle_combo_up=function(t,e,i){var o,s;this._prevent_default(e,t&&t.prevent_default),s=this._keys_remain(t),t.keyup_fired||((o=this._keys_down.slice()).push(i),t.is_solitary&&!c(o,t.keys))||(this._fire("keyup",t,e),t.is_counting&&"function"==typeof t.on_keyup&&"function"!=typeof t.on_keydown&&(t.count+=1)),s||(this._fire("release",t,e),this._remove_from_active_combos(t))},e.prototype.simple_combo=function(t,e){return this.register_combo({keys:t,on_keydown:e})},e.prototype.counting_combo=function(t,e){return this.register_combo({keys:t,is_counting:!0,is_unordered:!1,on_keydown:e})},e.prototype.sequence_combo=function(t,e){return this.register_combo({keys:t,on_keydown:e,is_sequence:!0,is_exclusive:!0})},e.prototype.register_combo=function(t){var e,i,o;for(e in"string"==typeof t.keys&&(t.keys=t.keys.split(" ")),o=this._defaults)v.call(o,e)&&(i=o[e],void 0===t[e]&&(t[e]=i));if(t=new l(t),n(t))return this._registered_combos.push(t),t},e.prototype.register_many=function(t){for(var e,i=[],o=0,s=t.length;o<s;o++)e=t[o],i.push(this.register_combo(e));return i},e.prototype.unregister_combo=function(t){var e,i,o,s,n;if(!t)return!1;var a=this,r=function(t){for(var e,i=[],o=e=0,s=a._registered_combos.length;0<=s?e<s:s<e;o=0<=s?++e:--e){if(t===a._registered_combos[o]){a._registered_combos.splice(o,1);break}i.push(void 0)}return i};if(t instanceof l)return r(t);for("string"==typeof t&&(t=t.split(" ")),n=[],i=0,o=(s=this._registered_combos).length;i<o;i++)null!=(e=s[i])&&(e.is_unordered&&c(t,e.keys)||!e.is_unordered&&h(t,e.keys)?n.push(r(e)):n.push(void 0));return n},e.prototype.unregister_many=function(t){for(var e,i=[],o=0,s=t.length;o<s;o++)e=t[o],i.push(this.unregister_combo(e));return i},e.prototype.get_registered_combos=function(){return this._registered_combos},e.prototype.reset=function(){return this._registered_combos=[]},e.prototype.listen=function(){return this._prevent_capture=!1},e.prototype.stop_listening=function(){return this._prevent_capture=!0},e.prototype.get_meta_key=function(){return E},t.Listener=e,s=function(t){return o[t]},u=function(t,e){var i,o,s,n;if(t.filter)return t.filter(e);for(n=[],o=0,s=t.length;o<s;o++)e(i=t[o])&&n.push(i);return n},c=function(t,e){var i,o,s;if(t.length!==e.length)return!1;for(o=0,s=t.length;o<s;o++)if(i=t[o],!(0<=w.call(e,i)))return!1;return!0},h=function(t,e){var i,o,s;if(t.length!==e.length)return!1;for(i=o=0,s=t.length;0<=s?o<s:s<o;i=0<=s?++o:--o)if(t[i]!==e[i])return!1;return!0},a=function(t,e){for(var i,o=0,s=t.length;o<s;o++)if(i=t[o],w.call(e,i)<0)return!1;return!0},p=Array.prototype.indexOf||function(t,e){for(var i,o=i=0,s=t.length;0<=s?i<=s:s<=i;o=0<=s?++i:--i)if(t[o]===e)return o;return-1},r=function(t,e){for(var i,o,s=o=0,n=t.length;s<n;s++){if(i=t[s],!((i=p.call(e,i))>=o))return!1;o=i}return!0},y=function(){if(t.debug)return console.log.apply(console,arguments)},m=function(t){var e,i=!1;for(e in o)if(t===o[e]){i=!0;break}if(!i)for(e in g)if(t===g[e]){i=!0;break}return i},n=function(t){var e,i,o,s,n,a,r=!0;for(t.keys.length||y("You're trying to bind a combo with no keys:",t),i=n=0,a=t.keys.length;0<=a?n<a:a<n;i=0<=a?++n:--n)o=t.keys[i],(e=f[o])&&(o=t.keys[i]=e),"meta"===o&&t.keys.splice(i,1,E),"cmd"===o&&y('Warning: use the "meta" key rather than "cmd" for Windows compatibility');for(e=0,n=(a=t.keys).length;e<n;e++)o=a[e],m(o)||(y('Do not recognize the key "'+o+'"'),r=!1);if(0<=w.call(t.keys,"meta")||0<=w.call(t.keys,"cmd")){for(e=t.keys.slice(),n=0,a=x.length;n<a;n++)o=x[n],-1<(i=p.call(e,o))&&e.splice(i,1);1<e.length&&(y("META and CMD key combos cannot have more than 1 non-modifier keys",t,e),r=!1)}for(s in t)"undefined"===k[s]&&y("The property "+s+" is not a valid combo property. Your combo has still been registered.");return r},d=function(t,e){var i;return!!e.shiftKey&&null!=(i=g[t])&&i},b={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"},f={escape:"esc",control:"ctrl",command:"cmd",break:"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"},g={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"},o={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},t._keycode_dictionary=o,t._is_array_in_array_sorted=r,-1!==navigator.userAgent.indexOf("Mac OS X")&&(E="cmd"),-1!==navigator.userAgent.indexOf("Opera")&&(o[17]="cmd"),"function"==typeof define&&define.amd?define([],function(){return t}):"undefined"!=typeof exports&&null!==exports?exports.keypress=t:window.keypress=t}.call(this),THREE.OBJLoader=(B=/^[og]\s*(.+)?/,N=/^mtllib /,F=/^usemtl /,b.prototype={constructor:b,load:function(t,e,i,o){var s=this,n=new THREE.FileLoader(s.manager);n.setPath(this.path),n.load(t,function(t){e(s.parse(t))},i,o)},setPath:function(t){this.path=t},setMaterials:function(t){return this.materials=t,this},parse:function(t){console.time("OBJLoader");var e=new q;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));for(var i,o=t.split("\n"),s="",n="",a=[],r="function"==typeof"".trimLeft,l=0,c=o.length;l<c;l++)if(s=o[l],0!==(s=r?s.trimLeft():s.trim()).length&&"#"!==(n=s.charAt(0)))if("v"===n){var h=s.split(/\s+/);switch(h[0]){case"v":e.vertices.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));break;case"vn":e.normals.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));break;case"vt":e.uvs.push(parseFloat(h[1]),parseFloat(h[2]))}}else if("f"===n){for(var d=s.substr(1).trim().split(/\s+/),p=[],u=0,m=d.length;u<m;u++){var f,g=d[u];0<g.length&&(f=g.split("/"),p.push(f))}for(var y=p[0],u=1,m=p.length-1;u<m;u++){var b=p[u],v=p[u+1];e.addFace(y[0],b[0],v[0],y[1],b[1],v[1],y[2],b[2],v[2])}}else if("l"===n){var w=s.substring(1).trim().split(" "),k=[],x=[];if(-1===s.indexOf("/"))k=w;else for(var E=0,$=w.length;E<$;E++){var C=w[E].split("/");""!==C[0]&&k.push(C[0]),""!==C[1]&&x.push(C[1])}e.addLineGeometry(k,x)}else if(null!==(a=B.exec(s))){var _=(" "+a[0].substr(1).trim()).substr(1);e.startObject(_)}else if(F.test(s))e.object.startMaterial(s.substring(7).trim(),e.materialLibraries);else if(N.test(s))e.materialLibraries.push(s.substring(7).trim());else{if("s"!==n){if("\0"===s)continue;throw new Error("Unexpected line: '"+s+"'")}1<(a=s.split(" ")).length?(i=a[1].trim().toLowerCase(),e.object.smooth="0"!==i&&"off"!==i):e.object.smooth=!0,(j=e.object.currentMaterial())&&(j.smooth=e.object.smooth)}e.finalize();var T=new THREE.Group;for(T.materialLibraries=[].concat(e.materialLibraries),l=0,c=e.objects.length;l<c;l++){var S=e.objects[l],M=S.geometry,R=S.materials,I="Line"===M.type;if(0!==M.vertices.length){var L=new THREE.BufferGeometry;L.addAttribute("position",new THREE.BufferAttribute(new Float32Array(M.vertices),3)),0<M.normals.length?L.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(M.normals),3)):L.computeVertexNormals(),0<M.uvs.length&&L.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(M.uvs),2));for(var P,H=[],A=0,O=R.length;A<O;A++){var z,D=R[A],j=void 0;null===this.materials||(j=this.materials.create(D.name),!I||!j||j instanceof THREE.LineBasicMaterial)||((z=new THREE.LineBasicMaterial).copy(j),j=z),j||((j=I?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=D.name),j.flatShading=!D.smooth,H.push(j)}if(1<H.length){for(A=0,O=R.length;A<O;A++)D=R[A],L.addGroup(D.groupStart,D.groupCount,A);P=I?new THREE.LineSegments(L,H):new THREE.Mesh(L,H)}else P=I?new THREE.LineSegments(L,H[0]):new THREE.Mesh(L,H[0]);P.name=S.name,T.add(P)}}return console.timeEnd("OBJLoader"),T}},b),THREE.TGALoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.TGALoader.prototype={constructor:THREE.TGALoader,load:function(t,e,i,o){var s=this,n=new THREE.Texture,a=new THREE.FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){n.image=s.parse(t),n.needsUpdate=!0,void 0!==e&&e(n)},i,o),n},parse:function(t){t.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var e=new Uint8Array(t),i=0,f={id_length:e[i++],colormap_type:e[i++],image_type:e[i++],colormap_index:e[i++]|e[i++]<<8,colormap_length:e[i++]|e[i++]<<8,colormap_size:e[i++],origin:[e[i++]|e[i++]<<8,e[i++]|e[i++]<<8],width:e[i++]|e[i++]<<8,height:e[i++]|e[i++]<<8,pixel_size:e[i++],flags:e[i++]};!function(t){switch(t.image_type){case 1:case 9:(256<t.colormap_length||24!==t.colormap_size||1!==t.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:t.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',t.image_type)}(t.width<=0||t.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',t.pixel_size)}(f),f.id_length+i>t.length&&console.error("THREE.TGALoader: No data."),i+=f.id_length;var o=!1,s=!1,d=!1;switch(f.image_type){case 9:s=o=!0;break;case 1:s=!0;break;case 10:o=!0;break;case 2:break;case 11:d=o=!0;break;case 3:d=!0}var n=document.createElement("canvas");n.width=f.width,n.height=f.height;var a=n.getContext("2d"),r=a.createImageData(f.width,f.height),l=function(t,e,i,o,s){var n,a,r=i.pixel_size>>3,l=i.width*i.height*r;if(e&&(a=s.subarray(o,o+=i.colormap_length*(i.colormap_size>>3))),t){n=new Uint8Array(l);for(var c,h,d,p=0,u=new Uint8Array(r);p<l;)if(h=1+(127&(c=s[o++])),128&c){for(d=0;d<r;++d)u[d]=s[o++];for(d=0;d<h;++d)n.set(u,p+d*r);p+=r*h}else{for(h*=r,d=0;d<h;++d)n[p+d]=s[o++];p+=h}}else n=s.subarray(o,o+=e?i.width*i.height:l);return{pixel_data:n,palettes:a}}(o,s,f,i,e);return function(t,e,i,o,s){var n,a,r,l,c,h;switch((48&f.flags)>>4){default:case 2:c=e,a=n=0,l=r=1,h=i;break;case 0:n=0,c=e,a=i-(r=1),h=l=-1;break;case 3:n=e-1,c=r=-1,a=0,l=1,h=i;break;case 1:n=e-1,a=i-1,h=l=c=r=-1}if(d)switch(f.pixel_size){case 8:!function(t,e,i,o,s,n,a,r){for(var l,c,h=0,d=f.width,p=e;p!==o;p+=i)for(c=s;c!==a;c+=n,h++)l=r[h],t[4*(c+d*p)+0]=l,t[4*(c+d*p)+1]=l,t[4*(c+d*p)+2]=l,t[4*(c+d*p)+3]=255}(t,a,l,h,n,r,c,o);break;case 16:!function(t,e,i,o,s,n,a,r){for(var l,c=0,h=f.width,d=e;d!==o;d+=i)for(l=s;l!==a;l+=n,c+=2)t[4*(l+h*d)+0]=r[c+0],t[4*(l+h*d)+1]=r[c+0],t[4*(l+h*d)+2]=r[c+0],t[4*(l+h*d)+3]=r[c+1]}(t,a,l,h,n,r,c,o);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(f.pixel_size){case 8:!function(t,e,i,o,s,n,a,r,l){for(var c,h,d=l,p=0,u=f.width,m=e;m!==o;m+=i)for(h=s;h!==a;h+=n,p++)c=r[p],t[4*(h+u*m)+3]=255,t[4*(h+u*m)+2]=d[3*c+0],t[4*(h+u*m)+1]=d[3*c+1],t[4*(h+u*m)+0]=d[3*c+2]}(t,a,l,h,n,r,c,o,s);break;case 16:!function(t,e,i,o,s,n,a,r){for(var l,c,h=0,d=f.width,p=e;p!==o;p+=i)for(c=s;c!==a;c+=n,h+=2)l=r[h+0]+(r[h+1]<<8),t[4*(c+d*p)+0]=(31744&l)>>7,t[4*(c+d*p)+1]=(992&l)>>2,t[4*(c+d*p)+2]=(31&l)>>3,t[4*(c+d*p)+3]=32768&l?0:255}(t,a,l,h,n,r,c,o);break;case 24:!function(t,e,i,o,s,n,a,r){for(var l,c=0,h=f.width,d=e;d!==o;d+=i)for(l=s;l!==a;l+=n,c+=3)t[4*(l+h*d)+3]=255,t[4*(l+h*d)+2]=r[c+0],t[4*(l+h*d)+1]=r[c+1],t[4*(l+h*d)+0]=r[c+2]}(t,a,l,h,n,r,c,o);break;case 32:!function(t,e,i,o,s,n,a,r){for(var l,c=0,h=f.width,d=e;d!==o;d+=i)for(l=s;l!==a;l+=n,c+=4)t[4*(l+h*d)+2]=r[c+0],t[4*(l+h*d)+1]=r[c+1],t[4*(l+h*d)+0]=r[c+2],t[4*(l+h*d)+3]=r[c+3]}(t,a,l,h,n,r,c,o);break;default:console.error("THREE.TGALoader: Format not supported.")}}(r.data,f.width,f.height,l.pixel_data,l.palettes),a.putImageData(r,0,0),n}},THREE.MTLLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(t,e,i,o){var s=this,n=new THREE.FileLoader(this.manager);n.setPath(this.path),n.load(t,function(t){e(s.parse(t))},i,o)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split("\n"),i={},o=/\s+/,s={},n=0;n<e.length;n++){var a,r,l,c,h=e[n];0!==(h=h.trim()).length&&"#"!==h.charAt(0)&&(r=(r=0<=(a=h.indexOf(" "))?h.substring(0,a):h).toLowerCase(),c=(c=0<=a?h.substring(a+1):"").trim(),"newmtl"===r?(i={name:c},s[c]=i):i&&("ka"===r||"kd"===r||"ks"===r?(l=c.split(o,3),i[r]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]):i[r]=c))}var d=new THREE.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(s),d}},THREE.MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var i in t){var o=t[i],s={};for(var n in e[i]=s,o){var a=!0,r=o[n],l=n.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===r[0]&&0===r[1]&&0===r[2]&&(a=!1)}a&&(s[l]=r)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){function e(t,e){var i,o,s,n;r[t]||(i=a.getTextureParams(e,r),(o=a.loadTexture((s=a.baseUrl,"string"!=typeof(n=i.url)||""===n?"":/^https?:\/\//i.test(n)?n:s+n))).repeat.copy(i.scale),o.offset.copy(i.offset),o.wrapS=a.wrap,o.wrapT=a.wrap,r[t]=o)}var a=this,i=this.materialsInfo[t],r={name:t,side:this.side};for(var o in i){var s,n=i[o];if(""!==n)switch(o.toLowerCase()){case"kd":r.color=(new THREE.Color).fromArray(n);break;case"ks":r.specular=(new THREE.Color).fromArray(n);break;case"map_kd":e("map",n);break;case"map_ks":e("specularMap",n);break;case"norm":e("normalMap",n);break;case"map_bump":case"bump":e("bumpMap",n);break;case"ns":r.shininess=parseFloat(n);break;case"d":(s=parseFloat(n))<1&&(r.opacity=s,r.transparent=!0);break;case"tr":0<(s=parseFloat(n))&&(r.opacity=1-s,r.transparent=!0)}}return this.materials[t]=new THREE.MeshPhongMaterial(r),this.materials[t]},getTextureParams:function(t,e){var i={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},o=t.split(/\s+/),s=o.indexOf("-bm");return 0<=s&&(e.bumpScale=parseFloat(o[s+1]),o.splice(s,2)),0<=(s=o.indexOf("-s"))&&(i.scale.set(parseFloat(o[s+1]),parseFloat(o[s+2])),o.splice(s,4)),0<=(s=o.indexOf("-o"))&&(i.offset.set(parseFloat(o[s+1]),parseFloat(o[s+2])),o.splice(s,4)),i.url=o.join(" ").trim(),i},loadTexture:function(t,e,i,o,s){var n,a=THREE.Loader.Handlers.get(t),r=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===a&&(a=new THREE.TextureLoader(r)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin),n=a.load(t,i,o,s),void 0!==e&&(n.mapping=e),n}},function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).io=t()}(function(){return function n(a,r,l){function c(e,t){if(!r[e]){if(!a[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var s=r[e]={exports:{}};a[e][0].call(s.exports,function(t){return c(a[e][1][t]||t)},s,s.exports,n,a,r,l)}return r[e].exports}for(var h="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({1:[function(t,e,i){function o(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var i=l(t),o=i.source,s=i.id,n=i.path,a=d[s]&&n in d[s].nsps,r=e.forceNew||e["force new connection"]||!1===e.multiplex||a?(h("ignoring socket cache for %s",o),c(o,e)):(d[s]||(h("new io instance for %s",o),d[s]=c(o,e)),d[s]);return r.socket(i.path)}var l=t("./url"),s=t("socket.io-parser"),c=t("./manager"),h=t("debug")("socket.io-client");e.exports=i=o;var d=i.managers={};i.protocol=s.protocol,i.connect=o,i.Manager=t("./manager"),i.Socket=t("./socket")},{"./manager":2,"./socket":4,"./url":5,debug:14,"socket.io-parser":40}],2:[function(t,e,i){function o(t,e){if(!(this instanceof o))return new o(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}var r=t("engine.io-client"),s=t("./socket"),n=t("component-emitter"),a=t("socket.io-parser"),l=t("./on"),c=t("component-bind"),h=t("debug")("socket.io-client:manager"),d=t("indexof"),p=t("backo2"),u=Object.prototype.hasOwnProperty;(e.exports=o).prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)u.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},o.prototype.updateSocketIds=function(){for(var t in this.nsps)u.call(this.nsps,t)&&(this.nsps[t].id=this.engine.id)},n(o.prototype),o.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},o.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},o.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},o.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},o.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},o.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},o.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},o.prototype.open=o.prototype.connect=function(i){if(h("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;h("opening %s",this.uri),this.engine=r(this.uri,this.opts);var t=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var e,s,n=l(t,"open",function(){o.onopen(),i&&i()}),a=l(t,"error",function(t){var e;h("connect_error"),o.cleanup(),o.readyState="closed",o.emitAll("connect_error",t),i?((e=new Error("Connection error")).data=t,i(e)):o.maybeReconnectOnOpen()});return!1!==this._timeout&&(e=this._timeout,h("connect attempt will timeout after %d",e),s=setTimeout(function(){h("connect attempt timed out after %d",e),n.destroy(),t.close(),t.emit("error","timeout"),o.emitAll("connect_timeout",e)},e),this.subs.push({destroy:function(){clearTimeout(s)}})),this.subs.push(n),this.subs.push(a),this},o.prototype.onopen=function(){h("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(l(t,"data",c(this,"ondata"))),this.subs.push(l(t,"ping",c(this,"onping"))),this.subs.push(l(t,"pong",c(this,"onpong"))),this.subs.push(l(t,"error",c(this,"onerror"))),this.subs.push(l(t,"close",c(this,"onclose"))),this.subs.push(l(this.decoder,"decoded",c(this,"ondecoded")))},o.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},o.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},o.prototype.ondata=function(t){this.decoder.add(t)},o.prototype.ondecoded=function(t){this.emit("packet",t)},o.prototype.onerror=function(t){h("error",t),this.emitAll("error",t)},o.prototype.socket=function(t){function e(){~d(i.connecting,o)||i.connecting.push(o)}var i,o=this.nsps[t];return o||(o=new s(this,t),this.nsps[t]=o,i=this,o.on("connecting",e),o.on("connect",function(){o.id=i.engine.id}),this.autoConnect&&e()),o},o.prototype.destroy=function(t){var e=d(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},o.prototype.packet=function(i){h("writing packet %j",i);var o=this;o.encoding?o.packetBuffer.push(i):(o.encoding=!0,this.encoder.encode(i,function(t){for(var e=0;e<t.length;e++)o.engine.write(t[e],i.options);o.encoding=!1,o.processPacketQueue()}))},o.prototype.processPacketQueue=function(){var t;0<this.packetBuffer.length&&!this.encoding&&(t=this.packetBuffer.shift(),this.packet(t))},o.prototype.cleanup=function(){h("cleanup");for(var t;t=this.subs.shift();)t.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},o.prototype.close=o.prototype.disconnect=function(){h("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},o.prototype.onclose=function(t){h("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},o.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t,e,i=this;this.backoff.attempts>=this._reconnectionAttempts?(h("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1):(t=this.backoff.duration(),h("will wait %dms before reconnect attempt",t),this.reconnecting=!0,e=setTimeout(function(){i.skipReconnect||(h("attempting reconnect"),i.emitAll("reconnect_attempt",i.backoff.attempts),i.emitAll("reconnecting",i.backoff.attempts),i.skipReconnect||i.open(function(t){t?(h("reconnect attempt error"),i.reconnecting=!1,i.reconnect(),i.emitAll("reconnect_error",t.data)):(h("reconnect success"),i.onreconnect())}))},t),this.subs.push({destroy:function(){clearTimeout(e)}}))},o.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},{"./on":3,"./socket":4,backo2:8,"component-bind":11,"component-emitter":12,debug:14,"engine.io-client":16,indexof:32,"socket.io-parser":40}],3:[function(t,e,i){e.exports=function(t,e,i){return t.on(e,i),{destroy:function(){t.removeListener(e,i)}}}},{}],4:[function(t,e,i){function o(t,e){this.io=t,this.nsp=e,(this.json=this).ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var n=t("socket.io-parser"),s=t("component-emitter"),a=t("to-array"),r=t("./on"),l=t("component-bind"),c=t("debug")("socket.io-client:socket"),h=t("has-binary");e.exports=o;var d={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=s.prototype.emit;s(o.prototype),o.prototype.subEvents=function(){var t;this.subs||(t=this.io,this.subs=[r(t,"open",l(this,"onopen")),r(t,"packet",l(this,"onpacket")),r(t,"close",l(this,"onclose"))])},o.prototype.open=o.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting")),this},o.prototype.send=function(){var t=a(arguments);return t.unshift("message"),this.emit.apply(this,t),this},o.prototype.emit=function(t){if(d.hasOwnProperty(t))return p.apply(this,arguments),this;var e=a(arguments),i=n.EVENT;h(e)&&(i=n.BINARY_EVENT);var o={type:i,data:e,options:{}};return o.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),delete this.flags,this},o.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},o.prototype.onopen=function(){c("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:n.CONNECT})},o.prototype.onclose=function(t){c("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},o.prototype.onpacket=function(t){if(t.nsp==this.nsp)switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data)}},o.prototype.onevent=function(t){var e=t.data||[];c("emitting event %j",e),null!=t.id&&(c("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?p.apply(this,e):this.receiveBuffer.push(e)},o.prototype.ack=function(i){var o=this,s=!1;return function(){var t,e;s||(s=!0,t=a(arguments),c("sending ack %j",t),e=h(t)?n.BINARY_ACK:n.ACK,o.packet({type:e,id:i,data:t}))}},o.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(c("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):c("bad ack %s",t.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){for(var t=0;t<this.receiveBuffer.length;t++)p.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(t){return this.flags=this.flags||{},this.flags.compress=t,this}},{"./on":3,"component-bind":11,"component-emitter":12,debug:14,"has-binary":30,"socket.io-parser":40,"to-array":43}],5:[function(t,e,i){(function(s){var n=t("parseuri"),a=t("debug")("socket.io-client:url");e.exports=function(t,e){var i=t,e=e||s.location;null==t&&(t=e.protocol+"//"+e.host),"string"==typeof t&&("/"==t.charAt(0)&&(t="/"==t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(a("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),a("parse %s",t),i=n(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";var o=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+o+":"+i.port,i.href=i.protocol+"://"+o+(e&&e.port==i.port?"":":"+i.port),i}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{debug:14,parseuri:38}],6:[function(t,e,i){function a(){}e.exports=function(t,i,o){function s(t,e){if(s.count<=0)throw new Error("after called too many times");--s.count,t?(n=!0,i(t),i=o):0!==s.count||n||i(null,e)}var n=!1;return o=o||a,0===(s.count=t)?i():s}},{}],7:[function(t,e,i){e.exports=function(t,e,i){var o=t.byteLength;if(e=e||0,i=i||o,t.slice)return t.slice(e,i);if(e<0&&(e+=o),i<0&&(i+=o),o<i&&(i=o),o<=e||i<=e||0===o)return new ArrayBuffer(0);for(var s=new Uint8Array(t),n=new Uint8Array(i-e),a=e,r=0;a<i;a++,r++)n[r]=s[a];return n.buffer}},{}],8:[function(t,e,i){function o(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=0<t.jitter&&t.jitter<=1?t.jitter:0,this.attempts=0}(e.exports=o).prototype.duration=function(){var t,e,i=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(t=Math.random(),e=Math.floor(t*this.jitter*i),i=0==(1&Math.floor(10*t))?i-e:i+e),0|Math.min(i,this.max)},o.prototype.reset=function(){this.attempts=0},o.prototype.setMin=function(t){this.ms=t},o.prototype.setMax=function(t){this.max=t},o.prototype.setJitter=function(t){this.jitter=t}},{}],9:[function(t,e,i){!function(){"use strict";for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=new Uint8Array(256),t=0;t<n.length;t++)d[n.charCodeAt(t)]=t;i.encode=function(t){for(var e=new Uint8Array(t),i=e.length,o="",s=0;s<i;s+=3)o+=n[e[s]>>2],o+=n[(3&e[s])<<4|e[s+1]>>4],o+=n[(15&e[s+1])<<2|e[s+2]>>6],o+=n[63&e[s+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},i.decode=function(t){var e,i,o,s,n=.75*t.length,a=t.length,r=0;"="===t[t.length-1]&&(n--,"="===t[t.length-2]&&n--);for(var l=new ArrayBuffer(n),c=new Uint8Array(l),h=0;h<a;h+=4)e=d[t.charCodeAt(h)],i=d[t.charCodeAt(h+1)],o=d[t.charCodeAt(h+2)],s=d[t.charCodeAt(h+3)],c[r++]=e<<2|i>>4,c[r++]=(15&i)<<4|o>>2,c[r++]=(3&o)<<6|63&s;return l}}()},{}],10:[function(t,l,e){(function(t){function s(t){for(var e=0;e<t.length;e++){var i,o,s=t[e];s.buffer instanceof ArrayBuffer&&(i=s.buffer,s.byteLength!==i.byteLength&&((o=new Uint8Array(s.byteLength)).set(new Uint8Array(i,s.byteOffset,s.byteLength)),i=o.buffer),t[e]=i)}}function e(t,e){e=e||{};var i=new n;s(t);for(var o=0;o<t.length;o++)i.append(t[o]);return e.type?i.getBlob(e.type):i.getBlob()}function i(t,e){return s(t),new Blob(t,e||{})}var n=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,o=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),a=o&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),r=n&&n.prototype.append&&n.prototype.getBlob;l.exports=o?a?t.Blob:i:r?e:void 0}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],11:[function(t,e,i){var o=[].slice;e.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var i=o.call(arguments,2);return function(){return e.apply(t,i.concat(o.call(arguments)))}}},{}],12:[function(t,e,i){function o(t){if(t)return function(t){for(var e in o.prototype)t[e]=o.prototype[e];return t}(t)}(e.exports=o).prototype.on=o.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},o.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o,s=0;s<i.length;s++)if((o=i[s])===e||o.fn===e){i.splice(s,1);break}return this},o.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks["$"+t];if(i)for(var o=0,s=(i=i.slice(0)).length;o<s;++o)i[o].apply(this,e);return this},o.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},o.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],13:[function(t,e,i){e.exports=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],14:[function(t,e,n){function i(){var t;try{t=n.storage.debug}catch(t){}return t}(n=e.exports=t("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(){var t=arguments,e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+n.humanize(this.diff),!e)return t;var i="color: "+this.color,t=[t[0],i,"color: inherit"].concat(Array.prototype.slice.call(t,1)),o=0,s=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(s=o))}),t.splice(s,0,i),t},n.save=function(t){try{null==t?n.storage.removeItem("debug"):n.storage.debug=t}catch(t){}},n.load=i,n.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)},n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(t){return JSON.stringify(t)},n.enable(i())},{"./debug":15}],15:[function(t,e,r){(r=e.exports=function(t){function e(){}function i(){var s=i,t=+new Date,e=t-(l||t);s.diff=e,s.prev=l,s.curr=t,l=t,null==s.useColors&&(s.useColors=r.useColors()),null==s.color&&s.useColors&&(s.color=r.colors[c++%r.colors.length]);var n=Array.prototype.slice.call(arguments);n[0]=r.coerce(n[0]),"string"!=typeof n[0]&&(n=["%o"].concat(n));var a=0;n[0]=n[0].replace(/%([a-z%])/g,function(t,e){if("%%"===t)return t;a++;var i,o=r.formatters[e];return"function"==typeof o&&(i=n[a],t=o.call(s,i),n.splice(a,1),a--),t}),"function"==typeof r.formatArgs&&(n=r.formatArgs.apply(s,n)),(i.log||r.log||console.log.bind(console)).apply(s,n)}i.enabled=!(e.enabled=!1);var o=r.enabled(t)?i:e;return o.namespace=t,o}).coerce=function(t){return t instanceof Error?t.stack||t.message:t},r.disable=function(){r.enable("")},r.enable=function(t){r.save(t);for(var e=(t||"").split(/[\s,]+/),i=e.length,o=0;o<i;o++)e[o]&&("-"===(t=e[o].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+t.substr(1)+"$")):r.names.push(new RegExp("^"+t+"$")))},r.enabled=function(t){for(var e=0,i=r.skips.length;e<i;e++)if(r.skips[e].test(t))return!1;for(e=0,i=r.names.length;e<i;e++)if(r.names[e].test(t))return!0;return!1},r.humanize=t("ms"),r.names=[],r.skips=[],r.formatters={};var l,c=0},{ms:35}],16:[function(t,e,i){e.exports=t("./lib/")},{"./lib/":17}],17:[function(t,e,i){e.exports=t("./socket"),e.exports.parser=t("engine.io-parser")},{"./socket":18,"engine.io-parser":27}],18:[function(e,c,t){(function(o){function d(t,e){if(!(this instanceof d))return new d(t,e);e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=a(t),e.hostname=t.host,e.secure="https"==t.protocol||"wss"==t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=a(e.host).host),this.secure=null!=e.secure?e.secure:o.location&&"https:"==location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||(o.location?location.hostname:"localhost"),this.port=e.port||(o.location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized;var i="object"==typeof o&&o;i.global===i&&e.extraHeaders&&0<Object.keys(e.extraHeaders).length&&(this.extraHeaders=e.extraHeaders),this.open()}var i=e("./transports"),t=e("component-emitter"),p=e("debug")("engine.io-client:socket"),s=e("indexof"),n=e("engine.io-parser"),a=e("parseuri"),r=e("parsejson"),l=e("parseqs");(c.exports=d).priorWebsocketSuccess=!1,t(d.prototype),d.protocol=n.protocol,(d.Socket=d).Transport=e("./transport"),d.transports=e("./transports"),d.parser=e("engine.io-parser"),d.prototype.createTransport=function(t){p('creating transport "%s"',t);var e=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}(this.query);return e.EIO=n.protocol,e.transport=t,this.id&&(e.sid=this.id),new i[t]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders})},d.prototype.open=function(){var t;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},d.prototype.setTransport=function(t){p("setting transport %s",t.name);var e=this;this.transport&&(p("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),(this.transport=t).on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},d.prototype.probe=function(i){function t(){var t;h.onlyBinaryUpgrades&&(t=!this.supportsBinary&&h.transport.supportsBinary,c=c||t),c||(p('probe transport "%s" opened',i),l.send([{type:"ping",data:"probe"}]),l.once("packet",function(t){if(!c)if("pong"==t.type&&"probe"==t.data){if(p('probe transport "%s" pong',i),h.upgrading=!0,h.emit("upgrading",l),!l)return;d.priorWebsocketSuccess="websocket"==l.name,p('pausing current transport "%s"',h.transport.name),h.transport.pause(function(){c||"closed"!=h.readyState&&(p("changing transport and sending upgrade packet"),r(),h.setTransport(l),l.send([{type:"upgrade"}]),h.emit("upgrade",l),l=null,h.upgrading=!1,h.flush())})}else{p('probe transport "%s" failed',i);var e=new Error("probe error");e.transport=l.name,h.emit("upgradeError",e)}}))}function o(){c||(c=!0,r(),l.close(),l=null)}function e(t){var e=new Error("probe error: "+t);e.transport=l.name,o(),p('probe transport "%s" failed because of error: %s',i,t),h.emit("upgradeError",e)}function s(){e("transport closed")}function n(){e("socket closed")}function a(t){l&&t.name!=l.name&&(p('"%s" works - aborting "%s"',t.name,l.name),o())}function r(){l.removeListener("open",t),l.removeListener("error",e),l.removeListener("close",s),h.removeListener("close",n),h.removeListener("upgrading",a)}p('probing transport "%s"',i);var l=this.createTransport(i,{probe:1}),c=!1,h=this;d.priorWebsocketSuccess=!1,l.once("open",t),l.once("error",e),l.once("close",s),this.once("close",n),this.once("upgrading",a),l.open()},d.prototype.onOpen=function(){if(p("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){p("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},d.prototype.onPacket=function(t){if("opening"==this.readyState||"open"==this.readyState)switch(p('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(r(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else p('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!=e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},d.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){p("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},d.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(p("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(t,e,i){return this.sendPacket("message",t,e,i),this},d.prototype.sendPacket=function(t,e,i,o){var s;"function"==typeof e&&(o=e,e=void 0),"function"==typeof i&&(o=i,i=null),"closing"!=this.readyState&&"closed"!=this.readyState&&((i=i||{}).compress=!1!==i.compress,s={type:t,data:e,options:i},this.emit("packetCreate",s),this.writeBuffer.push(s),o&&this.once("flush",o),this.flush())},d.prototype.close=function(){function t(){o.onClose("forced close"),p("socket closing - telling transport to close"),o.transport.close()}function e(){o.removeListener("upgrade",e),o.removeListener("upgradeError",e),t()}function i(){o.once("upgrade",e),o.once("upgradeError",e)}var o;return"opening"!=this.readyState&&"open"!=this.readyState||(this.readyState="closing",(o=this).writeBuffer.length?this.once("drain",function(){(this.upgrading?i:t)()}):(this.upgrading?i:t)()),this},d.prototype.onError=function(t){p("socket error %j",t),d.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},d.prototype.onClose=function(t,e){"opening"!=this.readyState&&"open"!=this.readyState&&"closing"!=this.readyState||(p('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)},d.prototype.filterUpgrades=function(t){for(var e=[],i=0,o=t.length;i<o;i++)~s(this.transports,t[i])&&e.push(t[i]);return e}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./transport":19,"./transports":20,"component-emitter":26,debug:14,"engine.io-parser":27,indexof:32,parsejson:36,parseqs:37,parseuri:38}],19:[function(t,e,i){function o(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders}var s=t("engine.io-parser");t("component-emitter")((e.exports=o).prototype),o.prototype.onError=function(t,e){var i=new Error(t);return i.type="TransportError",i.description=e,this.emit("error",i),this},o.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(t){if("open"!=this.readyState)throw new Error("Transport not open");this.write(t)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(t){var e=s.decodePacket(t,this.socket.binaryType);this.onPacket(e)},o.prototype.onPacket=function(t){this.emit("packet",t)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":26,"engine.io-parser":27}],20:[function(e,t,i){(function(a){var r=e("xmlhttprequest-ssl"),l=e("./polling-xhr"),c=e("./polling-jsonp"),t=e("./websocket");i.polling=function(t){var e,i,o=!1,s=!1,n=!1!==t.jsonp;if(a.location&&(e="https:"==location.protocol,i=(i=location.port)||(e?443:80),o=t.hostname!=location.hostname||i!=t.port,s=t.secure!=e),t.xdomain=o,t.xscheme=s,"open"in new r(t)&&!t.forceJSONP)return new l(t);if(!n)throw new Error("JSONP disabled");return new c(t)},i.websocket=t}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling-jsonp":21,"./polling-xhr":22,"./websocket":24,"xmlhttprequest-ssl":25}],21:[function(a,r,t){(function(i){function o(){}function t(t){s.call(this,t),this.query=this.query||{},n||(i.___eio||(i.___eio=[]),n=i.___eio),this.index=n.length;var e=this;n.push(function(t){e.onData(t)}),this.query.j=this.index,i.document&&i.addEventListener&&i.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=o)},!1)}var s=a("./polling"),e=a("component-inherit");r.exports=t;var n,c=/\n/g,h=/\\n/g;e(t,s),t.prototype.supportsBinary=!1,t.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},t.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var i=document.getElementsByTagName("script")[0];i?i.parentNode.insertBefore(t,i):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},t.prototype.doWrite=function(t,e){function i(){o(),e()}function o(){if(l.iframe)try{l.form.removeChild(l.iframe)}catch(t){l.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+l.iframeId+'">';s=document.createElement(t)}catch(t){(s=document.createElement("iframe")).name=l.iframeId,s.src="javascript:0"}s.id=l.iframeId,l.form.appendChild(s),l.iframe=s}var s,n,a,r,l=this;this.form||(n=document.createElement("form"),a=document.createElement("textarea"),r=this.iframeId="eio_iframe_"+this.index,n.className="socketio",n.style.position="absolute",n.style.top="-1000px",n.style.left="-1000px",n.target=r,n.method="POST",n.setAttribute("accept-charset","utf-8"),a.name="d",n.appendChild(a),document.body.appendChild(n),this.form=n,this.area=a),this.form.action=this.uri(),o(),t=t.replace(h,"\\\n"),this.area.value=t.replace(c,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==l.iframe.readyState&&i()}:this.iframe.onload=i}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":23,"component-inherit":13}],22:[function(h,d,t){(function(s){function e(){}function t(t){var e,i;o.call(this,t),s.location?(e="https:"==location.protocol,i=(i=location.port)||(e?443:80),this.xd=t.hostname!=s.location.hostname||i!=t.port,this.xs=t.secure!=e):this.extraHeaders=t.extraHeaders}function n(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=null!=t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function i(){for(var t in n.requests)n.requests.hasOwnProperty(t)&&n.requests[t].abort()}var a=h("xmlhttprequest-ssl"),o=h("./polling"),r=h("component-emitter"),l=h("component-inherit"),c=h("debug")("engine.io-client:polling-xhr");d.exports=t,d.exports.Request=n,l(t,o),t.prototype.supportsBinary=!0,t.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.extraHeaders=this.extraHeaders,new n(t)},t.prototype.doWrite=function(t,e){var i="string"!=typeof t&&void 0!==t,o=this.request({method:"POST",data:t,isBinary:i}),s=this;o.on("success",e),o.on("error",function(t){s.onError("xhr post error",t)}),this.sendXhr=o},t.prototype.doPoll=function(){c("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},r(n.prototype),n.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new a(t),i=this;try{c("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&e.setRequestHeader(o,this.extraHeaders[o])}catch(t){}if(this.supportsBinary&&(e.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}"withCredentials"in e&&(e.withCredentials=!0),this.hasXDR()?(e.onload=function(){i.onLoad()},e.onerror=function(){i.onError(e.responseText)}):e.onreadystatechange=function(){4==e.readyState&&(200==e.status||1223==e.status?i.onLoad():setTimeout(function(){i.onError(e.status)},0))},c("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout(function(){i.onError(t)},0)}s.document&&(this.index=n.requestsCount++,n.requests[this.index]=this)},n.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},n.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},n.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},n.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=e:this.xhr.onreadystatechange=e,t)try{this.xhr.abort()}catch(t){}s.document&&delete n.requests[this.index],this.xhr=null}},n.prototype.onLoad=function(){var t,e;try{try{e=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(t){}if("application/octet-stream"===e)t=this.xhr.response;else if(this.supportsBinary)try{t=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){for(var i=new Uint8Array(this.xhr.response),o=[],s=0,n=i.length;s<n;s++)o.push(i[s]);t=String.fromCharCode.apply(null,o)}else t=this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},n.prototype.hasXDR=function(){return void 0!==s.XDomainRequest&&!this.xs&&this.enablesXDR},n.prototype.abort=function(){this.cleanup()},s.document&&(n.requestsCount=0,n.requests={},s.attachEvent?s.attachEvent("onunload",i):s.addEventListener&&s.addEventListener("beforeunload",i,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":23,"component-emitter":26,"component-inherit":13,debug:14,"xmlhttprequest-ssl":25}],23:[function(t,e,i){function o(t){var e=t&&t.forceBase64;h&&!e||(this.supportsBinary=!1),s.call(this,t)}var s=t("../transport"),n=t("parseqs"),a=t("engine.io-parser"),r=t("component-inherit"),l=t("yeast"),c=t("debug")("engine.io-client:polling");e.exports=o;var h=null!=new(t("xmlhttprequest-ssl"))({xdomain:!1}).responseType;r(o,s),o.prototype.name="polling",o.prototype.doOpen=function(){this.poll()},o.prototype.pause=function(t){function e(){c("paused"),o.readyState="paused",t()}var i,o=this;this.readyState="pausing",this.polling||!this.writable?(i=0,this.polling&&(c("we are currently polling - waiting to pause"),i++,this.once("pollComplete",function(){c("pre-pause polling complete"),--i||e()})),this.writable||(c("we are currently writing - waiting to pause"),i++,this.once("drain",function(){c("pre-pause writing complete"),--i||e()}))):e()},o.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},o.prototype.onData=function(t){var o=this;c("polling got data %s",t);a.decodePayload(t,this.socket.binaryType,function(t,e,i){if("opening"==o.readyState&&o.onOpen(),"close"==t.type)return o.onClose(),!1;o.onPacket(t)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},o.prototype.doClose=function(){function t(){c("writing close packet"),e.write([{type:"close"}])}var e=this;"open"==this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},o.prototype.write=function(t){var e=this;this.writable=!1;function i(){e.writable=!0,e.emit("drain")}e=this;a.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,i)})},o.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",i="";return!1!==this.timestampRequests&&(t[this.timestampParam]=l()),this.supportsBinary||t.sid||(t.b64=1),t=n.encode(t),this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(i=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+i+this.path+t}},{"../transport":19,"component-inherit":13,debug:14,"engine.io-parser":27,parseqs:37,"xmlhttprequest-ssl":25,yeast:45}],24:[function(h,d,t){(function(n){function t(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,i.call(this,t)}var i=h("../transport"),a=h("engine.io-parser"),o=h("parseqs"),e=h("component-inherit"),s=h("yeast"),r=h("debug")("engine.io-client:websocket"),l=n.WebSocket||n.MozWebSocket,c=l;if(!c&&"undefined"==typeof window)try{c=h("ws")}catch(t){}e(d.exports=t,i),t.prototype.name="websocket",t.prototype.supportsBinary=!0,t.prototype.doOpen=function(){var t,e;this.check()&&(t=this.uri(),(e={agent:this.agent,perMessageDeflate:this.perMessageDeflate}).pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(e.headers=this.extraHeaders),this.ws=l?new c(t):new c(t,void 0,e),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners())},t.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(t.prototype.onData=function(t){var e=this;setTimeout(function(){i.prototype.onData.call(e,t)},0)}),t.prototype.write=function(t){var o=this;this.writable=!1;for(var s=t.length,e=0,i=s;e<i;e++)!function(i){a.encodePacket(i,o.supportsBinary,function(t){var e;l||(e={},i.options&&(e.compress=i.options.compress),!o.perMessageDeflate||("string"==typeof t?n.Buffer.byteLength(t):t.length)<o.perMessageDeflate.threshold&&(e.compress=!1));try{l?o.ws.send(t):o.ws.send(t,e)}catch(t){r("websocket closed before onclose event")}--s||(o.emit("flush"),setTimeout(function(){o.writable=!0,o.emit("drain")},0))})}(t[e])},t.prototype.onClose=function(){i.prototype.onClose.call(this)},t.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},t.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",i="";return this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(i=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=s()),this.supportsBinary||(t.b64=1),(t=o.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+i+this.path+t},t.prototype.check=function(){return!(!c||"__initialize"in c&&this.name===t.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"../transport":19,"component-inherit":13,debug:14,"engine.io-parser":27,parseqs:37,ws:void 0,yeast:45}],25:[function(t,e,i){var s=t("has-cors");e.exports=function(t){var e=t.xdomain,i=t.xscheme,o=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||s))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(t){}if(!e)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},{"has-cors":31}],26:[function(t,e,i){function o(t){if(t)return function(t){for(var e in o.prototype)t[e]=o.prototype[e];return t}(t)}(e.exports=o).prototype.on=o.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},o.prototype.once=function(t,e){function i(){o.off(t,i),e.apply(this,arguments)}var o=this;return this._callbacks=this._callbacks||{},i.fn=e,this.on(t,i),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks[t];if(!i)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var o,s=0;s<i.length;s++)if((o=i[s])===e||o.fn===e){i.splice(s,1);break}return this},o.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks[t];if(i)for(var o=0,s=(i=i.slice(0)).length;o<s;++o)i[o].apply(this,e);return this},o.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},o.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],27:[function(o,t,y){(function(c){function r(t,e,i){if(!e)return y.encodeBase64Packet(t,i);if(d)return function(t,e,i){if(!e)return y.encodeBase64Packet(t,i);var o=new FileReader;return o.onload=function(){t.data=o.result,y.encodePacket(t,e,!0,i)},o.readAsArrayBuffer(t.data)}(t,e,i);var o=new Uint8Array(1);return o[0]=p[t.type],i(new g([o.buffer,t.data]))}function s(t,e,i){for(var s=new Array(t.length),o=l(t.length,i),n=0;n<t.length;n++)!function(i,t,o){e(t,function(t,e){s[i]=e,o(t,s)})}(n,t[n],o)}var t=o("./keys"),n=o("has-binary"),u=o("arraybuffer.slice"),a=o("base64-arraybuffer"),l=o("after"),h=o("utf8"),e=navigator.userAgent.match(/Android/i),i=/PhantomJS/i.test(navigator.userAgent),d=e||i;y.protocol=3;var p=y.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},m=t(p),f={type:"error",data:"parser error"},g=o("blob");y.encodePacket=function(t,e,i,o){"function"==typeof e&&(o=e,e=!1),"function"==typeof i&&(o=i,i=null);var s,n=void 0===t.data?void 0:t.data.buffer||t.data;if(c.ArrayBuffer&&n instanceof ArrayBuffer)return function(t,e,i){if(!e)return y.encodeBase64Packet(t,i);var o=t.data,s=new Uint8Array(o),n=new Uint8Array(1+o.byteLength);n[0]=p[t.type];for(var a=0;a<s.length;a++)n[a+1]=s[a];return i(n.buffer)}(t,e,o);if(g&&n instanceof c.Blob)return r(t,e,o);if(n&&n.base64)return s=t,o("b"+y.packets[s.type]+s.data.data);var a=p[t.type];return void 0!==t.data&&(a+=i?h.encode(String(t.data)):String(t.data)),o(""+a)},y.encodeBase64Packet=function(e,i){var o,s="b"+y.packets[e.type];if(g&&e.data instanceof c.Blob){var n=new FileReader;return n.onload=function(){var t=n.result.split(",")[1];i(s+t)},n.readAsDataURL(e.data)}try{o=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var a=new Uint8Array(e.data),r=new Array(a.length),l=0;l<a.length;l++)r[l]=a[l];o=String.fromCharCode.apply(null,r)}return s+=c.btoa(o),i(s)},y.decodePacket=function(t,e,i){if("string"==typeof t||void 0===t){if("b"==t.charAt(0))return y.decodeBase64Packet(t.substr(1),e);if(i)try{t=h.decode(t)}catch(t){return f}var o=t.charAt(0);return Number(o)==o&&m[o]?1<t.length?{type:m[o],data:t.substring(1)}:{type:m[o]}:f}var o=new Uint8Array(t)[0],s=u(t,1);return g&&"blob"===e&&(s=new g([s])),{type:m[o],data:s}},y.decodeBase64Packet=function(t,e){var i=m[t.charAt(0)];if(!c.ArrayBuffer)return{type:i,data:{base64:!0,data:t.substr(1)}};var o=a.decode(t.substr(1));return"blob"===e&&g&&(o=new g([o])),{type:i,data:o}},y.encodePayload=function(t,e,i){"function"==typeof e&&(i=e,e=null);var o=n(t);return e&&o?g&&!d?y.encodePayloadAsBlob(t,i):y.encodePayloadAsArrayBuffer(t,i):t.length?void s(t,function(t,i){y.encodePacket(t,!!o&&e,!0,function(t){var e;i(null,(e=t).length+":"+e)})},function(t,e){return i(e.join(""))}):i("0:")},y.decodePayload=function(t,e,i){if("string"!=typeof t)return y.decodePayloadAsBinary(t,e,i);var o;if("function"==typeof e&&(i=e,e=null),""==t)return i(f,0,1);for(var s,n,a="",r=0,l=t.length;r<l;r++){var c=t.charAt(r);if(":"!=c)a+=c;else{if(""==a||a!=(s=Number(a)))return i(f,0,1);if(a!=(n=t.substr(r+1,s)).length)return i(f,0,1);if(n.length){if(o=y.decodePacket(n,e,!0),f.type==o.type&&f.data==o.data)return i(f,0,1);if(!1===i(o,r+s,l))return}r+=s,a=""}}return""!=a?i(f,0,1):void 0},y.encodePayloadAsArrayBuffer=function(t,o){if(!t.length)return o(new ArrayBuffer(0));s(t,function(t,e){y.encodePacket(t,!0,!0,function(t){return e(null,t)})},function(t,e){var i=e.reduce(function(t,e){var i="string"==typeof e?e.length:e.byteLength;return t+i.toString().length+i+2},0),a=new Uint8Array(i),r=0;return e.forEach(function(t){var e="string"==typeof t,i=t;if(e){for(var o=new Uint8Array(t.length),s=0;s<t.length;s++)o[s]=t.charCodeAt(s);i=o.buffer}a[r++]=e?0:1;for(var n=i.byteLength.toString(),s=0;s<n.length;s++)a[r++]=parseInt(n[s]);a[r++]=255;for(o=new Uint8Array(i),s=0;s<o.length;s++)a[r++]=o[s]}),o(a.buffer)})},y.encodePayloadAsBlob=function(t,i){s(t,function(t,r){y.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);t=i.buffer,e[0]=0}for(var s,n=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),a=new Uint8Array(n.length+1),o=0;o<n.length;o++)a[o]=parseInt(n[o]);a[n.length]=255,g&&(s=new g([e.buffer,a.buffer,t]),r(null,s))})},function(t,e){return i(new g(e))})},y.decodePayloadAsBinary=function(t,i,o){"function"==typeof i&&(o=i,i=null);for(var e=t,s=[],n=!1;0<e.byteLength;){for(var a=new Uint8Array(e),r=0===a[0],l="",c=1;255!=a[c];c++){if(310<l.length){n=!0;break}l+=a[c]}if(n)return o(f,0,1);e=u(e,2+l.length),l=parseInt(l);var h=u(e,0,l);if(r)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(t){var d=new Uint8Array(h);h="";for(c=0;c<d.length;c++)h+=String.fromCharCode(d[c])}s.push(h),e=u(e,l)}var p=s.length;s.forEach(function(t,e){o(y.decodePacket(t,i,!0),e,p)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./keys":28,after:6,"arraybuffer.slice":7,"base64-arraybuffer":9,blob:10,"has-binary":29,utf8:44}],28:[function(t,e,i){e.exports=Object.keys||function(t){var e=[],i=Object.prototype.hasOwnProperty;for(var o in t)i.call(t,o)&&e.push(o);return e}},{}],29:[function(t,e,i){(function(s){var n=t("isarray");e.exports=function(t){return function t(e){if(!e)return!1;if(s.Buffer&&s.Buffer.isBuffer(e)||s.ArrayBuffer&&e instanceof ArrayBuffer||s.Blob&&e instanceof Blob||s.File&&e instanceof File)return!0;if(n(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e)for(var o in e.toJSON&&(e=e.toJSON()),e)if(Object.prototype.hasOwnProperty.call(e,o)&&t(e[o]))return!0;return!1}(t)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:33}],30:[function(t,e,i){(function(s){var n=t("isarray");e.exports=function(t){return function t(e){if(!e)return!1;if(s.Buffer&&s.Buffer.isBuffer&&s.Buffer.isBuffer(e)||s.ArrayBuffer&&e instanceof ArrayBuffer||s.Blob&&e instanceof Blob||s.File&&e instanceof File)return!0;if(n(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e)for(var o in e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),e)if(Object.prototype.hasOwnProperty.call(e,o)&&t(e[o]))return!0;return!1}(t)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:33}],31:[function(t,e,i){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},{}],32:[function(t,e,i){var o=[].indexOf;e.exports=function(t,e){if(o)return t.indexOf(e);for(var i=0;i<t.length;++i)if(t[i]===e)return i;return-1}},{}],33:[function(t,e,i){e.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},{}],34:[function(t,r,l){(function(a){(function(){function H(t,l){function c(t){if(c[t]!==_)return c[t];var e;if("bug-string-char-index"==t)e="a"!="a"[0];else if("json"==t)e=c("json-stringify")&&c("json-parse");else{var i,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var s=l.stringify,n="function"==typeof s&&P;if(n){(i=function(){return 1}).toJSON=i;try{n="0"===s(0)&&"0"===s(new h)&&'""'==s(new d)&&s(L)===_&&s(_)===_&&s()===_&&"1"===s(i)&&"[1]"==s([i])&&"[null]"==s([_])&&"null"==s(null)&&"[null,null,null]"==s([_,L,null])&&s({a:[i,!0,!1,null,"\0\b\n\f\r\t"]})==o&&"1"===s(null,i)&&"[\n 1,\n 2\n]"==s([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==s(new p(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==s(new p(864e13))&&'"-000001-01-01T00:00:00.000Z"'==s(new p(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==s(new p(-1))}catch(t){n=!1}}e=n}if("json-parse"==t){var a=l.parse;if("function"==typeof a)try{if(0===a("0")&&!a(!1)){var r=5==(i=a(o)).a.length&&1===i.a[0];if(r){try{r=!a('"\t"')}catch(t){}if(r)try{r=1!==a("01")}catch(t){}if(r)try{r=1!==a("1.")}catch(t){}}}}catch(t){r=!1}e=r}}return c[t]=!!e}t=t||O.Object(),l=l||O.Object();var h=t.Number||O.Number,d=t.String||O.String,e=t.Object||O.Object,p=t.Date||O.Date,i=t.SyntaxError||O.SyntaxError,E=t.TypeError||O.TypeError,o=t.Math||O.Math,s=t.JSON||O.JSON;"object"==typeof s&&s&&(l.stringify=s.stringify,l.parse=s.parse);var $,C,_,r,T,n,S,u,M,R,I,m,f,g,y,b,a,v,w,k,x=e.prototype,L=x.toString,P=new p(-0xc782b5b800cec);try{P=-109252==P.getUTCFullYear()&&0===P.getUTCMonth()&&1===P.getUTCDate()&&10==P.getUTCHours()&&37==P.getUTCMinutes()&&6==P.getUTCSeconds()&&708==P.getUTCMilliseconds()}catch(t){}return c("json")||(r=c("bug-string-char-index"),P||(T=o.floor,n=[0,31,59,90,120,151,181,212,243,273,304,334],S=function(t,e){return n[e]+365*(t-1970)+T((t-1969+(e=+(1<e)))/4)-T((t-1901+e)/100)+T((t-1601+e)/400)}),($=x.hasOwnProperty)||($=function(t){var i,e={__proto__:null};return e.__proto__={toString:1},$=e.toString!=L?function(t){var e=this.__proto__,i=t in(this.__proto__=null,this);return this.__proto__=e,i}:(i=e.constructor,function(t){var e=(this.constructor||i).prototype;return t in this&&!(t in e&&this[t]===e[t])}),e=null,$.call(this,t)}),C=function(t,e){var i,a,o,s=0;for(o in(i=function(){this.valueOf=0}).prototype.valueOf=0,a=new i)$.call(a,o)&&s++;return i=a=null,(C=s?2==s?function(t,e){var i,o={},s="[object Function]"==L.call(t);for(i in t)s&&"prototype"==i||$.call(o,i)||!(o[i]=1)||!$.call(t,i)||e(i)}:function(t,e){var i,o,s="[object Function]"==L.call(t);for(i in t)s&&"prototype"==i||!$.call(t,i)||(o="constructor"===i)||e(i);(o||$.call(t,i="constructor"))&&e(i)}:(a=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],function(t,e){var i,o,s="[object Function]"==L.call(t),n=!s&&"function"!=typeof t.constructor&&A[typeof t.hasOwnProperty]&&t.hasOwnProperty||$;for(i in t)s&&"prototype"==i||!n.call(t,i)||e(i);for(o=a.length;i=a[--o];n.call(t,i)&&e(i));}))(t,e)},c("json-stringify")||(u={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},M=function(t,e){return("000000"+(e||0)).slice(-t)},R=function(t){for(var e='"',i=0,o=t.length,s=!r||10<o,n=s&&(r?t.split(""):t);i<o;i++){var a=t.charCodeAt(i);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=u[a];break;default:if(a<32){e+="\\u00"+M(2,a.toString(16));break}e+=s?n[i]:t.charAt(i)}}return e+'"'},I=function(t,e,i,o,s,n,a){var r,l,c,h,d,p,u,m,f,g,y,b,v,w,k,x;try{r=e[t]}catch(t){}if("object"==typeof r&&r)if("[object Date]"!=(l=L.call(r))||$.call(r,"toJSON"))"function"==typeof r.toJSON&&("[object Number]"!=l&&"[object String]"!=l&&"[object Array]"!=l||$.call(r,"toJSON"))&&(r=r.toJSON(t));else if(-1/0<r&&r<1/0){if(S){for(d=T(r/864e5),c=T(d/365.2425)+1970-1;S(c+1,0)<=d;c++);for(h=T((d-S(c,0))/30.42);S(c,h+1)<=d;h++);d=1+d-S(c,h),u=T((p=(r%864e5+864e5)%864e5)/36e5)%24,m=T(p/6e4)%60,f=T(p/1e3)%60,g=p%1e3}else c=r.getUTCFullYear(),h=r.getUTCMonth(),d=r.getUTCDate(),u=r.getUTCHours(),m=r.getUTCMinutes(),f=r.getUTCSeconds(),g=r.getUTCMilliseconds();r=(c<=0||1e4<=c?(c<0?"-":"+")+M(6,c<0?-c:c):M(4,c))+"-"+M(2,h+1)+"-"+M(2,d)+"T"+M(2,u)+":"+M(2,m)+":"+M(2,f)+"."+M(3,g)+"Z"}else r=null;if(i&&(r=i.call(e,t,r)),null===r)return"null";if("[object Boolean]"==(l=L.call(r)))return""+r;if("[object Number]"==l)return-1/0<r&&r<1/0?""+r:"null";if("[object String]"==l)return R(""+r);if("object"==typeof r){for(w=a.length;w--;)if(a[w]===r)throw E();if(a.push(r),y=[],k=n,n+=s,"[object Array]"==l){for(v=0,w=r.length;v<w;v++)b=I(v,r,i,o,s,n,a),y.push(b===_?"null":b);x=y.length?s?"[\n"+n+y.join(",\n"+n)+"\n"+k+"]":"["+y.join(",")+"]":"[]"}else C(o||r,function(t){var e=I(t,r,i,o,s,n,a);e!==_&&y.push(R(t)+":"+(s?" ":"")+e)}),x=y.length?s?"{\n"+n+y.join(",\n"+n)+"\n"+k+"}":"{"+y.join(",")+"}":"{}";return a.pop(),x}},l.stringify=function(t,e,i){var o,s,n,a;if(A[typeof e]&&e)if("[object Function]"==(a=L.call(e)))s=e;else if("[object Array]"==a){n={};for(var r,l=0,c=e.length;l<c;r=e[l++],"[object String]"!=(a=L.call(r))&&"[object Number]"!=a||(n[r]=1));}if(i)if("[object Number]"==(a=L.call(i))){if(0<(i-=i%1))for(o="",10<i&&(i=10);o.length<i;o+=" ");}else"[object String]"==a&&(o=i.length<=10?i:i.slice(0,10));return I("",((r={})[""]=t,r),s,n,o,"",[])}),c("json-parse")||(g=d.fromCharCode,y={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},b=function(){throw m=f=null,i()},a=function(){for(var t,e,i,o,s,n=f,a=n.length;m<a;)switch(s=n.charCodeAt(m)){case 9:case 10:case 13:case 32:m++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=r?n.charAt(m):n[m],m++,t;case 34:for(t="@",m++;m<a;)if((s=n.charCodeAt(m))<32)b();else if(92==s)switch(s=n.charCodeAt(++m)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=y[s],m++;break;case 117:for(e=++m,i=m+4;m<i;m++)48<=(s=n.charCodeAt(m))&&s<=57||97<=s&&s<=102||65<=s&&s<=70||b();t+=g("0x"+n.slice(e,m));break;default:b()}else{if(34==s)break;for(s=n.charCodeAt(m),e=m;32<=s&&92!=s&&34!=s;)s=n.charCodeAt(++m);t+=n.slice(e,m)}if(34==n.charCodeAt(m))return m++,t;b();default:if(e=m,45==s&&(o=!0,s=n.charCodeAt(++m)),48<=s&&s<=57){for(48==s&&48<=(s=n.charCodeAt(m+1))&&s<=57&&b(),o=!1;m<a&&48<=(s=n.charCodeAt(m))&&s<=57;m++);if(46==n.charCodeAt(m)){for(i=++m;i<a&&48<=(s=n.charCodeAt(i))&&s<=57;i++);i==m&&b(),m=i}if(101==(s=n.charCodeAt(m))||69==s){for(43!=(s=n.charCodeAt(++m))&&45!=s||m++,i=m;i<a&&48<=(s=n.charCodeAt(i))&&s<=57;i++);i==m&&b(),m=i}return+n.slice(e,m)}if(o&&b(),"true"==n.slice(m,m+4))return m+=4,!0;if("false"==n.slice(m,m+5))return m+=5,!1;if("null"==n.slice(m,m+4))return m+=4,null;b()}return"$"},v=function(t){var e,i;if("$"==t&&b(),"string"==typeof t){if("@"==(r?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];"]"!=(t=a());i=i||!0)!i||","==t&&"]"!=(t=a())||b(),","==t&&b(),e.push(v(t));return e}if("{"==t){for(e={};"}"!=(t=a());i=i||!0)!i||","==t&&"}"!=(t=a())||b(),","!=t&&"string"==typeof t&&"@"==(r?t.charAt(0):t[0])&&":"==a()||b(),e[t.slice(1)]=v(a());return e}b()}return t},w=function(t,e,i){var o=k(t,e,i);o===_?delete t[e]:t[e]=o},k=function(t,e,i){var o,s=t[e];if("object"==typeof s&&s)if("[object Array]"==L.call(s))for(o=s.length;o--;)w(s,o,i);else C(s,function(t){w(s,t,i)});return i.call(t,e,s)},l.parse=function(t,e){var i,o;return m=0,f=""+t,i=v(a()),"$"!=a()&&b(),m=f=null,e&&"[object Function]"==L.call(e)?k(((o={})[""]=i,o),"",e):i})),l.runInContext=H,l}var t,e,i,o,A={function:!0,object:!0},s=A[typeof l]&&l&&!l.nodeType&&l,O=A[typeof window]&&window||this,n=s&&A[typeof r]&&r&&!r.nodeType&&"object"==typeof a&&a;!n||n.global!==n&&n.window!==n&&n.self!==n||(O=n),s?H(O,s):(t=O.JSON,e=O.JSON3,i=!1,o=H(O,O.JSON3={noConflict:function(){return i||(i=!0,O.JSON=t,O.JSON3=e,t=e=null),o}}),O.JSON={parse:o.parse,stringify:o.stringify})}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],35:[function(t,e,i){function s(t,e,i){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+i:Math.ceil(t/e)+" "+i+"s"}var n=36e5,a=864e5;e.exports=function(t,e){return e=e||{},"string"==typeof t?function(t){if(!(1e4<(t=""+t).length)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var i=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*n;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*i;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i}}}}(t):e.long?s(o=t,a,"day")||s(o,n,"hour")||s(o,6e4,"minute")||s(o,1e3,"second")||o+" ms":a<=(i=t)?Math.round(i/a)+"d":n<=i?Math.round(i/n)+"h":6e4<=i?Math.round(i/6e4)+"m":1e3<=i?Math.round(i/1e3)+"s":i+"ms";var i,o}},{}],36:[function(t,l,e){(function(e){var i=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,s=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,n=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,r=/\s+$/;l.exports=function(t){return"string"==typeof t&&t?(t=t.replace(a,"").replace(r,""),e.JSON&&JSON.parse?JSON.parse(t):i.test(t.replace(o,"@").replace(s,"]").replace(n,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],37:[function(t,e,i){i.encode=function(t){var e="";for(var i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e},i.decode=function(t){for(var e={},i=t.split("&"),o=0,s=i.length;o<s;o++){var n=i[o].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}},{}],38:[function(t,e,i){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,l=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(t){var e=t,i=t.indexOf("["),o=t.indexOf("]");-1!=i&&-1!=o&&(t=t.substring(0,i)+t.substring(i,o).replace(/:/g,";")+t.substring(o,t.length));for(var s=r.exec(t||""),n={},a=14;a--;)n[l[a]]=s[a]||"";return-1!=i&&-1!=o&&(n.source=e,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n}},{}],39:[function(t,e,i){(function(h){var d=t("isarray"),p=t("./is-buffer");i.deconstructPacket=function(t){var a=[],e=t.data,i=t;return i.data=function t(e){if(!e)return e;if(p(e)){var i={_placeholder:!0,num:a.length};return a.push(e),i}if(d(e)){for(var o=new Array(e.length),s=0;s<e.length;s++)o[s]=t(e[s]);return o}if("object"!=typeof e||e instanceof Date)return e;o={};for(var n in e)o[n]=t(e[n]);return o}(e),i.attachments=a.length,{packet:i,buffers:a}},i.reconstructPacket=function(t,s){return t.data=function t(e){if(e&&e._placeholder)return s[e.num];if(d(e)){for(var i=0;i<e.length;i++)e[i]=t(e[i]);return e}if(e&&"object"==typeof e){for(var o in e)e[o]=t(e[o]);return e}return e}(t.data),t.attachments=void 0,t},i.removeBlobs=function(t,r){var l=0,c=t;(function t(e,i,o){if(!e)return e;if(h.Blob&&e instanceof Blob||h.File&&e instanceof File){l++;var s=new FileReader;s.onload=function(){o?o[i]=this.result:c=this.result,--l||r(c)},s.readAsArrayBuffer(e)}else if(d(e))for(var n=0;n<e.length;n++)t(e[n],n,e);else if(e&&"object"==typeof e&&!p(e))for(var a in e)t(e[a],a,e)})(c),l||r(c)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./is-buffer":41,isarray:33}],40:[function(t,e,a){function i(){}function n(t){var e="",i=!1;return e+=t.type,a.BINARY_EVENT!=t.type&&a.BINARY_ACK!=t.type||(e+=t.attachments,e+="-"),t.nsp&&"/"!=t.nsp&&(i=!0,e+=t.nsp),null!=t.id&&(i&&(e+=",",i=!1),e+=t.id),null!=t.data&&(i&&(e+=","),e+=h.stringify(t.data)),c("encoded %j as %s",t,e),e}function o(t,s){p.removeBlobs(t,function(t){var e=p.deconstructPacket(t),i=n(e.packet),o=e.buffers;o.unshift(i),s(o)})}function s(){this.reconstructor=null}function r(t){this.reconPack=t,this.buffers=[]}function l(){return{type:a.ERROR,data:"parser error"}}var c=t("debug")("socket.io-parser"),h=t("json3"),d=(t("isarray"),t("component-emitter")),p=t("./binary"),u=t("./is-buffer");a.protocol=4,a.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],a.CONNECT=0,a.DISCONNECT=1,a.EVENT=2,a.ACK=3,a.ERROR=4,a.BINARY_EVENT=5,a.BINARY_ACK=6,a.Encoder=i,a.Decoder=s,i.prototype.encode=function(t,e){c("encoding packet %j",t),a.BINARY_EVENT==t.type||a.BINARY_ACK==t.type?o(t,e):e([n(t)])},d(s.prototype),s.prototype.add=function(t){var e;if("string"==typeof t)e=function(t){var e={},i=0;if(e.type=Number(t.charAt(0)),null==a.types[e.type])return l();if(a.BINARY_EVENT==e.type||a.BINARY_ACK==e.type){for(var o="";"-"!=t.charAt(++i)&&(o+=t.charAt(i),i!=t.length););if(o!=Number(o)||"-"!=t.charAt(i))throw new Error("Illegal attachments");e.attachments=Number(o)}if("/"==t.charAt(i+1))for(e.nsp="";++i;){if(","==(s=t.charAt(i)))break;if(e.nsp+=s,i==t.length)break}else e.nsp="/";var s,n=t.charAt(i+1);if(""!==n&&Number(n)==n){for(e.id="";++i;){if(null==(s=t.charAt(i))||Number(s)!=s){--i;break}if(e.id+=t.charAt(i),i==t.length)break}e.id=Number(e.id)}if(t.charAt(++i))try{e.data=h.parse(t.substr(i))}catch(t){return l()}return c("decoded %s as %j",t,e),e}(t),a.BINARY_EVENT==e.type||a.BINARY_ACK==e.type?(this.reconstructor=new r(e),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",e)):this.emit("decoded",e);else{if(!u(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(e=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",e))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},r.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length!=this.reconPack.attachments)return null;var e=p.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e},r.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":39,"./is-buffer":41,"component-emitter":42,debug:14,isarray:33,json3:34}],41:[function(t,i,e){(function(e){i.exports=function(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],42:[function(t,e,i){arguments[4][26][0].apply(i,arguments)},{dup:26}],43:[function(t,e,i){e.exports=function(t,e){for(var i=[],o=(e=e||0)||0;o<t.length;o++)i[o-e]=t[o];return i}},{}],44:[function(t,g,y){(function(f){!function(t){function n(t){for(var e,i,o=[],s=0,n=t.length;s<n;)55296<=(e=t.charCodeAt(s++))&&e<=56319&&s<n?56320==(64512&(i=t.charCodeAt(s++)))?o.push(((1023&e)<<10)+(1023&i)+65536):(o.push(e),s--):o.push(e);return o}function a(t){if(55296<=t&&t<=57343)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value")}function r(t,e){return d(t>>e&63|128)}function o(){if(c<=h)throw Error("Invalid byte index");var t=255&l[h];if(h++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}var e="object"==typeof y&&y,i="object"==typeof g&&g&&g.exports==e&&g,s="object"==typeof f&&f;s.global!==s&&s.window!==s||(t=s);var l,c,h,d=String.fromCharCode,p={version:"2.0.0",encode:function(t){for(var e=n(t),i=e.length,o=-1,s="";++o<i;)s+=function(t){if(0==(4294967168&t))return d(t);var e="";return 0==(4294965248&t)?e=d(t>>6&31|192):0==(4294901760&t)?(a(t),e=d(t>>12&15|224),e+=r(t,6)):0==(4292870144&t)&&(e=d(t>>18&7|240),e+=r(t,12),e+=r(t,6)),e+d(63&t|128)}(e[o]);return s},decode:function(t){l=n(t),c=l.length,h=0;for(var e,i=[];!1!==(e=function(){var t,e;if(c<h)throw Error("Invalid byte index");if(h==c)return!1;if(t=255&l[h],h++,0==(128&t))return t;if(192==(224&t)){if(128<=(e=(31&t)<<6|o()))return e;throw Error("Invalid continuation byte")}if(224==(240&t)){if(2048<=(e=(15&t)<<12|o()<<6|o()))return a(e),e;throw Error("Invalid continuation byte")}if(240==(248&t)&&(65536<=(e=(15&t)<<18|o()<<12|o()<<6|o())&&e<=1114111))return e;throw Error("Invalid UTF-8 detected")}());)i.push(e);return function(t){for(var e,i=t.length,o=-1,s="";++o<i;)65535<(e=t[o])&&(s+=d((e-=65536)>>>10&1023|55296),e=56320|1023&e),s+=d(e);return s}(i)}};if(0,e&&!e.nodeType)if(i)i.exports=p;else{var u={}.hasOwnProperty;for(var m in p)u.call(p,m)&&(e[m]=p[m])}else t.utf8=p}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],45:[function(t,e,i){"use strict";function o(t){for(var e="";e=a[t%r]+e,0<(t=Math.floor(t/r)););return e}function s(){var t=o(+new Date);return t!==n?(c=0,n=t):t+"."+o(c++)}for(var n,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),r=64,l={},c=0,h=0;h<r;h++)l[a[h]]=h;s.encode=o,s.decode=function(t){var e=0;for(h=0;h<t.length;h++)e=e*r+l[t.charAt(h)];return e},e.exports=s},{}]},{},[1])(1)});function v(){Mt&&Mt.setSize(window.innerWidth,window.innerHeight),It&&(It.aspect=window.innerWidth/window.innerHeight,It.updateProjectionMatrix())}var w={};window.addEventListener("resize",v,!1);var k={box:new THREE.BoxBufferGeometry(1,1,1),sphere:new THREE.SphereBufferGeometry(.65),line:new THREE.Geometry,plane:new THREE.PlaneGeometry(2,2)},x={};x.player=k.box,x.boat=k.box,x.projectile=k.sphere,x.hook=k.plane,x.impact_water=k.sphere,x.islandradius=new THREE.CylinderBufferGeometry(.3,1,1,20,1);var E={};E.player=new THREE.MeshLambertMaterial({color:16359458}),E.boat=new THREE.MeshLambertMaterial({color:9064510}),E.boat.side=THREE.DoubleSide,E.sail=new THREE.MeshLambertMaterial({color:16777215}),E.sail.side=THREE.DoubleSide,E.sailRed=new THREE.MeshLambertMaterial({color:14242639}),E.sailRed.side=THREE.DoubleSide,E.splinter=new THREE.MeshLambertMaterial({color:13479055,flatShading:!0}),E.projectile=new THREE.MeshPhongMaterial({color:1972776,shininess:.9,flatShading:!0}),E.boundary=new THREE.MeshLambertMaterial({color:11856895,flatShading:!0,opacity:.8,transparent:!0}),E.impact_water=new THREE.MeshBasicMaterial({color:15331839,flatShading:!0,opacity:.9,transparent:!0}),E.islandradius=new THREE.MeshBasicMaterial({color:12317695,flatShading:!1,opacity:.2,transparent:!0}),E.smoke_enemy=new THREE.MeshBasicMaterial({color:16763594,flatShading:!0,opacity:.7,transparent:!0}),E.smoke_friendly=new THREE.MeshBasicMaterial({color:13494015,flatShading:!0,opacity:.7,transparent:!0}),E.smoke_player=new THREE.MeshBasicMaterial({color:14687774,flatShading:!0,opacity:.5,transparent:!0}),E.fishing_line=new THREE.MeshBasicMaterial({color:0,flatShading:!0,opacity:.5,transparent:!0}),E.sky=new THREE.MeshBasicMaterial({color:709114,side:THREE.BackSide});var C={};C.myself=new THREE.Color(65280),C.player=new THREE.Color(16777215),C.captain=new THREE.Color(16711680);var _={};_.modeloffsetCrab=new THREE.Vector3(0,.9,0),_.modeloffsetFishShellClam=new THREE.Vector3(0,.3,0),_.sizeEntity=new THREE.Vector3(1,1,1),_.sizePlayer=new THREE.Vector3(1,1,1),_.sizeProjectile=new THREE.Vector3(.3,.3,.3);var T,S=new THREE.TextureLoader,M=new THREE.FileLoader,R=new THREE.OBJLoader,I=new THREE.TGALoader,L=new THREE.MTLLoader,P={},H={},A={},O={},z={promises:[],compute:function(i){return z.promises.push(new Promise(function(t,e){i(),t()})),z.promises[z.promises.length-1]},loadTexture:function(a){return z.promises.push(new Promise(function(e,t){var i=a.split("/").pop().split("."),o=i.pop(),s=i.pop();if("tga"!==o){if("mtl"===o){var n=a.split("/");return n.pop(),n=n.join("/")+"/",L.setPath(n),void L.load(s+"."+o,function(t){t.preload(),R.setMaterials(t),e()})}S.load(a,function(t){P[a.substring(a.lastIndexOf("/")+1,a.length).replace(/\.[^/.]+$/,"")]=t,e()},function(t){},function(t){})}else I.load(a,function(t){P[s]=t,e()})})),z.promises[z.promises.length-1]},loadModel:function(i){return z.promises.push(new Promise(function(e,t){R.load(i,function(t){A[i.substring(i.lastIndexOf("/")+1,i.length).replace(/\.[^/.]+$/,"")]=t,e()})})),z.promises[z.promises.length-1]},loadObjWithMtl:function(i){var o=new THREE.OBJLoader,s=new THREE.MTLLoader,t=(a=i.split("/")).pop().split("."),n=(t.pop(),t.pop()),a=a.join("/")+"/";return z.promises.push(new Promise(function(e,t){s.setPath(a),s.load(n+".mtl",function(t){t.preload(),o.setMaterials(t),o.load(i,function(t){A[i.substring(i.lastIndexOf("/")+1,i.length).replace(/\.[^/.]+$/,"")]=t,e()})})})),z.promises[z.promises.length-1]},loadShader:function(i){return z.promises.push(new Promise(function(e,t){M.load(i,function(t){H[i.substring(i.lastIndexOf("/")+1,i.length)]=t,e()})})),z.promises[z.promises.length-1]},loadJSON:function(i){return z.promises.push(new Promise(function(e,t){$.getJSON(i,function(t){O[i.substring(i.lastIndexOf("/")+1,i.length).replace(/\.[^/.]+$/,"")]=t,e()})})),z.promises[z.promises.length-1]},onFinish:function(e){Promise.all(z.promises).then(function(t){e&&e()})}},D=!1,j=!1,U=!1,W=!1,V=!1;document.onkeydown=function(t){var e,i,o;38!==(t=t||window.event).keyCode||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#crew-name-edit-input").is(":focus")?39!==t.keyCode||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#crew-name-edit-input").is(":focus")?40!==t.keyCode||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#crew-name-edit-input").is(":focus")?37!==t.keyCode||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#crew-name-edit-input").is(":focus")?$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||49!==t.keyCode&&97!==t.keyCode||$("#crew-name-edit-input").is(":focus")?$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||50!==t.keyCode&&98!==t.keyCode||$("#crew-name-edit-input").is(":focus")?77!==t.keyCode||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#crew-name-edit-input").is(":focus")?16!==t.keyCode||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#crew-name-edit-input").is(":focus")?81!==t.keyCode||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#crew-name-edit-input").is(":focus")?188!==t.keyCode||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#crew-name-edit-input").is(":focus")?51===t.keyCode||99===t.keyCode?Ut.hideSuggestionBox&&void 0!==Lt&&void 0!==Lt.parent&&1!==Lt.parent.netType&&(be.emit("purchase",{type:0,id:"1"},function(t){t&&console.warn(t)}),500<Lt.gold)&&(GameAnalytics("addDesignEvent","Game:Session:PurchasedBoat"),$("#raft-shop-div").hide(),$("#krew-div").show(),e=document.getElementById("suggestion-ui").innerHTML,void 0!==(i=$("#toggle-shop-modal-button").attr("data-content",e).data("bs.popover"))&&(i.setContent(),$("#toggle-shop-modal-button").popover("hide"))):!(53<=t.keyCode&&t.keyCode<=55&&Lt&&Lt.geometry)||$("#chat-message").is(":focus")||$("#clan-request").is(":focus")||$("#make-deposit").is(":focus")||$("#take-deposit").is(":focus")||(o=EXPERIENCEPOINTSCOMPONENT.keys[t.keyCode],EXPERIENCEPOINTSCOMPONENT.clearStore().setStore(function(t){t.allocatedPoints[o]=1,EXPERIENCEPOINTSCOMPONENT.allocatePoints(function(){Ut.updateUiExperience()})})):$("#show-chat").is(":visible")?($("#show-chat").hide(),$("#chat-div").show()):($("#show-chat").show(),$("#chat-div").hide()):$("#quests-modal").is(":visible")?$("#quests-modal").hide():document.getElementById("toggle-quest-button").click():$("#player-leaderboard").show():$("#minimap-container").is(":visible")?$("#minimap-container").hide():$("#minimap-container").show():Lt&&Lt.geometry&&1!==Lt.activeWeapon&&(be.emit("changeWeapon",1),Lt.isFishing=!1):Lt&&Lt.geometry&&0!==Lt.activeWeapon&&(be.emit("changeWeapon",0),Lt.isFishing=!1):D=!0:W=!0:j=!0:U=!0};function G(){var o=this,s=Math.PI/2;this.blocker=document.getElementById("blocker"),this.locked=!1,this.lmb=!1,this.rmb=!1,this.cameraX=0,this.cameraY=Math.PI,this.cameraZoom=8,this.mouse=new THREE.Vector2,this.mouseOld=new THREE.Vector2,this.mouseElement=void 0,this.isMouseLookLocked=!1,this.lmbLastDownTime=0,this.lastX=0,this.lastY=0,this.mouseMoveUnlocked=function(t){o.mouseElement=t.target.getAttribute?t.target.getAttribute("data-infopanel"):null,o.mouse.x=t.clientX/window.innerWidth*2-1,o.mouse.y=-t.clientY/window.innerHeight*2+1,Y||(o.lastX=t.x,o.lastY=t.y)},this.mouseMoveLocked=function(t){t.preventDefault();var e=t.movementX||t.mozMovementX||t.webkitMovementX||0,i=t.movementY||t.mozMovementY||t.webkitMovementY||0;Y&&(o.cameraY-=.0023*e,o.cameraX-=.0016*i),Y||(e=t.x-o.lastX,i=t.y-o.lastY,o.cameraY-=.0082*e,o.cameraX-=.0064*i,o.lastX=t.x,o.lastY=t.y),o.cameraX=Math.max(-s,Math.min(s,o.cameraX))},this.onMouseDown=function(t){switch(t.button){case 0:o.lmb=!0,this.lmbLastDownTime=performance.now();break;case 2:o.rmb=!0}Lt&&(o.lmb||o.rmb)&&t.target===Mt.domElement&&o.lockMouseLook()},this.onMouseUp=function(t){switch(t.button){case 0:o.lmb=!1;break;case 2:o.rmb=!1}return!1},this.mouseWheelEvent=function(t){var e;t.target!=Mt.domElement&&t.target!=document.body||(t.preventDefault(),e=t.wheelDelta?t.wheelDelta:-t.detail,o.cameraZoom-=0<e?1:-1,o.cameraZoom=Math.min(30,Math.max(o.cameraZoom,3)))},Y?document.addEventListener("mousemove",this.mouseMoveUnlocked,!1):(this.locked=!0,document.addEventListener("mousemove",this.mouseMoveLocked,!1)),document.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousewheel",this.mouseWheelEvent),document.addEventListener("DOMMouseScroll",this.mouseWheelEvent),this.lockMouseLook=function(){var t;Y&&((t=document.body).requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock()),this.isMouseLookLocked=!0},this.unLockMouseLook=function(){Y&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,document.exitPointerLock()),this.isMouseLookLocked=!1}}var K=function(){T.reset(),T.register_combo({keys:"w",on_keydown:function(){U=!0},on_release:function(){U=!1}}),T.register_combo({keys:"s",on_keydown:function(){W=!0},on_release:function(){W=!1}}),T.register_combo({keys:"d",on_keydown:function(){j=!0},on_release:function(){j=!1}}),T.register_combo({keys:"a",on_keydown:function(){D=!0},on_release:function(){D=!1}}),T.register_combo({keys:"k",on_keydown:function(){0},on_release:function(){0}}),T.register_combo({keys:"space",on_keydown:function(){V=!0,Lt.jump_count+=1,50===Lt.jump_count&&Ut.showCenterMessage("Jumping Hero! New quest available",3)},on_release:function(){V=!1}}),T.register_combo({keys:"c",on_release:function(){Lt&&Lt.parent&&(1!==Lt.parent.shipState&&-1!==Lt.parent.shipState||"Cancel (c)"!==ae.text()?3===Lt.parent.shipState&&de():(be.emit("exitIsland"),se.text("Countdown...")))}}),T.register_combo({keys:"z",on_release:function(){Lt&&Lt.parent&&(1===Lt.parent.shipState||-1===Lt.parent.shipState)&&$("#docking-modal-button").hasClass("enabled")&&(be.emit("anchor"),Dt=0,$("#docking-modal").hide(),$("#supply").tooltip("show"),"Labrador"===tt[Lt.parent.anchorIslandId].name&&$("#toggle-bank-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button").attr("data-tooltip","Deposit or withdraw gold"),$("#toggle-shop-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md disabled toggle-krew-list-modal-button").addClass("btn btn-md enabled toggle-krew-list-modal-button"),$("#exit-island-button").is(":visible")||$("#exit-island-button").show(),$("#recruiting-div").fadeIn("slow"),controls.unLockMouseLook())}}),T.register_combo({keys:"tab",on_release:function(){(Ee?$("#li-clan-chat").is(":visible")?fe:me:ke?me:ue)()}})};window.oncontextmenu=function(){return!1};var J,X,Y="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;Y?(J=document.body,X=function(t){document.pointerLockElement===J||document.mozPointerLockElement===J||document.webkitPointerLockElement===J?(controls.locked=!0,document.addEventListener("mousemove",controls.mouseMoveLocked,!1),document.removeEventListener("mousemove",controls.mouseMoveUnlocked,!1)):(controls.locked=!1,document.addEventListener("mousemove",controls.mouseMoveUnlocked,!1),document.removeEventListener("mousemove",controls.mouseMoveLocked,!1))},document.addEventListener("pointerlockchange",X,!1),document.addEventListener("mozpointerlockchange",X,!1),document.addEventListener("webkitpointerlockchange",X,!1)):console.log("ERROR: Your browser does seems to not support the pointer lock API.");function Q(t,e,i){return(1-i)*t+i*e}var Z,tt={},et={},it={},ot={},st={},nt={},at={},rt=1700,lt=(Z=new THREE.Frustum,function(t,e){return void 0!==t.position&&(e.updateMatrix(),e.updateMatrixWorld(),Z.setFromMatrix((new THREE.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),Z.containsPoint(t.position))});t.prototype.createProperties=function(){this.position=new THREE.Vector3(0,0,0),this.velocity=new THREE.Vector3(0,0,0),this.size=new THREE.Vector3(1,1,1),this.rotation=0,this.collisionRadius=1,this.parent=void 0,this.children={},this.isNew=!0,this.netType=-1,this.sendSnap=!0,this.sendDelta=!0,this.sendCreationSnapOnDelta=!0,this.last={},this.lastType={},this.muted=[],this.modelscale=new THREE.Vector3(1,1,1),this.modeloffset=new THREE.Vector3(0,0,0),this.modelrotation=new THREE.Vector3(0,0,0),this.baseGeometry=void 0,this.baseMaterial=void 0},t.prototype.tick=function(t){this.logic(t),this.position.x+=this.velocity.x*t,this.position.z+=this.velocity.z*t,this.clientlogic(t)},t.prototype.getSnap=function(t){if(t||this.sendSnap){void 0===this.rotation&&console.log(this);var e={p:this.parent?this.parent.id:void 0,n:this.netType,x:this.position.x.toFixed(2),y:this.position.y.toFixed(2),z:this.position.z.toFixed(2),r:(this.rotation||0).toFixed(2),t:this.getTypeSnap()};if(0==this.netType&&this.isNew){for(playerId in e.name=this.name,e.id=this.id,ot){var i=ot[playerId];i&&tt[playerId]&&tt[playerId].setName(i)}this.isNew=!1}return e}},t.prototype.getDelta=function(){if(this.sendDelta||this.sendCreationSnapOnDelta){if(this.sendCreationSnapOnDelta){var t=this.getSnap(!0);return this.sendCreationSnapOnDelta=!1,t}var e={p:this.deltaCompare("p",this.parent?this.parent.id:void 0),n:this.deltaCompare("n",this.netType),x:this.deltaCompare("x",Number(this.position.x.toFixed(2))),y:this.deltaCompare("y",Number(this.position.y.toFixed(2))),z:this.deltaCompare("z",Number(this.position.z.toFixed(2))),r:this.deltaCompare("r",Number(this.rotation.toFixed(2))),t:this.getTypeDelta()};return ct(e)&&(e=void 0),e}},t.prototype.parseSnap=function(t,e){var i,o,s;t.p&&tt[t.p]&&this.parent!=tt[t.p]&&(i=tt[t.p],o=this.parent,myPlayerId===e&&i!==o&&Ut.setActiveBtn(t.p),5!==i.netType&&(s=void 0!==this.geometry&&void 0!==i.geometry&&o&&void 0!==o.geometry?i.geometry.worldToLocal(o.geometry.localToWorld(this.geometry.position)):i.toLocal(this.worldPos()),this.position.x=s.x,this.position.y=s.y,this.position.z=s.z),i.addChildren(this),i.geometry.add(this.geometry),this.geometry.position.set(this.position.x,this.position.y,this.position.z),1===i.netType&&(i.krewMembers[this.id]=this.geometry.children[0]),Lt&&!1===Lt.isCaptain&&5===Lt.parent.netType&&5===i.netType&&void 0!==o&&1===o.netType&&1===o.shipState&&($("#abandon-ship-button").hide(),ie()),this.isPlayer&&this.parent&&!this.isCaptain&&1===this.parent.netType&&(3===this.parent.shipState&&($("#exit-island-button").hide(),$("#invite-div").hide()),$("#abandon-ship-button").show())),void 0!==t.t&&this.parseTypeSnap(t.t),this.isPlayer||(void 0!==t.x&&(this.position.x=parseFloat(t.x)),void 0!==t.y&&(this.position.y=parseFloat(t.y)),void 0!==t.z&&(this.position.z=parseFloat(t.z)),void 0!==t.r&&(this.rotation=parseFloat(t.r))),void 0!==t.del&&(this.onDestroy(),delete tt[this.id],delete ot[this.id]),void 0!==t.t&&void 0!==t.t.e&&null!==t.t.e&&(void 0!==t.t.e.l&&t.t.e.l!=this.level&&(this.level=parseInt(t.t.e.l)),this.isPlayer&&(void 0!==t.t.e.e&&t.t.e.e!=this.experience&&(this.experience=parseInt(t.t.e.e),this.experienceNeedsUpdate=!0,this.updateExperience()),void 0!==t.t.e.p.fr&&t.t.e.p.fr!=this.points.fireRate&&(this.points.fireRate=parseInt(t.t.e.p.fr)),void 0!==t.t.e.p.ds&&t.t.e.p.ds!=this.points.distance&&(this.points.distance=parseInt(t.t.e.p.ds)),void 0!==t.t.e.p.dm&&t.t.e.p.dm!=this.points.damage&&(this.points.damage=parseInt(t.t.e.p.dm))))},t.prototype.addChildren=function(t){(this.children[t.id]=t).parent=this},t.prototype.hasChild=function(t){for(key in this.children)if(this.children[key].id==t)return!0;return!1},t.prototype.deltaCompare=function(t,e){if(this.last[t]!==e&&this.muted.indexOf(t)<0)return this.last[t]=e},t.prototype.deltaTypeCompare=function(t,e){if(this.lastType[t]!==e)return this.lastType[t]=e},t.prototype.worldPos=function(){var t=new THREE.Vector3;return t.copy(this.position),void 0!==this.parent&&(t.applyAxisAngle(new THREE.Vector3(0,1,0),this.parent.rotation),t.add(this.parent.worldPos())),t},t.prototype.toLocal=function(t){var e=new THREE.Vector3;return e.copy(t),e.sub(this.position),e.applyAxisAngle(new THREE.Vector3(0,1,0),-this.rotation),e},t.prototype.onDestroy=function(){var t;null==this.parent||null!=(t=this.parent).children[this.id]&&delete t.children[this.id],this.onClientDestroy(),void 0!==st[this.id]&&delete st[this.id],void 0!==nt[this.id]&&delete nt[this.id]};var ct=function(t){if(0===Object.keys(t).length&&t.constructor===Object)return!0;for(p in t)if(t.hasOwnProperty(p)&&void 0!==t[p])return!1;return!0},ht={rum:{drainRate:0,cargoSpace:5},coffee:{drainRate:0,cargoSpace:8},spice:{drainRate:0,cargoSpace:8},silk:{drainRate:0,cargoSpace:12}},dt={0:{id:0,name:"Wood Plank",hp:25,turnspeed:1,price:501,maxKrewCapacity:1,cargoSize:50,baseheight:1.4,width:4,depth:5.5,arcFront:0,inertia:.1,radius:5,speed:6.5,labelHeight:7,regeneration:1,body:"raft",sail:void 0,scale:[1.2,1,1.5],offset:[0,-1,0],rotation:[0,0,0]},1:{id:1,image:'<img src="./assets/img/raft.png" style="height: 30px">',name:"Raft 1",hp:75,turnspeed:1.2,price:500,maxKrewCapacity:1,cargoSize:200,baseheight:1.4,width:4,depth:5.5,arcFront:.3,inertia:.1,radius:5,speed:6,labelHeight:10,regeneration:1,body:"raft",sail:"raft",scale:[1.7,1.7,1.7],offset:[0,-1,0],rotation:[0,0,0]},2:{id:2,image:'<img src="./assets/img/raft.png" style="height: 35px">',name:"Raft 2",hp:150,turnspeed:1,price:1300,maxKrewCapacity:2,cargoSize:300,baseheight:1.4,width:4.5,depth:6,arcFront:.3,inertia:.1,radius:5,speed:5.9,labelHeight:10,regeneration:1,body:"raft",sail:"raft",scale:[1.7,1.7,1.7],offset:[0,-1,0],rotation:[0,0,0]},3:{id:3,image:'<img src="./assets/img/raft.png" style="height: 40px">',name:"Raft 3",hp:200,turnspeed:.9,price:2400,maxKrewCapacity:3,cargoSize:400,baseheight:1.4,width:5,depth:6.5,arcFront:.3,inertia:.1,radius:5,speed:5.8,labelHeight:10,regeneration:1,body:"raft",sail:"raft",scale:[1.7,1.7,1.7],offset:[0,-1,0],rotation:[0,0,0]},4:{id:4,image:'<img src="./assets/img/trader.png" style="height: 30px">',name:"Trader 1",hp:400,turnspeed:.5,price:4350,maxKrewCapacity:4,cargoSize:2e3,baseheight:3,width:7,depth:12.5,arcFront:.3,inertia:.5,radius:10,speed:5.4,labelHeight:12,regeneration:1,body:"trader",sail:"trader",scale:[5.5,5.5,5.5],offset:[0,-4.5,1],rotation:[0,0,0]},5:{id:5,image:'<img src="./assets/img/boat.png" style="height: 30px">',name:"Boat 1",hp:450,turnspeed:.7,price:6900,maxKrewCapacity:5,cargoSize:500,baseheight:3,width:7,depth:12.5,arcFront:.3,inertia:.5,radius:10,speed:5.8,labelHeight:12,regeneration:1,body:"boat",sail:"boat",scale:[5,5,5],offset:[0,-4.5,1],rotation:[0,0,0]},6:{id:6,image:'<img src="./assets/img/boat.png" style="height: 35px">',name:"Boat 2",hp:600,turnspeed:.7,price:11e3,maxKrewCapacity:6,cargoSize:600,baseheight:3,width:7,depth:12.5,arcFront:.3,inertia:.5,radius:10,speed:5.9,labelHeight:12,regeneration:1,body:"boat",sail:"boat",scale:[5,5,5],offset:[0,-4.5,1],rotation:[0,0,0]},7:{id:7,image:'<img src="./assets/img/boat.png" style="height: 40px">',name:"Boat 3",hp:750,turnspeed:.7,price:16e3,maxKrewCapacity:7,cargoSize:700,baseheight:3,width:7,depth:12.5,arcFront:.3,inertia:.5,radius:10,speed:6,labelHeight:12,regeneration:1,body:"boat",sail:"boat",scale:[5,5,5],offset:[0,-4.5,1],rotation:[0,0,0]},8:{id:8,image:'<img src="./assets/img/destroyer.png" style="height: 35px">',name:"Destroyer 1",hp:1200,turnspeed:.7,price:5e4,maxKrewCapacity:12,cargoSize:1e3,baseheight:5,width:11.5,depth:26,arcFront:.1,inertia:1,radius:15,speed:5.9,labelHeight:21,regeneration:1,body:"destroyer",sail:"destroyer",scale:[6,6,6],offset:[0,-8,0],rotation:[0,0,0]},9:{id:9,image:'<img src="./assets/img/destroyer.png" style="height: 40px">',name:"Destroyer 2",hp:1800,turnspeed:.7,price:8e4,maxKrewCapacity:14,cargoSize:1300,baseheight:5,width:11.5,depth:26,arcFront:.1,inertia:1,radius:15,speed:5.8,labelHeight:21,regeneration:1,body:"destroyer",sail:"destroyer",scale:[6,6,6],offset:[0,-8,0],rotation:[0,0,0]},10:{id:10,image:'<img src="./assets/img/destroyer.png" style="height: 45px">',name:"Destroyer 3",hp:2600,turnspeed:.7,price:13e4,maxKrewCapacity:16,cargoSize:1600,baseheight:5,width:11.5,depth:26,arcFront:.1,inertia:1,radius:15,speed:5.7,labelHeight:21,regeneration:1,body:"destroyer",sail:"destroyer",scale:[6,6,6],offset:[0,-8,0],rotation:[0,0,0]},11:{id:11,image:'<img src="./assets/img/baby_fancy.png" style="height: 35px">',name:"Baby Fancy",hp:300,turnspeed:1,price:8e3,maxKrewCapacity:3,cargoSize:300,baseheight:1.4,width:4,depth:6.5,arcFront:.3,inertia:.1,radius:8,speed:5.9,labelHeight:10,regeneration:.5,body:"sloop",sail:"sloop",mast:"sloop",scale:[.15,.18,.12],offset:[0,5.5,0],rotation:[0,0,0],availableAt:["Spain","Brazil"]},12:{id:12,image:'<img src="./assets/img/royal_fortune.png" style="height: 35px">',name:"Royal Fortune",hp:1e3,turnspeed:.5,price:7e4,maxKrewCapacity:15,cargoSize:1200,baseheight:4,width:10,depth:26,arcFront:.3,inertia:.5,radius:15,speed:6,labelHeight:12,regeneration:1,body:"schooner",sail:"schooner",mast:"schooner",scale:[.15,.15,.15],offset:[2,11.6,3],rotation:[0,Math.PI/2,0],availableAt:["Labrador","Spain"]},13:{id:13,image:'<img src="./assets/img/calm_spirit.png" style="height: 35px">',name:"Calm Spirit",hp:1800,turnspeed:.7,price:12e4,maxKrewCapacity:18,cargoSize:2e3,baseheight:4,width:10,depth:30,arcFront:.3,inertia:.5,radius:16,speed:5.9,labelHeight:12,regeneration:1,body:"vessel",sail:"vessel",mast:"vessel",scale:[.1,.1,.1],offset:[1,10,5],rotation:[0,Math.PI/2,0],availableAt:["Spain","Guinea"]},14:{id:14,image:'<img src="./assets/img/QBJ.png" style="height: 45px">',name:"Queen Barb's Justice",hp:3e3,turnspeed:.7,price:2e5,maxKrewCapacity:20,cargoSize:3e3,baseheight:5,width:8,depth:38,arcFront:.1,inertia:1,radius:20,speed:5.9,labelHeight:21,regeneration:1,body:"bigship",sail:"bigship",mast:"bigship",scale:[.1,.1,.1],offset:[1,13.4,1],rotation:[0,Math.PI/2,0],availableAt:["Spain"]},15:{id:15,image:'<img src="./assets/img/trader.png" style="height: 35px">',name:"Trader 2",hp:500,turnspeed:.5,price:11e3,maxKrewCapacity:6,cargoSize:4e3,baseheight:3,width:7,depth:12.5,arcFront:.3,inertia:.5,radius:10,speed:5.5,labelHeight:12,regeneration:1,body:"trader",sail:"trader",scale:[5.5,5.5,5.5],offset:[0,-4.5,1],rotation:[0,0,0],availableAt:["Jamaica"]},16:{id:16,image:'<img src="./assets/img/trader.png" style="height: 40px">',name:"Trader 3",hp:750,turnspeed:.5,price:3e4,maxKrewCapacity:6,cargoSize:6e3,baseheight:3,width:7,depth:12.5,arcFront:.3,inertia:.5,radius:10,speed:5.5,labelHeight:12,regeneration:1,body:"trader",sail:"trader",scale:[5.5,5.5,5.5],offset:[0,-4.5,1],rotation:[0,0,0],availableAt:["Jamaica"]},17:{id:17,image:'<img src="./assets/img/baby_fancy.png" style="height: 40px">',name:"Baby Fancy 2",hp:500,turnspeed:1,price:4e4,maxKrewCapacity:3,cargoSize:400,baseheight:1.4,width:4.5,depth:7,arcFront:.3,inertia:.1,radius:8,speed:5.8,labelHeight:10,regeneration:.5,body:"sloop",sail:"sloop",mast:"sloop",scale:[.15,.18,.12],offset:[0,5.5,0],rotation:[0,0,0],availableAt:["Jamaica"]},18:{id:18,image:'<img src="./assets/img/royal_fortune.png" style="height: 40px">',name:"Royal Fortune 2",hp:1300,turnspeed:.6,price:11e4,maxKrewCapacity:18,cargoSize:1400,baseheight:4,width:10,depth:26,arcFront:.3,inertia:.5,radius:15,speed:5.9,labelHeight:12,regeneration:1,body:"schooner",sail:"schooner",mast:"schooner",scale:[.15,.15,.15],offset:[2,11.6,3],rotation:[0,Math.PI/2,0],availableAt:["Jamaica"]},19:{id:19,image:'<img src="./assets/img/calm_spirit.png" style="height: 45px">',name:"Calm Spirit 2",hp:2200,turnspeed:.7,price:17e4,maxKrewCapacity:20,cargoSize:2600,baseheight:4,width:10,depth:30,arcFront:.3,inertia:.5,radius:16,speed:5.8,labelHeight:12,regeneration:1,body:"vessel",sail:"vessel",mast:"vessel",scale:[.1,.1,.1],offset:[1,10,5],rotation:[0,Math.PI/2,0],availableAt:["Jamaica"]},20:{id:20,image:'<img src="./assets/img/QBJ.png" style="height: 50px">',name:"Queen Barb's Justice 2",hp:4e3,turnspeed:.7,price:35e4,maxKrewCapacity:25,cargoSize:4e3,baseheight:5,width:8,depth:38,arcFront:.1,inertia:1,radius:20,speed:5.8,labelHeight:21,regeneration:1,body:"bigship",sail:"bigship",mast:"bigship",scale:[.1,.1,.1],offset:[1,13.4,1],rotation:[0,Math.PI/2,0],availableAt:["Jamaica"]}};((r.prototype=new t).constructor=r).prototype.updateProps=function(){var t,e=0;for(var i in this.children){void 0!==tt[i]&&void 0!==tt[i].parent&&tt[i].parent.id===this.id?(t=this.children[i])&&0===t.netType&&(e+=1):delete this.children[i]}this.krewCount=e,0===this.krewCount&&ut(this)},r.prototype.setName=function(t){var e="";if(void 0!==this.clan&&""!==this.clan&&(e="["+this.clan+"] "),void 0!==this.geometry){if(void 0===this.label){this.label=new THREE.TextSprite({textSize:4,redrawInterval:CONFIG.Labels.redrawInterval,texture:{text:e+t,fontFamily:CONFIG.Labels.fontFamily},material:{color:12952444,fog:!1}}),this.label.name="label",this.label.position.set(0,dt[this.shipclassId].labelHeight,0);for(var i=this.geometry.children.length;i--;)this.geometry.children[i].isTextSprite&&"label"===this.geometry.children[i].name&&this.geometry.remove(this.geometry.children[i]);this.geometry.add(this.label)}this.label.material.map.text=e+t,this.label.visible=Lt&&Lt.parent&&this.id!==Lt.parent.id&&this[CONFIG.Labels.boats.useMethod]}this.crewName=t},r.prototype.logic=function(t){this.position.x>rt&&(this.position.x=rt),this.position.z>rt&&(this.position.z=rt),this.position.x<0&&(this.position.x=0),this.position.z<0&&(this.position.z=0);var e=tt[this.captainId];void 0!==e&&void 0!==this.crewName&&(this.speed=dt[this.shipclassId].speed+parseFloat(e.movementSpeedBonus/100));var i=new THREE.Vector3(0,0,this.speed);0==this.shipState?(this.rotation+=void 0!==e?this.steering*t*.4*(this.turnspeed+parseFloat(.05*e.movementSpeedBonus/100)):this.steering*t*.4*this.turnspeed,i.applyAxisAngle(new THREE.Vector3(0,1,0),this.rotation)):i.set(0,0,0),this.velocity=i,this.leanvalue+=(4*this.steering-this.leanvalue)*t,this.rottimer+=t,Lt&&Lt.parent&&this.sail&&(this.sail.material.visible=this.id!==Lt.parent.id),Lt&&Lt.parent&&this.mast&&(this.mast.material.visible=this.id!==Lt.parent.id),!this.body||3!==this.shipState&&-1!==this.shipState&&4!==this.shipState?(this.body.material.opacity=1,this.sail&&(this.sail.material.opacity=.9),this.mast&&(this.mast.material.opacity=.9)):(this.rottimer=0,this.leanvalue=0,.5<=this.body.material.opacity&&(this.body.material.opacity-=.0075),this.sail&&.5<=this.sail.material.opacity&&(this.sail.material.opacity-=.0075),this.mast&&.5<=this.mast.material.opacity&&(this.mast.material.opacity-=.0075)),this.geometry.rotation.x=Math.sin(.5*this.rottimer+3)*Math.sin(this.rottimer)*.05,this.geometry.rotation.z=.05*Math.sin(+this.rottimer)-.08*this.leanvalue,this.hp<=0&&(Lt&&Lt.parent==this&&(THREE.SceneUtils.detach(It,It.parent,Rt),$("#shopping-modal").hide(),$("#show-shopping-modal-button").hide()),this.sinktimer+=t,4<this.sinktimer&&ut(this))},r.prototype.clientlogic=function(){this.position.y=this.getHeightAboveWater();var t=new THREE.Vector3(this.position.x,this.position.y,this.position.z);this.geometry.position.lerp(t,.8),this.geometry.rotation.y=Q(this.geometry.rotation.y,this.rotation,.5)},r.prototype.setShipClass=function(t){this.shipclassId=t;var e=dt[t];this.maxHp=e.hp,this.hp=this.maxHp,this.turnspeed=e.turnspeed,this.maxKrewCapacity=e.maxKrewCapacity,this.size.set(e.width,e.height,e.depth),this.arcFront=e.arcFront,this.inertia=e.inertia,this.collisionRadius=e.radius,this.speed=e.speed,this.shipState=2,this.changeBoatModel(this.shipclassId),null!=Lt&&this==Lt.parent&&(Ut.showCenterMessage("Ship upgraded to "+dt[this.shipclassId].name,3),Ut.updateStore($(".btn-shopping-modal.active")))},r.prototype.getKrewOnBoard=function(){for(var t in this.children)this.children[t].parent&&this.children[t].parent.id===this.id&&(this.geometry.add(this.children[t].geometry),this.children[t].position.x=0,this.children[t].position.y=0,this.children[t].position.z=0),void 0!==this.children[t].parent&&this.children[t].parent.id===this.id||delete this.children[t]},r.prototype.getTypeSnap=function(){return{h:this.hp,s:this.steering,c:this.shipclassId,u:this.supply,b:this.captainId,t:this.shipState,a:this.anchorIslandId,k:this.krewCount,e:this.speed,r:this.recruiting,l:this.isLocked,d:this.departureTime}},r.prototype.getTypeDelta=function(){var t={h:this.deltaTypeCompare("h",this.hp),s:this.deltaTypeCompare("s",this.steering.toFixed(4)),c:this.deltaTypeCompare("c",this.shipclassId),u:this.deltaTypeCompare("u",this.supply),b:this.deltaTypeCompare("b",this.captainId),t:this.deltaTypeCompare("t",this.shipState),a:this.deltaTypeCompare("a",this.anchorIslandId),k:this.deltaTypeCompare("k",this.krewCount),e:this.deltaTypeCompare("e",this.speed),r:this.deltaTypeCompare("r",this.recruiting),l:this.deltaTypeCompare("l",this.isLocked),d:this.deltaTypeCompare("d",this.departureTime)};return ct(t)&&(t=void 0),t},r.prototype.parseTypeSnap=function(t){var e,i;void 0!==t.h&&t.h!=this.hp&&(this.hp=parseInt(t.h)),void 0!==t.s&&(this.steering=parseFloat(t.s)),void 0!==t.u&&(e=parseInt(t.u),!Lt||this!=Lt.parent||e==this.supply||1<(i=e-this.supply)&&Ut.showCenterMessage("+ "+i+" supplies",2),this.supply=e),(void 0!==t.c&&t.c!=this.shipclassId||null==this.body)&&this.setShipClass(t.c),void 0!==t.a&&t.a!=this.anchorIslandId&&(this.anchorIslandId=t.a),void 0!==t.k&&t.k!=this.krewCount&&(this.krewCount=t.k),void 0!==t.b&&this.captainId!=t.b&&(this.captainId=t.b),void 0!==t.e&&this.speed!=t.e&&(this.speed=parseInt(t.e)),void 0!==t.r&&this.recruiting!=t.r&&(this.recruiting=pt(t.r)),void 0!==t.l&&this.isLocked!=t.r&&(this.isLocked=pt(t.l)),void 0!==t.d&&this.departureTime!=t.d&&(this.departureTime=parseInt(t.d)),void 0!==t.t&&this.shipState!=t.t&&(this.shipState=parseInt(t.t),0===this.shipState&&this.getKrewOnBoard())},r.prototype.onDestroy=function(){this.children={},t.prototype.onDestroy.call(this),et[this.id]&&delete et[this.id]},r.prototype.getHeightAboveWater=function(){return dt[this.shipclassId].baseheight*(.2+this.hp/this.maxHp*.8)-this.sinktimer},r.prototype.enterIsland=function(t){0===this.shipState&&(this.shipState=1),this.anchorIslandId=t},r.prototype.exitIsland=function(){var t;this.shipState=0,this.recruiting=!1,this.departureTime=5,this.anchorIslandId&&(this.rotation=a(this,tt[this.anchorIslandId]),t=n(this.rotation),this.position.x=tt[this.anchorIslandId].position.x-t.x*(tt[this.anchorIslandId].dockRadius+5),this.position.z=tt[this.anchorIslandId].position.z-t.y*(tt[this.anchorIslandId].dockRadius+5)),this.anchorIslandId=void 0},r.prototype.exitMotherShip=function(t){this.rotation=a(this,t);var e=n(this.rotation);this.position.x=t.position.x-e.x*(t.collisionRadius+5),this.position.z=t.position.z-e.y*(t.collisionRadius+5)},(c.prototype.constructor=c).prototype.logic=function(t){},((h.prototype=new t).constructor=h).prototype.notifiscation=function(){for(var t in this.notifiscationHeap)this.notifiscationHeap[t].isNew?(this.notifiscationHeap[t].sprite=new THREE.TextSprite({textSize:1===this.notifiscationHeap[t].type?.6:.9,redrawInterval:10,texture:{text:this.notifiscationHeap[t].text,fontFamily:CONFIG.Labels.fontFamily},material:{color:1===this.notifiscationHeap[t].type?16766720:6487808,fog:!1,opacity:0}}),this.notifiscationHeap[t].sprite.position.set(3,1,0),this.geometry.add(this.notifiscationHeap[t].sprite),this.notifiscationHeap[t].isNew=!1):(this.notifiscationHeap[t].sprite.position.y+=.05,6<this.notifiscationHeap[t].sprite.position.y?(this.geometry.remove(this.notifiscationHeap[t].sprite),delete this.notifiscationHeap[t]):this.notifiscationHeap[t].sprite.position.y<3&&(this.notifiscationHeap[t].sprite.material.opacity+=.025))},h.prototype.updateExperience=function(t){var e,i=this.experience,o=0;for(e in"number"==typeof t&&(i+=this.pointsFormula.getExperience(t)),i>this.experienceNeededForLevels[this.experienceMaxLevel].total&&(i=this.experienceNeededForLevels[this.experienceMaxLevel].total),this.experienceNeededForLevels){if(i<this.experienceNeededForLevels[e].total)break;o=e}o=parseInt(o),this.level=o,this.experience=i,void 0!==Ut&&this.experienceNeedsUpdate&&(Ut.updateUiExperience(),this.experienceNeedsUpdate=!1)},h.prototype.rotationOffset=-.45,h.prototype.logic=function(t){this.oldCaptainState=this.isCaptain,this.isCaptain=this.parent&&this.id===this.parent.captainId;var e,i,o=new THREE.Vector3(0,0,0);o.z=-this.walkForward,o.x=this.walkSideward,0<o.lengthSq()&&o.normalize(),o.applyAxisAngle(new THREE.Vector3(0,1,0),this.rotation),this.velocity=o,this.velocity.x*=3,this.velocity.z*=3,this.parent&&(5!==this.parent.netType&&3!==this.parent.shipState&&-1!==this.parent.shipState||(this.velocity.x*=2,this.velocity.z*=2),5!==this.parent.netType&&3!==this.parent.shipState&&2!==this.parent.shipState&&-1!==this.parent.shipState&&4!==this.parent.shipState&&(this.position.x>this.parent.size.x/2&&(this.position.x=this.parent.size.x/2),this.position.z>this.parent.size.z/2&&(this.position.z=this.parent.size.z/2),this.position.x<-this.parent.size.x/2&&(this.position.x=-this.parent.size.x/2),this.position.z<-this.parent.size.z/2&&(this.position.z=-this.parent.size.z/2),0<this.parent.arcFront&&0<this.position.z))&&(e=this.parent.size.x/2-this.position.z*this.parent.arcFront,0<this.position.x?this.position.x>e&&(this.position.x=e):this.position.x<-e&&(this.position.x=-e)),0<this.cooldown&&(this.cooldown-=t),!0===this.use&&this.cooldown<=0&&(i=parseFloat((this.attackSpeedBonus+this.pointsFormula.getFireRate())/100),this.cooldown=1===this.activeWeapon?2:(1.5-i).toFixed(2)),this.isPlayer||(this.geometry.rotation.x=this.pitch+this.rotationOffset)},h.prototype.getTypeSnap=function(){return{f:this.walkForward,s:this.walkSideward,u:this.use,p:this.pitch,j:this.jumping,m:this.movementSpeedBonus,g:this.armorBonus,w:this.activeWeapon,c:this.checkedItemsList,d:this.itemId,o:this.ownsCannon,r:this.ownsFishingRod,v:this.availablePoints,e:{e:this.experience,p:{fr:this.fireRate,ds:this.distance,dm:this.damage},l:this.level}}},h.prototype.getTypeDelta=function(){var t={f:this.deltaTypeCompare("f",this.walkForward),s:this.deltaTypeCompare("s",this.walkSideward),u:this.deltaTypeCompare("u",this.use),p:this.deltaTypeCompare("p",this.pitch.toFixed(2)),j:this.deltaTypeCompare("j",this.jumping),w:this.deltaTypeCompare("w",this.activeWeapon),c:this.deltaTypeCompare("c",this.checkedItemsList),d:this.deltaTypeCompare("d",this.itemId),o:this.deltaTypeCompare("o",this.ownsCannon),r:this.deltaTypeCompare("r",this.ownsFishingRod),v:this.deltaTypeCompare("v",this.availablePoints)};return ct(t)&&(t=void 0),t},h.prototype.setName=function(t){var e="";void 0!==this.clan&&""!==this.clan&&(e="["+this.clan+"] "),void 0!==this.geometry&&(void 0===this.label&&(this.label=new THREE.TextSprite({textSize:.7,redrawInterval:CONFIG.Labels.redrawInterval,texture:{text:e+t+" (lvl "+this.level+")",fontFamily:CONFIG.Labels.fontFamily},material:{color:this.isPlayer?C.myself:this.isCaptain?C.captain:C.player,fog:!1}}),this.label.name="label",this.label.position.set(0,2,0),this.geometry.add(this.label)),this.label.material.map.text=e+t+" (lvl "+this.level+")",this.label.visible=Lt&&Lt.parent&&this.inRange&&void 0!==this.parent&&(5===this.parent.netType||this.parent.inRange)),this.name=t},h.prototype.getName=function(){return this.name},h.prototype.parseTypeSnap=function(t){void 0!==t.f&&(this.walkForward=parseInt(t.f)),void 0!==t.s&&(this.walkSideward=parseInt(t.s)),void 0!==t.u&&(this.use=pt(t.u)),void 0!==t.p&&(this.pitch=parseFloat(t.p)),void 0!==t.j&&(this.jumping=parseInt(t.j)),void 0!==t.m&&(this.movementSpeedBonus=parseInt(t.m)),void 0!==t.v&&t.v!==this.availablePoints&&(this.availablePoints=parseInt(t.v)),void 0!==t.o&&t.o!==this.ownsCannon&&(this.ownsCannon=pt(t.o),void 0!==Ut&&Ut.updateStore($(".btn-shopping-modal.active"))),void 0!==t.r&&t.r!==this.ownsFishingRod&&(this.ownsFishingRod=pt(t.r),void 0!==Ut&&Ut.updateStore($(".btn-shopping-modal.active"))),void 0!==t.c&&t.c!==this.checkedItemsList&&(this.checkedItemsList=pt(t.c)),void 0!==t.d&&t.d!=this.itemId&&(this.itemId=parseInt(t.d),void 0!==Ut&&Ut.updateStore($(".btn-shopping-modal.active"))),void 0!==t.w&&t.w!==this.activeWeapon&&(this.activeWeapon=parseInt(t.w),this.changeWeapon()),void 0===t.f&&void 0===t.s&&void 0===t.u&&void 0===t.p||(this.lastMoved=new Date)},h.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this===Lt&&(Lt=void 0),this.parent&&(delete this.parent.children[this.id],1===this.parent.netType&&(this.parent.updateProps(),0===Object.keys(this.parent.children).length&&ut(this.parent))),it[this.id]&&delete it[this.id]},h.prototype.setPlayerBody=function(t){var e=Ct[t=t||0];this.playerBody=e.body.clone(),this.playerBody.scale.set(e.scale.x,e.scale.y,e.scale.z),this.playerBody.position.set(e.offset.x,e.offset.y,e.offset.z),this.playerBody.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),this.geometry.add(this.playerBody),this.weapon=A.cannon.clone(),this.weapon.scale.set(.05,.05,.05),this.weapon.position.set(0,0,-.4),this.weapon.rotation.set(0,0,0),this.weapon.name="body",this.geometry.add(this.weapon),this.captainHat=A.hat_pirate.clone(),this.captainHat.scale.set(.4,.4,.4),this.captainHat.position.set(0,25,0),this.captainHat.name="captainHat"},h.prototype.crossHair=function(){this.crosshair=new THREE.TextSprite({textSize:.0365,redrawInterval:10,texture:{text:"+",fontFamily:CONFIG.Labels.fontFamily},material:{color:65280,fog:!1}})},h.prototype.changeWeapon=function(){var t;this.weapon&&0===this.activeWeapon?(this.geometry.remove(this.weapon),this.weapon=A.cannon.clone(),this.weapon.scale.set(.05,.05,.05),this.weapon.position.set(0,.1,-.4),this.weapon.rotation.set(0,0,0),this.weapon.name="body",this.geometry.add(this.weapon)):this.weapon&&1===this.activeWeapon&&(this.geometry.remove(this.weapon),t=new THREE.Mesh(x.fishingrod,E.fishingrod),this.weapon=t.clone(),this.weapon.scale.set(.03,.03,.03),this.weapon.position.set(0,.1,-.2),this.weapon.rotation.set(0,Math.PI,0),this.weapon.name="body",this.geometry.add(this.weapon))};var pt=function(t){return!0===t||"true"===t};((d.prototype=new t).constructor=d).prototype.logic=function(t){this.timeout-=.8*t,this.timeout<=0&&ut(this)},d.prototype.clientlogic=function(t){var e;0==this.impactType&&(this.geometry.position.set(this.position.x,this.position.y,this.position.z),this.geometry.scale.y=5*(this.timeout<.5?ge.easeOutQuad(2*this.timeout):1-ge.easeInQuint(2*(this.timeout-.5))),e=ge.easeOutQuad(this.timeout),this.geometry.scale.x=1.5-e,this.geometry.scale.z=1.5-e)},d.prototype.getTypeSnap=function(){return{a:this.impactType}},d.prototype.getTypeDelta=function(){if(!this.spawnPacket)return this.spawnPacket=!0,this.getTypeSnap()},d.prototype.parseTypeSnap=function(t){void 0!==t.a&&(this.impactType=parseFloat(t.a))},((u.prototype=new t).constructor=u).prototype.randomTime=function(t,e){return 1e3*(Math.floor(Math.random()*(e-t))+t)},u.prototype.logic=function(t){},u.prototype.timeCounters={},u.prototype.dockedLogic=function(){void 0===this.timeCounters.dockedLogic?this.timeCounters.dockedLogic={time:performance.now(),previousTime:performance.now()}:this.timeCounters.dockedLogic.time=performance.now(),2e3<this.timeCounters.dockedLogic.time-this.timeCounters.dockedLogic.previousTime&&(this.timeCounters.dockedLogic.previousTime=this.timeCounters.dockedLogic.time,requestAnimationFrame(function(){for(var t in tt){var e=tt[t];if(4===e.netType&&(2===e.type||3===e.type)){var i,o,s,n=new THREE.Raycaster,a=[],r={object:void 0,height:100},l=0,c=0;if(tt){for(var h in o=new THREE.Vector3(0,-1,0),(i=e.geometry.position.clone()).set(i.x,100,i.z),n.set(i,o),tt)5===tt[h].netType&&a.push(tt[h].geometry.children[0]);if(0<(s=n.intersectObjects(a)).length){for(;l<s.length;l++)s[l].distance<r.height&&(r={height:s[l].distance,object:s[l].object});c=100-r.height}e.position.y=c,e.actualY=c,e.geometry.position.setY(c)}}}}))},u.prototype.clientlogic=function(t){var e;this.floattimer+=3*t,this.geometry.rotation.x+=t*this.rotationspeed,this.geometry.rotation.z+=t*this.rotationspeed,1==this.picking&&tt[this.pickerId]?tt[this.pickerId].geometry&&(e=tt[this.pickerId].geometry.getWorldPosition(),0!==this.type&&4!==this.type||(this.geometry.translateOnAxis(this.geometry.worldToLocal(e),.05),this.geometry.scale.set(this.geometry.scale.x-.05,this.geometry.scale.y-.05,this.geometry.scale.z-.05)),1===this.type&&(this.catchingFish?this.geometry.translateOnAxis(this.geometry.worldToLocal(e),.05):this.geometry.position.y+=.5,20<=this.geometry.position.y&&(this.catchingFish=!0),this.geometry.scale.set(this.geometry.scale.x-.009,this.geometry.scale.y-.009,this.geometry.scale.z-.009)),2===this.type&&(this.geometry.translateOnAxis(this.geometry.worldToLocal(e),.05),this.geometry.scale.set(this.geometry.scale.x-.05,this.geometry.scale.y-.05,this.geometry.scale.z-.05),void 0!==tt[this.pickerId]&&500<tt[this.pickerId].gold&&(!tt[this.pickerId].ownsCannon||!tt[this.pickerId].ownsFishingRod||void 0!==tt[this.pickerId].parent&&1!=tt[this.pickerId].parent.netType)&&(Ut.hideSuggestionBox=!1)),3===this.type&&(this.geometry.translateOnAxis(this.geometry.worldToLocal(e),.05),this.geometry.scale.set(this.geometry.scale.x-.05,this.geometry.scale.y-.05,this.geometry.scale.z-.05),void 0!==tt[this.pickerId]&&500<tt[this.pickerId].gold&&(!tt[this.pickerId].ownsCannon||!tt[this.pickerId].ownsFishingRod||void 0!==tt[this.pickerId].parent&&1!=tt[this.pickerId].parent.netType)&&(Ut.hideSuggestionBox=!1))):(this.type,2!==this.type&&3!==this.type||this.dockedLogic(),3===this.type&&void 0!==this.geometry&&(Math.round(this.geometry.position.x)===Math.round(this.position.x)&&Math.round(this.geometry.position.z)===Math.round(this.position.z)||(this.geometry.lookAt(this.position.x,this.actualY||this.position.y,this.position.z),Math.round(this.geometry.position.x)!==Math.round(this.position.x)&&this.geometry.position.setX(Q(this.geometry.position.x,this.position.x,.01)),Math.round(this.geometry.position.z)!==Math.round(this.position.z)&&this.geometry.position.setZ(Q(this.geometry.position.z,this.position.z,.01)))))},u.prototype.setName=function(){void 0!==this.geometry&&(void 0===this.label&&(this.label=new THREE.TextSprite({textSize:3,redrawInterval:CONFIG.Labels.redrawInterval,texture:{text:this.id,fontFamily:CONFIG.Labels.fontFamily},material:{color:C.player,fog:!1}}),this.label.name="label",this.label.position.set(0,3,0),this.geometry.add(this.label)),this.label.material.map.text=this.id)},u.prototype.getTypeSnap=function(){return{s:this.pickupSize,p:this.picking,i:this.pickerId,t:this.type}},u.prototype.getTypeDelta=function(){if(1!=this.type){var t={s:this.deltaTypeCompare("s",this.pickupSize),p:this.deltaTypeCompare("p",this.picking),i:this.deltaTypeCompare("i",this.pickerId),t:this.deltaTypeCompare("t",this.type)};return ct(t)&&(t=void 0),t}if(!this.spawnPacket)return this.spawnPacket=!0,this.getTypeSnap()},u.prototype.parseTypeSnap=function(t){void 0!==t.s&&t.s!=this.pickupSize&&(this.pickupSize=parseInt(t.s)),void 0!==t.p&&t.p!=this.picking&&(this.picking=pt(t.p)),void 0!==t.i&&t.i!=this.pickerId&&(this.pickerId=t.i),void 0!==t.t&&t.t!=this.type&&(this.type=parseInt(t.t))},u.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),at[this.id]&&delete at[this.id]},((m.prototype=new t).constructor=m).prototype.setName=function(t){void 0!==this.geometry&&(void 0===this.label&&(this.label=new THREE.TextSprite({textSize:12,redrawInterval:CONFIG.Labels.redrawInterval,texture:{text:t,fontFamily:CONFIG.Labels.fontFamily},material:{color:6198824,fog:!1}}),this.label.name="label",this.label.position.set(0,42,0),this.geometry.add(this.label)),this.label.material.map.text=t,this.label.visible=this.inRange),this.name=t},m.prototype.getTypeSnap=function(){return{t:this.landmarkType,name:this.name,dockRadius:this.dockRadius}},m.prototype.parseTypeSnap=function(t){void 0!==t.t&&(this.pickupSize=parseInt(t.t))},m.prototype.clientlogic=function(t){this.wavetimer+=t;var e=.5+.5*Math.sin(this.wavetimer);water.position.y=.1+.5*e},m.prototype.logic=function(t){this.dockType},m.prototype.isWithinDockingRadius=function(t,e){return s({x:t,z:e},this.position)<this.dockRadius-2},((f.prototype=new t).constructor=f).prototype.logic=function(t){if(""===this.shooterid||void 0===tt[this.shooterid]||void 0!==tt[this.shooterid]&&-1!=this.type&&this.type!=tt[this.shooterid].activeWeapon)return this.impact&&(this.impact.destroy=!0),void ut(this);var e;void 0!==tt[this.shooterid]&&0==tt[this.shooterid].use&&(tt[this.shooterid].isFishing=!1),0<=this.position.y&&(this.velocity.y-=25*t,this.position.y+=this.velocity.y*t),void 0!==tt[this.shooterid]&&void 0!==tt[this.shooterid].parent&&(e=tt[this.shooterid].worldPos(),void 0!==tt[this.shooterid].parent&&5===tt[this.shooterid].parent.netType?e.z.toFixed(2)!=this.shooterStartPos.z.toFixed(2)&&e.x.toFixed(2)!=this.shooterStartPos.x.toFixed(2)&&(this.reel=!0,tt[this.shooterid].isFishing=!1):40<=e.distanceTo(this.shooterStartPos)&&(this.reel=!0,tt[this.shooterid].isFishing=!1)),this.position.y<10&&this.position.y<0&&(this.reel||""===this.shooterid||void 0===tt[this.shooterid]||1==tt[this.shooterid].use||0===tt[this.shooterid].activeWeapon||this.position.x>rt||this.position.z>rt||this.position.x<0||this.position.z<0?(this.impact&&(this.impact.destroy=!0),ut(this)):(this.velocity.x=0,this.velocity.z=0,tt[this.shooterid].isFishing=!0)),this.airtime+=t},f.prototype.clientlogic=function(t){var e,i,o,s,n=tt[this.shooterid];(void 0===n||n&&n.parent&&n.parent.hp<=0)&&(Rt.remove(this.geometry),void 0!==this.line&&(Rt.remove(this.line),this.line.geometry.dispose())),n&&1==this.setProjectileModel&&(Rt.remove(this.geometry),0===n.activeWeapon?this.geometry=new THREE.Sprite(E.cannonball):1===n.activeWeapon&&(this.baseGeometry=x.hook,this.baseMaterial=E.hook,(e=k.line.clone()).vertices.push(this.startPoint),e.vertices.push(this.endPoint),this.line=new THREE.Line(e,new THREE.MeshBasicMaterial({color:0})),nt[this.id]=this.line,this.line.frustumCulled=!1,tt[this.shooterid].weapon&&((i=new THREE.Box3).setFromObject(tt[this.shooterid].weapon),this.startPoint.set(i.max.x-.5,i.max.y,i.max.z-.5)),Rt.add(this.line),this.geometry=new THREE.Mesh(this.baseGeometry,this.baseMaterial)),st[this.id]=this.geometry,Rt.add(this.geometry),this.setProjectileModel=!1),this.geometry.position.set(this.position.x,this.position.y,this.position.z),this.line?(n&&n.weapon&&((i=new THREE.Box3).setFromObject(tt[this.shooterid].weapon),this.startPoint.set(i.max.x-.5,i.max.y,i.max.z-.5)),this.endPoint.set(this.position.x,this.position.y,this.position.z),this.line.geometry.verticesNeedUpdate=!0,this.geometry.rotation.y+=1.5*t):n&&0===n.activeWeapon&&(this.particletimer-=t,this.particletimer<0)&&(o=Lt&&this.shooterid==Lt.id,s=Lt&&Lt.parent&&Lt.parent.children[this.shooterid],this.particletimer=.04,ve({vx:0,vy:0,vz:0,x:this.position.x,z:this.position.z,y:this.position.y,w:o?.7:.4,h:o?.7:.4,d:o?.7:.4,gravity:0,duration:2,rotaSpeed:5*Math.random(),sizeSpeed:-1.8,material:o?E.smoke_player:s?E.smoke_friendly:E.smoke_enemy,geometry:k.box}))},f.prototype.getTypeDelta=function(){if(!this.spawnPacket)return this.spawnPacket=!0,this.getTypeSnap()},f.prototype.parseTypeSnap=function(t){void 0!==t.vx&&(this.velocity.x=parseFloat(t.vx)),void 0!==t.vy&&(this.velocity.y=parseFloat(t.vy)),void 0!==t.vz&&(this.velocity.z=parseFloat(t.vz)),void 0!==t.x&&(this.position.x=parseFloat(t.x)),void 0!==t.z&&(this.position.z=parseFloat(t.z)),void 0!==t.y&&(this.position.y=parseFloat(t.y)),void 0!==t.i&&t.i!=this.shooterid&&(this.shooterid=t.i),void 0!==t.r&&t.r!=this.reel&&(this.reel=pt(t.r)),void 0!==t.sx&&(this.shooterStartPos.x=parseFloat(t.sx)),void 0!==t.sz&&(this.shooterStartPos.z=parseFloat(t.sz))},t.prototype.clientInit=function(){this.createBody()},t.prototype.createBody=function(){this.geometry=new THREE.Object3D,Rt.add(this.geometry),this.geometry.rotation.order="YXZ",this.baseGeometry&&(this.body=new THREE.Mesh(this.baseGeometry,this.baseMaterial),this.body.scale.set(this.modelscale.x,this.modelscale.y,this.modelscale.z),this.body.position.set(this.modeloffset.x,this.modeloffset.y,this.modeloffset.z),this.body.rotation.set(this.modelrotation.x,this.modelrotation.y,this.modelrotation.z),this.geometry.add(this.body),this.geometry.position.x=this.position.x,this.geometry.position.y=this.position.y,this.geometry.position.z=this.position.z),this.baseModel&&(this.body=this.baseModel.clone(),this.body.scale.set(this.modelscale.x,this.modelscale.y,this.modelscale.z),this.body.position.set(this.modeloffset.x,this.modeloffset.y,this.modeloffset.z),this.body.rotation.set(this.modelrotation.x,this.modelrotation.y,this.modelrotation.z),this.geometry.add(this.body),this.geometry.position.x=this.position.x,this.geometry.position.y=this.position.y,this.geometry.position.z=this.position.z),this.isPlayer&&(It.parent&&It.parent.remove(It),It.position.set(0,1,5),It.rotation.z=0,It.rotation.y=0,It.rotation.x=-.4,this.geometry.add(It),this.geometry.add(this.crosshair)),0===this.netType&&this.setPlayerBody(),this.clientlogic(0)},t.prototype.onClientDestroy=function(){this.parent&&this.parent.geometry.remove(this.geometry),Rt.remove(this.geometry),void 0!==this.line&&(Rt.remove(this.line),this.line.geometry.dispose())},t.prototype.clientlogic=function(t){this.geometry.position.set(this.position.x,this.position.y,this.position.z),this.geometry.rotation.y=this.rotation};var ut=function(t){tt.hasOwnProperty(t.id)&&(t.onDestroy(),delete tt[t.id])},mt=function(){for(var t in dt){var e=dt[t];void 0!==A[e.body]&&(e.body=A[e.body].getObjectByName("body")),void 0!==e.sail&&void 0!==A[e.sail]&&(e.sail=A[e.sail].getObjectByName("sail")),void 0!==e.mast&&void 0!==A[e.mast]&&(e.mast=A[e.mast].getObjectByName("mast"))}};r.prototype.changeBoatModel=function(t){void 0!==this.geometry&&void 0!==dt[t]&&(this.body&&this.geometry.remove(this.body),this.sail&&this.geometry.remove(this.sail),this.mast&&this.geometry.remove(this.mast),this.body=dt[t].body.clone(),this.body.material=dt[t].body.material.clone(),this.body.material.transparent=!0,this.body.scale.set(dt[t].scale[0],dt[t].scale[1],dt[t].scale[2]),this.body.position.set(dt[t].offset[0],dt[t].offset[1],dt[t].offset[2]),this.body.rotation.set(dt[t].rotation[0],dt[t].rotation[1],dt[t].rotation[2]),this.geometry.add(this.body),dt[t].sail&&(this.sail=dt[t].sail.clone(),this.sail.material=dt[t].sail.material.clone(),this.sail.material.transparent=!0,this.sail.scale.set(dt[t].scale[0],dt[t].scale[1],dt[t].scale[2]),this.sail.position.set(dt[t].offset[0],dt[t].offset[1],dt[t].offset[2]),this.sail.rotation.set(dt[t].rotation[0],dt[t].rotation[1],dt[t].rotation[2]),this.geometry.add(this.sail)),dt[t].mast&&(this.mast=dt[t].mast.clone(),this.mast.material=dt[t].mast.material.clone(),this.mast.material.transparent=!0,this.mast.scale.set(dt[t].scale[0],dt[t].scale[1],dt[t].scale[2]),this.mast.position.set(dt[t].offset[0],dt[t].offset[1],dt[t].offset[2]),this.mast.rotation.set(dt[t].rotation[0],dt[t].rotation[1],dt[t].rotation[2]),this.geometry.add(this.mast)))},r.prototype.docking=function(t){this.shipclassId,Lt&&Lt.parent};new G,Date.now();var ft,gt,yt,bt,vt,wt,kt,xt,Et,$t,Ct=[],_t=new THREE.Raycaster,Tt=function(){E.dog_1=new THREE.MeshPhongMaterial({color:16777215,map:P.dog_diffuse}),Ct.push({body:new THREE.Mesh(x.dog_1,E.dog_1),scale:new THREE.Vector3(.04,.04,.04),offset:new THREE.Vector3(0,-.4,.8),rotation:new THREE.Vector3(.4,Math.PI,0)})};function St(t,e){return xt("div",{},[xt("table",{class:"table table-sm"},[xt("thead",{class:"thead-inverse"},[xt("tr",{},[xt("th",{},"Krew Name"),xt("th",{},"Capacity"),xt("th")])]),xt("tbody",{},t.boats.map(function(e){if(void 0!==Lt&&void 0!==Lt.parent&&void 0!==e&&void 0!==tt[e.captainId])return e.id,$(document).on("click","#"+e.id,function(){var t=e.id;void 0!==tt[t]&&tt[t].maxKrewCapacity!=tt[t].krewCount&&tt[t].captainId!==myPlayerId&&be.emit("joinKrew",t,function(t){0===t&&($("#exit-island-button").hide(),$("#toggle-invite-link-button").hide(),$("#invite-div").hide(),$("#departure-modal").is(":visible")&&$("#departure-modal").hide(),GameAnalytics("addDesignEvent","Game:Session:JoinedBoat"),$("#krew-div").show(),$("#abandon-ship-button").show())})}),xt("tr",{key:e.id},[xt("td",{},[e.crewName+"("+dt[e.shipclassId].name+")",xt("br"),xt("small",{},4==e.shipState?"Departing in "+Math.round(e.departureTime)+" seconds":"")]),xt("td",{},e.krewCount+"/"+dt[e.shipclassId].maxKrewCapacity),xt("td",{},e.id===Lt.parent.id?"My Krew":xt("button",{id:e.id,class:"btn btn-primary btn-md",role:"button",disabled:void 0===tt[e.id]||tt[e.id].maxKrewCapacity==tt[e.id].krewCount||tt[e.id].captainId===myPlayerId},"Join"))])}))])])}h.prototype.timeCounters={},h.prototype.namesLogic=function(){this.isPlayer&&(void 0===this.timeCounters.namesLogic?this.timeCounters.namesLogic={time:performance.now(),previousTime:performance.now()}:this.timeCounters.namesLogic.time=performance.now(),200<this.timeCounters.namesLogic.time-this.timeCounters.namesLogic.previousTime&&(this.timeCounters.namesLogic.previousTime=this.timeCounters.namesLogic.time,requestAnimationFrame(function(){var t,e,i=It.getWorldPosition();for(var o in tt){0!==tt[o].netType&&1!==tt[o].netType&&5!==tt[o].netType||(t=s(i,tt[o].geometry.getWorldPosition()),e=CONFIG.Labels.distanceMultiplier[tt[o].netType],tt[o].inRange=t<=e,CONFIG.setProperties.inVision&&(tt[o].inVision=tt[o].inRange&&lt(tt[o],It)),0===tt[o].netType&&tt[o].setName(tt[o].name),1===tt[o].netType&&tt[o].setName(tt[o].crewName),1<tt[o].netType&&tt[o].setName(tt[o].name))}})))},h.prototype.dockedLogic=function(){if(this.isPlayer){var t=this;if(void 0===this.timeCounters.dockedLogic?this.timeCounters.dockedLogic={time:performance.now(),previousTime:performance.now()}:this.timeCounters.dockedLogic.time=performance.now(),50<this.timeCounters.dockedLogic.time-this.timeCounters.dockedLogic.previousTime){this.timeCounters.dockedLogic.previousTime=this.timeCounters.dockedLogic.time;var e,i,o,s=[],n={object:void 0,height:100},a=0,r=0;if(t.parent&&tt){if(i=new THREE.Vector3(0,-1,0),(e=t.geometry.getWorldPosition().clone()).set(e.x,100,e.z),_t.set(e,i),t.parent&&(t.parent.anchorIslandId&&tt[t.parent.anchorIslandId]&&(s.push(tt[t.parent.anchorIslandId].geometry.children[0]),tt[t.parent.anchorIslandId].palm&&s.push(tt[t.parent.anchorIslandId].palm)),void 0!==tt[t.parent.id]&&(5===tt[t.parent.id].netType&&(s.push(tt[t.parent.id].geometry.children[0]),tt[t.parent.id].palm&&s.push(tt[t.parent.id].palm)),1===tt[t.parent.id].netType&&void 0!==tt[t.parent.id].mast&&s.push(tt[t.parent.id].geometry.getObjectByName("body")))),0<(o=_t.intersectObjects(s)).length){for(;a<o.length;a++)o[a].distance<n.height&&(n={height:o[a].distance,object:o[a].object});r=100-n.height}n.object&&"body"===n.object.name&&(r-=dt[tt[t.parent.id].shipclassId].baseheight,right=t.position.x<0,halfWidth=dt[tt[t.parent.id].shipclassId].width/2,0!==t.position.x&&(t.isCaptain?r+=Math.abs(tt[t.parent.id].leanvalue/2):right?r-=tt[t.parent.id].leanvalue/2*(Math.abs(t.position.x)/halfWidth):r+=tt[t.parent.id].leanvalue/2*(Math.abs(t.position.x)/halfWidth))),n.object&&"body"!==n.object.name&&void 0!==tt[t.parent.id]&&1===tt[t.parent.id].netType&&(r-=dt[tt[t.parent.id].shipclassId].baseheight),t.position.y=r}}}},h.prototype.clientlogic=function(t){var e,i,o,s,n,a,r;this.isPlayer&&!ct(this.notifiscationHeap)&&this.notifiscation(),this.namesLogic(),this.isPlayer&&(this.walkForward=0,this.walkSideward=0,U&&(this.walkForward=1),W&&(this.walkForward=-1),j&&(this.walkSideward=1),D&&(this.walkSideward=-1),this.jumping=V?1:0,1!=this.state||$("#game-over-modal").is(":visible")||$("#game-over-modal").modal("show"),2==this.state&&(It.position.set(0,1,5),It.rotation.z=0,It.rotation.y=0,It.rotation.x=-.4,this.geometry.add(It),this.state=0),It.parent==this.geometry&&(e=.2-Math.max(controls.cameraX,.2),this.geometry.rotation.x=Q(this.geometry.rotation.x,Math.min(1,Math.max(-1,controls.cameraX+this.rotationOffset)),.8),this.rotation=controls.cameraY,i=new THREE.Vector3(It.position.x,2+Math.min(8,Math.max(0,10*controls.cameraX)),8+8*e),It.position.lerp(i,1),It.rotation.x=Q(It.rotation.x,e,1),this.pitch=controls.cameraX,this.crosshair.position.x=It.position.x,this.crosshair.position.y=It.position.y+.01,this.crosshair.position.z=It.position.z-.3),controls.isMouseLookLocked?this.use=controls.lmb:this.use=!1),1==this.jumping&&this.tryJump(),this.jumpVel-=80*t,this.jump+=this.jumpVel*t,this.jump<0&&(this.jump=0),this.isPlayer&&this.parent&&(3===this.parent.shipState||2===this.parent.shipState||-1===this.parent.shipState||4===this.parent.shipState||5===this.parent.netType)&&(Ut.updateKrewList(),Ut.hideSuggestionBox||!$("#shopping-modal").is(":visible")&&500<Lt.gold&&$("#earn-gold").is(":visible")&&$("#earn-gold").hide(),o=tt[this.parent.anchorIslandId||this.parent.id],s=new THREE.Vector3(0,0,0),5===this.parent.netType&&(a=this.geometry.position.clone(),s.y=a.y,r=a.distanceTo(s),o.dockRadius-2<r&&(a.lerp(s,1-(o.dockRadius-2)/r),this.position.x=a.x,this.position.z=a.z)),1===this.parent.netType&&(n=tt[this.parent.id],a=this.geometry.getWorldPosition().clone(),a=o.geometry.worldToLocal(a),s.y=a.y,r=a.distanceTo(s),o.dockRadius-2<r&&(a.lerp(s,1-(o.dockRadius-2.5)/r),a=o.geometry.localToWorld(a),a=n.geometry.worldToLocal(a),this.position.x=a.x,this.position.z=a.z))),this.dockedLogic(),this.geometry.position.set(this.position.x,this.position.y+this.jump,this.position.z),this.geometry.rotation.y=this.rotation,void 0!==this.weapon&&(1==this.activeWeapon?(this.weapon.rotation.x+=t*this.rodRotationSpeed,.75<this.weapon.rotation.x&&(this.weapon.rotation.x=0)):this.weapon.rotation.x=.1-this.rotationOffset),this.isCaptain!=this.oldCaptainState&&(this.parent&&this.isPlayer&&!this.isCaptain&&(Ut.showCenterMessage("You are not the captain anymore!",4,4e3),3===this.parent.shipState||4===this.parent.shipState||-1===this.parent.shipState?($("#toggle-shop-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md disabled toggle-krew-list-modal-button").addClass("btn btn-md enabled toggle-krew-list-modal-button"),$("#exit-island-button").hide(),$("#toggle-invite-link-button").show(),$("#quests-button").show()):1===this.parent.shipState&&$("#docking-modal").hide(),$("#abandon-ship-button").show()),this.parent&&this.isPlayer&&this.isCaptain&&(Ut.showCenterMessage("You are the captain now!",4,4e3),3===this.parent.shipState||4===this.parent.shipState||-1===this.parent.shipState?($("#toggle-shop-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md disabled toggle-krew-list-modal-button").addClass("btn btn-md enabled toggle-krew-list-modal-button"),$("#exit-island-button").show(),$("#toggle-invite-link-button").show(),$("#quests-button").show()):1===this.parent.shipState&&$("#docking-modal").show(),$("#abandon-ship-button").hide()),this.isCaptain?this.playerBody.add(this.captainHat):this.playerBody.remove(this.playerBody.getObjectByName("captainHat")),void 0!==this.label&&(this.label.material.color=this.isPlayer?C.myself:this.isCaptain?C.captain:C.player))},h.prototype.tryJump=function(t){0<this.jumpVel||0<this.jump||(this.jumpVel=16)},kt=window,xt=hyperapp.h,Et={boats:[]},$t={boats:function(){return function(t){var e,i,o=[];if("object"==typeof tt&&null!==tt)for(e in tt)i=tt[e],qt?Lt&&i&&i.anchorIslandId&&4===i.shipState&&!0===i.recruiting&&!0!==i.isLocked&&(1===Lt.parent.netType&&i.anchorIslandId===Lt.parent.anchorIslandId||i.anchorIslandId===Lt.parent.id)&&o.push(i):Lt&&i&&i.anchorIslandId&&(3===i.shipState||2===i.shipState||-1===i.shipState||4===i.shipState)&&!0===i.recruiting&&(1==Lt.parent.netType&&i.anchorIslandId==Lt.parent.anchorIslandId||i.anchorIslandId==Lt.parent.id)&&(o.push(i),$("#docked-krews-count").html(o.length));return o.sort(function(t,e){return t.departureTime===e.departureTime?t.id<e.id?-1:t.id==e.id?0:1:t.departureTime-e.departureTime}),0==o.length&&$("#toggle-krew-list-modal-button").popover("hide"),{boats:o}}}},kt.KREWLISTCOMPONENT=hyperapp.app(Et,$t,St,document.getElementById("krews-list")),kt.DEPARTINGKREWLISTCOMPONENT=hyperapp.app(Et,$t,St,document.getElementById("departing-krews-list")),bt=window,vt={$shoppingList:$("#shopping-item-list")},wt={getList:function(){wt.removeListeners().clearStore().setStore(function(){wt.setContent().setListeners()})},removeListeners:function(){return void 0!==vt.$html&&(vt.$html.children().off(),vt.$html.off()),wt},clearStore:function(){return Object.assign(vt,{goodsPrice:{},goods:{},cargo:0,cargoUsed:0,gold:0,$html:void 0,inventory:{},stock:{}}),wt},setStore:function(i){Lt&&Lt.parent&&(5==Lt.parent.netType||1!==Lt.parent.shipState&&0!==Lt.parent.shipState)&&be.emit("getGoodsStore",function(t,e){t&&console.warn(t),t||Object.assign(vt,e),i&&i.call&&i()})},setContent:function(){var t=$('<div class="stock"/>');return 0===Object.keys(vt.goodsPrice).length&&Lt.parent&&1!==Lt.parent.netType&&t.append('<div class="col-xs-12 trading"><h5 class="text-warning">You must own a ship, or join a krew before buying supplies</h5></div>'),0<Object.keys(vt.goodsPrice).length&&(t.append(wt.getInventory()),t.append(wt.getGoods())),vt.$html=t,vt.$shoppingList.html(vt.$html),wt},setListeners:function(){for(var t in $("input[type=range]").each(function(){inputRange($(this))}),vt.inventory)wt.setInputRangeListeners(vt.inventory[t],t,"sell");for(var t in vt.stock)wt.setInputRangeListeners(vt.stock[t],t,"buy");return wt},setInputRangeListeners:function(t,s,n){var e,i,a=t.find(".btn-"+n),o=t.find(".ui-slider"),r=o.find(".ui-slider-handle"),l={create:function(){r.text(o.slider("value"))},slide:function(t,e){r.text(e.value);var i=e.value*vt.goodsPrice[s],o="sell"===n?"+":"-";a.html((0<i?o:"")+i)}};"sell"===n&&(l.max=vt.goods[s]),"buy"===n&&(e=parseInt(vt.gold/vt.goodsPrice[s]),(i=(vt.cargo-vt.cargoUsed)/ht[s].cargoSpace)<e&&(e=i),e=Math.floor(e),l.max=e),o.slider(l),a.one("click",function(t){t.preventDefault(),GameAnalytics("addDesignEvent","Game:Session:Trade"),0<o.slider("value")&&be.emit("buy-goods",{quantity:o.slider("value"),action:n,good:s},function(t,e){t&&console.log(t),t||(Lt.gold=e.gold,Lt.goods=e.goods),wt.getList()})})},getInventory:function(){var t,e,i,o="";for(var s in o+='<div class="col-xs-12 col-sm-6 trading">',o+="    <h6>Your ship's cargo "+vt.cargoUsed+"/"+vt.cargo+"</h6>",o+='    <table class="table table-sm">',o+="        <thead><tr><th>Name</th><th>Quantity</th><th></th><th>Sell</th></tr></thead>",o+="        <tbody></tbody>",o+="    </table>",o+="    <br>",o+="</div>",e=(t=$(o)).find("tbody"),vt.goods){0<vt.goods[s]&&void 0!==vt.goodsPrice[s]&&(i="",i+="<tr>",i+="    <td>",i+="        "+s,i+="        <label>$"+vt.goodsPrice[s]+" each</label>",i+="        <label>"+ht[s].cargoSpace+" cargo</label>",i+="    </td>",i+="    <td>",i+='        <div class="ui-slider" style="margin-top: 10px">',i+='            <div class="ui-slider-handle" style="width: 3em;height: 1.6em;top: 50%;margin-top: -.8em;text-align: center;line-height: 1.6em;"></div>',i+="        </div>",i+="    </td>",i+='    <td style="padding-top: 5px">'+vt.goods[s]+"</td>",i+="    <td>",i+='        <button class="btn btn-success btn-sm btn-sell">0</button>',i+="    </td>",i+="</tr>",vt.inventory[s]=$(i),e.append(vt.inventory[s]))}return t},getGoods:function(){var t,e,i,o,s;for(var n in e=(t=$('<div class="col-xs-12 col-sm-6 trading">    <h6>Merchant</h6>    <table class="table table-sm">        <thead><tr><th>Name</th><th>Quantity</th><th></th><th>Buy</th></tr></thead>        <tbody></tbody>    </table>    <br></div>')).find("tbody"),vt.goodsPrice){void 0!==vt.goods[n]&&(i=parseInt(vt.gold/vt.goodsPrice[n]),s="",(o=(vt.cargo-vt.cargoUsed)/ht[n].cargoSpace)<i&&(i=o),i=Math.floor(i),s+="<tr>",s+="    <td>",s+="        "+n,s+="        <label>$"+vt.goodsPrice[n]+" each</label>",s+="        <label>"+ht[n].cargoSpace+" cargo</label>",s+="    </td>",s+="    <td>",s+='        <div class="ui-slider" style="margin-top: 10px">',s+='            <div class="ui-slider-handle" style="width: 3em;height: 1.6em;top: 50%;margin-top: -.8em;text-align: center;line-height: 1.6em;"></div>',s+="        </div>",s+="    </td>",s+='    <td style="padding-top: 5px">'+i+"</td>",s+="    <td>",s+='        <button class="btn btn-success btn-sm btn-buy">0</button>',s+="    </td>",s+="</tr>",vt.stock[n]=$(s),e.append(vt.stock[n]))}return t}},bt.GOODSCOMPONENT=wt,ft=window,gt={$shoppingList:$("#shopping-item-list")},yt={keys:{53:"fireRate",54:"distance",55:"damage"},getList:function(){void 0!==Lt&&void 0!==Lt.parent?yt.removeListeners().clearStore().setStore(function(){yt.setContent().setListeners()}):console.warn("Ooops, it seems you don't have a boat.")},removeListeners:function(){return void 0!==gt.$html&&(gt.$html.children().off(),gt.$html.off()),yt},clearStore:function(){return Object.assign(gt,{$html:void 0,points:{},originalPoints:0,availablePoints:0,usedPoints:0,allocatedPoints:{},pointsTr:{},experience:Lt?Lt.experience:0}),yt},setStore:function(o){be.emit("getExperiencePoints",function(t,e){if(t)console.warn(t);else{for(var i in Object.assign(gt,e),Lt&&(Lt.experience=e.experience,Lt.points=e.points),gt.points)gt.allocatedPoints[i]=0;gt.originalPoints=gt.availablePoints,o&&o.call&&o(gt)}})},setContent:function(){var t=$("<div/>");return t.append(yt.getPointsList()),0===gt.originalPoints&&t.find(".btn-allocate-points").attr("disabled",!0),gt.$html=t,gt.$shoppingList.html(gt.$html),yt},setListeners:function(){var t,e=gt.$html.find(".btn-allocate-points");for(t in $("input[type=range]").each(function(){inputRange($(this))}),gt.pointsTr)yt.setInputRangeListeners(gt.pointsTr[t],t);return e.one("click",function(t){t.preventDefault(),yt.allocatePoints(function(){yt.getList()})}),yt},allocatePoints:function(e){be.emit("allocatePoints",gt.allocatedPoints,function(t){t&&console.log(t),"function"==typeof e&&e()})},setInputRangeListeners:function(t,e){var i=t.find("input");i.on("change input",function(){yt.updateAvailablePoints();var t=parseInt(i.val())-gt.points[e];t<=0&&(t=0),t>gt.allocatedPoints[e]+gt.availablePoints&&(t=gt.allocatedPoints[e]+gt.availablePoints),gt.availablePoints<=0&&t>=gt.allocatedPoints[e]&&(t=gt.allocatedPoints[e]),gt.allocatedPoints[e]=t,t+=gt.points[e],i.val(t),updateInputRange(i),yt.updateAvailablePoints(),gt.$html.find("h6").html("Available points: "+gt.originalPoints+'<span class="float-right">Points left: '+gt.availablePoints+"</span>"),Ut.updateUiExperience()}).trigger("change")},updateAvailablePoints:function(){for(var t in gt.usedPoints=0,gt.allocatedPoints)gt.usedPoints+=gt.allocatedPoints[t];return gt.availablePoints=gt.originalPoints-gt.usedPoints,yt},getPointsList:function(){var t,e,i="";for(var o in i+="<div>",i+="    <h6>Available points: "+gt.originalPoints+'<span class="float-right">Points left: '+gt.availablePoints+"</span></h6>",i+='    <table class="table table-sm">',i+="        <thead><tr><th>Name</th><th>Quantity</th></tr></thead>",i+="        <tbody></tbody>",i+="    </table>",i+='    <button class="btn btn-primary float-right btn-allocate-points">Allocate points</button>',i+="</div>",e=(t=$(i)).find("tbody"),gt.points){var s="";s+="<tr>",s+="    <td>"+o+"</td>",s+="    <td>",s+='        <div class="range-group">',s+='            <input type="range" min="0" max="50" step="1" value="'+gt.points[o]+'">',s+="            <output></output>",s+="        </div>",s+="    </td>",s+="</tr>",gt.pointsTr[o]=$(s),e.append(gt.pointsTr[o])}return t},checkButtonTab:function(){yt.clearStore().setStore(function(t){var e=$("#experience-points");0<t.originalPoints?e.show(0):e.hide(0)})}},ft.EXPERIENCEPOINTSCOMPONENT=yt;var Mt,Rt,It,Lt,Pt,Ht,At,Ot,zt,Dt=0,jt=0,qt=(document.createElement("div"),!1),Bt=0,Nt=performance.now(),Ft=window.location.href.replace(/\?.*/,"").replace(/#.*/,"").replace(/\/$/,""),Ut={isLoggedIn:!1,hideSuggestionBox:!1,serverList:{},setListeners:function(){var i=$("#crew-name"),o=$("#crew-name-edit-button"),s=(i.add(o),$("#crew-name-edit-input")),t=$("#crew-name-form"),n=this;o.on("click",function(){o.addClass("hidden"),n.leadersUiConfiguration.active&&(i.addClass("hidden"),n.leadersUiConfiguration.editingName=!0,s.val(i.html()).removeClass("hidden"))}),t.on("submit",function(t){var e;n.leadersUiConfiguration.editingName=!1,i.removeClass("hidden"),s.addClass("hidden"),n.leadersUiConfiguration.active&&(o.removeClass("hidden"),0<(e=s.val().trim().slice(0,20)).length&&!e.includes("⚔")&&(Pt.setName(e),i.text(Pt.crewName),be.emit("updateKrewName",Pt.crewName))),s.val(""),t.preventDefault()}),s.on("keyup",function(t){var e=$(this),i=e.val();20<i.trim().length&&e.val(i.slice(0,20))}),$(".toggle-shop-modal-button").on("click",function(){$("#toggle-shop-modal-button").hasClass("enabled")&&($("#shopping-modal").is(":visible")?$("#shopping-modal").hide():(Ut.closeAllPagesExcept("#shopping-modal"),Ut.hideSuggestionBox=!0,Ut.updateStore($(".btn-shopping-modal.active")),$("#toggle-shop-modal-button").popover("hide"),$("#shopping-modal").show()))}),$(".toggle-krew-list-modal-button").on("click",function(){$("#toggle-krew-list-modal-button").hasClass("enabled")&&($("#krew-list-modal").is(":visible")?$("#krew-list-modal").hide():(Ut.closeAllPagesExcept("#krew-list-modal"),Ut.hideSuggestionBox=!0,Ut.updateStore($(".btn-shopping-modal.active")),$("#toggle-shop-modal-button").popover("hide"),$("#krew-list-modal").show()))}),$(".toggle-bank-modal-button").on("click",function(){$("#toggle-bank-modal-button").hasClass("enabled")&&($("#bank-modal").is(":visible")?$("#bank-modal").hide():(Ut.closeAllPagesExcept("#bank-modal"),$("#bank-modal").show(),$("#successTakeDepoMess").hide(),$("#successMakeDepoMess").hide(),$("#errorMakeDepoMess").hide(),$("#errorTakeDepoMess").hide(),pe()))}),$("#toggle-map-button").on("click",function(){$("#minimap-container").is(":visible")?$("#minimap-container").hide():$("#minimap-container").show()}),$(".toggle-ship-status-button").on("click",function(){$("#ship-status-modal").is(":visible")?$("#ship-status-modal").hide():(Ut.closeAllPagesExcept("#ship-status-button"),Ut.showShipStatus(),$("#ship-status-modal").show(),!0!==Lt.isCaptain?$("#lock-krew-label").hide():($("#lock-krew-label").show(),!0!==Pt.isLocked?($("#lock-krew-button").prop("checked",!1),$("#lock-krew-text").removeClass("lock-text-error").addClass("lock-text-info").text("Lock krew...")):($("#lock-krew-button").prop("checked",!0),$("#lock-krew-text").removeClass("lock-text-info").addClass("lock-text-error").text("Unlock krew..."))))}),$("#ship-status").on("click",function(){Ut.showShipStatus()}),$("#clan-management").on("click",function(){$("#clan-management").addClass("active"),$("#ship-status").removeClass("active"),!0===Lt.isLoggedIn?(Ut.setClanData(),$("#clan-management-container").is(":visible")||($("#clan-management-container").show(),$("#ship-status-container").hide(),Ut.setClanData("force"))):($("#ship-status-container").hide(),$("#notLoggedIn-container").show())}),$("#leave-clan-button").on("click",function(){be.emit("clan","leave",function(t){!0===t&&(Ut.showCenterMessage("You successfully left the clan",3,5e3),Ut.setClanData("force"))}),Lt.clan="",Ut.setClanData()}),$("#request-clan-button").on("click",function(){$("#clan-table").hide(),$("#clan-request-table").show(),$("#view-clan-button").show()}),$("#view-clan-button").on("click",function(){$("#clan-table").show(),$("#clan-request-table").hide(),$("#view-clan-button").hide()}),$("#clan-request").on("click",function(){Ut.hideAllClanErrors()}),$("#join-clan-button").on("click",function(){Ut.hideAllClanErrors();var e=$("#clan-request").val();!0!==g(e)?$("#errorInput").show():e.length<1||4<e.length?$("#errorLength").show():Lt.clanRequest&&""!==Lt.clanRequest||be.emit("clan",{action:"join",id:e},function(t){!0===t?(Lt.clanRequest=e,Ut.showCenterMessage("Your request was sent to the clan leader(s)",3,5e3),Ut.setClanData("force")):404===t?$("#error404").show():$("#errorUndefined").show()})}),$("#create-clan-button").on("click",function(){Ut.hideAllClanErrors();var e=$("#clan-request").val();!0!==g(e)?$("#errorInput").show():e.length<1||4<e.length?$("#errorLength").show():be.emit("clan",{action:"create",id:e},function(t){!0===t?(Ut.showCenterMessage("You successfully created your own clan",3,5e3),Lt.clan=e,Lt.clanLeader=!0,Ut.setClanData("force")):409===t?$("#errorExists").show():403===t?$("#errorUnauthorized").show():$("#errorUndefined").show()})}),$("#clan-table").on("click",function(t){var e=t.target.getAttribute("data-event"),i=t.target.getAttribute("data-id");"promote-clan"===e?(be.emit("clan",{action:"promote",id:i},function(t){!0===t?(Ut.setClanData("force"),Ut.showCenterMessage("You promoted "+i+" to be a clan leader",3,5e3)):Ut.showCenterMessage("Promoting "+i+" to be a clan leader FAILED",1,5e3)}),Ut.setClanData()):"kick-clan"===e&&be.emit("clan",{action:"kick",id:i},function(t){!0===t?(Ut.setClanData("force"),Ut.showCenterMessage("You kicked "+i+" from the clan",4,5e3)):Ut.showCenterMessage("Kicking "+i+" from your clan FAILED",1,5e3)})}),$("#clan-request-table").on("click",function(t){var e=t.target.getAttribute("data-event"),i=t.target.getAttribute("data-id");"accept-request"===e?be.emit("clan",{action:"accept",id:i},function(t){!0===t&&(Ut.setClanData("force"),Ut.showCenterMessage("You accepted "+i+" to join the clan",4,5e3))}):"decline-request"===e&&be.emit("clan",{action:"decline",id:i},function(t){!0===t&&(Ut.setClanData("force"),Ut.showCenterMessage("You declined "+i+" to join the clan",4,5e3))})}),$("#player-request-table").on("click",function(t){"cancel-request"===t.target.getAttribute("data-event")&&Lt.clanRequest&&""!==Lt.clanRequest&&be.emit("clan",{action:"cancel-request",id:Lt.clanRequest},function(t){!0===t&&(Lt.clanRequest="",Ut.setClanData("force"),Ut.showCenterMessage("Your request has been cancelled",4,5e3))})}),$("#minimap").on("click",function(t){var e,i;Nt<performance.now()-5e3&&(Nt=performance.now(),e=9.4*(null==t.offsetX?t.layerX:t.offsetX)-94,i=9.4*(null==t.offsetY?t.layerY:t.offsetY)-94,be.emit("addMarker",{x:e,y:i}))}),$("#krew-list").on("click",function(t){var e,i=t.target.getAttribute("data-event");"kick"==i?"string"==typeof(e=t.target.getAttribute("data-id"))&&0<e.length&&(be.emit("bootMember",e),$(t.target).closest(".player-list-item").remove(),$("#buy-goods").hasClass("active")&&GOODSCOMPONENT.getList()):"transfer"==i&&"string"==typeof(e=t.target.getAttribute("data-id"))&&0<e.length&&(be.emit("transferShip",e),$("#buy-goods").hasClass("active")&&GOODSCOMPONENT.getList())})},updateUiExperience:function(){var p=$(".level-up-button");p.off(),EXPERIENCEPOINTSCOMPONENT.clearStore().setStore(function(e){0<e.originalPoints&&(p.show(0),p.one("click",function(){var t=$(this).attr("data-attribute");e.allocatedPoints[t]=1,EXPERIENCEPOINTSCOMPONENT.allocatePoints(function(){Ut.updateUiExperience()})})),e.originalPoints<=0&&p.hide(0);var t=$("#experience-bar"),i=t.find("div"),o=$(".experience-attribute-fireRate"),s=$(".experience-attribute-damage"),n=$(".experience-attribute-distance"),a=Lt.experience,r=parseInt(Lt.level),l=r+1,c=Lt.experienceNeededForLevels[r].total,h=Lt.experienceNeededForLevels[l].total,d=parseInt((a-c)/(h-c)*100);t.attr("data-info","Level "+r),o.find("span").html(Lt.points.fireRate),s.find("span").html(Lt.points.damage),n.find("span").html(Lt.points.distance),r===Lt.experienceMaxLevel?i.attr("style","width: 100%"):i.attr("style","width: "+d+"%")})},showCenterMessage:function(t,e,i){var o="";switch(e){case void 0:o="info";break;case 1:o="danger";break;case 3:o="success";break;case 4:o="info"}GrowlNotification.notify({description:t,closeTimeout:void 0===i?4e3:i,position:"top-center",animationOpen:"slide-in",animationClose:"fade-out",type:o,imageVisible:!0,imageCustom:"../assets/img/"+o+"-new.png"})},showAdminMessage:function(t){GrowlNotification.notify({title:"Message from admin:",description:t,closeTimeout:8e3,position:"top-center",animationOpen:"slide-in",animationClose:"fade-out",type:"info",imageVisible:!0,imageCustom:"../assets/img/info-new.png"})},showKillMessage:function(t){GrowlNotification.notify({description:t,closeTimeout:5e3,position:"top-right",animationOpen:"slide-in",animationClose:"fade-out",type:"danger",imageVisible:!0,imageCustom:"../assets/img/cannon32x32.png"})},showDamageMessage:function(t,e){switch(e){case void 0:case 1:color="#a94442";break;case 2:color="#3c763d"}var i=$("<div/>",{class:"text-xs-center",text:t,style:"color: "+color}).delay(3e3).fadeOut("slow");3<$("#center-div div").length&&$("#center-div div:last-child").remove(),$("#center-div").prepend(i)},showAdinplay:function(){var t=Date.now(),e=localStorage.getItem("lastAdTime"),i=t-e;console.log("Time since last ad: "+i/1e3+"s"),0!=e&&null!=e&&3e5<i?(console.log("Showing ad"),localStorage.setItem("lastAdTime",t),adplayer&&adplayer.startPreRoll()):(null!=e&&void 0!==e||localStorage.setItem("lastAdTime",1),console.log("Last ad recent. Not showing ad"))},showAdinplayCentered:function(){"undefined"!=typeof adplayer&&adEnabled?adplayerCentered.startPreRoll():console.log("adplayer is not defined")},getShips:function(l){Lt&&1!==Lt.parent.shipState&&0!==Lt.parent.shipState&&be.emit("getShips",function(t,e){t&&console.warn(t);var i=$("<div/>",{style:"font-size: 15px;text-align: center;"});for(var o in $shopContainer=$('<table class="table ship-table"><thead class="thead-inverse"><tr><th> Ship Image </th><th> Ship Type </th><th> HP</th><th> Max Capacity </th><th> Max Cargo </th><th> Speed </th><th> Price </th><th> Buy </th></tr></thead><tbody></tbody></table>'),$tbody=$shopContainer.find("tbody"),e){var s,n,a,r=e[o];0!=r.id&&(s="<tr>",s+="<td>"+r.image+"</td>",s+="<td>"+r.name+"</td>",s+="<td>"+r.hp+"</td>",s+="<td>"+r.maxKrewCapacity+"</td>",s+="<td>"+r.cargoSize+"</td>",s+="<td>"+r.speed+"</td>",s+="<td>"+r.price+"</td>",s+="<td></td>",s+="</tr>",n=$(s),$tbody.append(n),a=$("<button/>",{id:r.id,class:"btn btn-primary btn-sm",role:"button",disabled:void 0!==Pt&&r.id==Pt.shipclassId&&Pt.captainId==myPlayerId||!0!==r.purchasable,html:void 0!==Pt&&r.id==Pt.shipclassId&&Pt.captainId==myPlayerId?"Purchased":"Buy"}).on("click",function(){$("#abandon-existing-krew").is(":visible")&&$("#abandon-existing-krew").hide();var t=$(this).attr("id");void 0!==Lt&&(Lt.position.x=0,Lt.position.z=0),be.emit("purchase",{type:0,id:t},function(t){["04","05","06","07","015","016"].includes(t)&&($("#shopping-modal").hide(),$("#completed-quest-table").append($("#other-quest-2").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#other-quest-3").show()),["08","09","010","012","013","018","019"].includes(t)&&($("#shopping-modal").hide(),$("#completed-quest-table").append($("#other-quest-3").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#other-quest-4").show()),["014","020"].includes(t)&&($("#shopping-modal").hide(),$("#completed-quest-table").append($("#other-quest-4").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'))}),$("#krew-div").show(),void 0!==Lt&&void 0!==Lt.parent&&1!==Lt.parent.netType&&(GameAnalytics("addDesignEvent","Game:Session:PurchasedBoat"),$("#raft-shop-div").hide(),qt&&$("#toggle-krew-list-modal-button").popover("show"),Ut.hideSuggestionBox||$("#toggle-shop-modal-button").popover("show"))}),n.find("td").eq(7).append(a))}i.append($shopContainer),"function"==typeof l&&l(i)})},getItems:function(l){1!==Lt.parent.shipState&&0!==Lt.parent.shipState&&be.emit("getItems",function(t,e){t&&console.warn(t);var o=$("<div/>");for(i in $shopContainer=$('<table class="table"><thead class="thead-inverse"><tr><th> Item Name </th><th> Description </th><th> Price </th><th> Buy Item </th></tr></thead><tbody></tbody></table>'),$tbody=$shopContainer.find("tbody"),e){var s=e[i];(11===s.id&&(Lt.overall_kills<10||Lt.overall_cargo<1e5||!Lt.shipsSank||!Lt.overall_cargo)||14===s.id&&!0===Lt.statsReset)&&(s.purchasable=!1);var n="<tr>";n+="<td>"+s.name+"</td>",n+="<td>"+s.Description+"</td>",n+="<td>"+s.price+"</td>",n+="<td></td>",n+="</tr>";var a=$(n);$tbody.append(a);var r=$("<button/>",{id:s.id,class:"btn btn-primary btn-sm",role:"button",disabled:!!(Lt&&Lt.itemId==s.id||!0!==s.purchasable),html:Lt&&Lt.itemId==s.id?"Equipped":"Buy"}).on("click",function(){var t=$(this).attr("id");be.emit("purchase",{type:1,id:t},function(t){"14"===t&&(Ut.updateUiExperience(),$("#shopping-modal").hide(),Lt.statsReset=!0)})});a.find("td").eq(3).append(r)}o.append($shopContainer),"function"==typeof l&&l(o)})},updateKrewList:function(t,e){t=t||5;var i=performance.now(),o=performance.now();return function(){(i=performance.now())-o>1e3/t&&(o=i,requestAnimationFrame(e.bind(this)))}}(2,function(){KREWLISTCOMPONENT.boats(),DEPARTINGKREWLISTCOMPONENT.boats()}),updateStore:function(t){var e=$("#shopping-item-list"),i=t.attr("id");return e.html(""),EXPERIENCEPOINTSCOMPONENT.checkButtonTab(),"buy-ships"===i?(void 0!==Lt&&void 0!==Lt.parent&&Lt.parent.captainId!=Lt.id&&1==Lt.parent.netType&&$("#abandon-existing-krew").show(),void this.getShips(function(t){e.html(t)})):"buy-items"===i?($("#abandon-existing-krew").is(":visible")&&$("#abandon-existing-krew").hide(),void this.getItems(function(t){e.html(t)})):"buy-goods"===i?($("#abandon-existing-krew").is(":visible")&&$("#abandon-existing-krew").hide(),void GOODSCOMPONENT.getList()):"experience-points"===i?($("#abandon-existing-krew").is(":visible")&&$("#abandon-existing-krew").hide(),void EXPERIENCEPOINTSCOMPONENT.getList()):void 0},getInviteLink:function(){return"www.krew.io/?sid="+$("#server-list").val()+"&bid="+Pt.id},updateShipStats:function(t){var e;Lt&&Lt.parent&&1===Lt.parent.netType?($(".ship-hp").html(Lt.parent.hp),$(".ship-max-hp").html(Lt.parent.maxHp),$("#ship-name").html(dt[Pt.shipclassId].name),$(".ship-speed").html(Lt.parent.speed),e=dt[Pt.shipclassId].cargoSize,$("#supply").html(Pt.supply),$("#cargo-size").html(e),$(".ship-krew-count").html(t.krewCount),$(".ship-max-capacity").html(dt[Pt.shipclassId].maxKrewCapacity)):($(".ship-hp").html(""),$(".ship-max-hp").html(""),$("#ship-name").html(""),$("#supply").html(""),$("#cargo-size").html(""),$(".ship-krew-count").html(""),$(".ship-max-capacity").html(""),$(".ship-speed").html("/"))},checkGoldDelta:function(t){var e;deltaGold=t-jt,jt=t,0<deltaGold?(Lt.notifiscationHeap[Math.random().toString(36).substring(6,10)]={text:"+ "+deltaGold+" Gold!",type:1,isNew:!0},$("#gold").hasClass("glow-gold-plus")||0!=Bt||($("#gold").addClass("glow-gold-plus"),Bt=1,setTimeout(function(){$("#gold").removeClass("glow-gold-plus"),Bt=0},3500)),e=99999<t&&t<999999?Math.floor(t/1e3)+" K":999999<t?Math.floor(t/1e3)/1e3+" M":t,$(".my-gold").text(e)):deltaGold<0&&($("#gold").hasClass("glow-gold-minus")||0!=Bt||($("#gold").addClass("glow-gold-minus"),Bt=1,setTimeout(function(){$("#gold").removeClass("glow-gold-minus"),Bt=0},3500)),e=99999<t&&t<999999?Math.floor(t/1e3)+" K":999999<t?Math.floor(t/1e3)/1e3+" M":t,$(".my-gold").text(e))},checkScoreDelta:function(t){deltaScore=t-Dt,0<deltaScore&&(this.showDamageMessage("+ "+parseFloat(deltaScore).toFixed(1)+" hit",2),Dt=t)},setActiveBtn:function(t){""!==Lt.clan&&void 0!==Lt.clan&&$("#li-clan-chat").show(),5===tt[t].netType?($("#toggle-krew-list-modal-button").removeClass().addClass("btn btn-md enabled toggle-krew-list-modal-button"),$("#toggle-shop-modal-button").removeClass().addClass("btn btn-md enabled toggle-shop-modal-button"),"Labrador"===tt[t].name?$("#toggle-bank-modal-button").removeClass().addClass("btn btn-md enabled toggle-shop-modal-button").attr("data-tooltip","Deposit or withdraw gold"):$("#toggle-bank-modal-button").removeClass().addClass("btn btn-md disabled toggle-bank-modal-button").attr("data-tooltip","Bank is available at Labrador")):1===tt[t].netType&&3===tt[t].shipState&&($("#toggle-krew-list-modal-button").removeClass().addClass("btn btn-md enabled toggle-krew-list-modal-button"),$("#toggle-shop-modal-button").removeClass().addClass("btn btn-md enabled toggle-shop-modal-button"),"Labrador"===tt[tt[t].anchorIslandId].name?$("#toggle-bank-modal-button").removeClass().addClass("btn btn-md enabled toggle-shop-modal-button").attr("data-tooltip","Deposit or withdraw gold"):$("#toggle-bank-modal-button").removeClass().addClass("btn btn-md disabled toggle-bank-modal-button").attr("data-tooltip","Bank is available at Labrador"))},closeAllPagesExcept:function(t){allPagesId=["#help-modal","#bank-modal","#krew-list-modal","#shopping-modal","#quests-modal","#ship-status-modal"];for(var e=0;e<allPagesId.length;e++)t!==allPagesId[e]&&$(allPagesId[e]).hide()},setBankData:function(t){var e;t.warn?($("#bankContainer").hide(),$("#nabankContainer").show()):($("#bankContainer").show(),$("#nabankContainer").hide(),$("#my-deposits").text(t.my),e=1e3<=t.total&&t.total.toString().length<=6?Math.floor(t.total/1e3)+" K":7<=t.total.toString().length?Math.floor(t.total/1e3)/1e3+" M":t.total,$("#total-deposits").text(e),$("#make-deposit").attr({max:Lt.gold}),$("#take-deposit").attr({max:t.my}))},setClanData:function(t){var e,i;void 0!==Lt.clan&&""!==Lt.clan||Lt.clanRequest&&""!==Lt.clanRequest?Lt.clanRequest&&""!==Lt.clanRequest?($("#clan-name").text("You already requested to join a clan"),$("#yes-clan").hide(),$("#no-clan").hide(),$("#request-clan").show(),(e=$("#player-request-table")).html("<tr><th>Request</th><th>Action</th></tr>"),i="<tr><td>"+Lt.clanRequest+'</td><td><div data-tooltip="Cancel request" data-tooltip-location="bottom" style="display: inline-block"><i data-event="cancel-request" class="icofont icofont-close btn btn-danger clan-button"></i></div></td></tr>',e.append(i)):($("#clan-name").text("Your clan: ["+Lt.clan+"]"),$("#yes-clan").show(),$("#request-clan").hide(),$("#no-clan").hide(),$("#request-clan-button").hide(),$("#yes-clan").is(":visible")&&"force"!==t||be.emit("clan","get-data",function(t){var e,i=$("#clan-table"),o="<tr><th>Player name</th><th>Clan Role</th>"+(!0===Lt.clanLeader||!0===Lt.clanOwner?"<th>Action</th>":"")+"</tr>";for(var s in i.html(o),t.clanLeader){var n=t.clanLeader[s]===t.clanOwner?"<tr><td>"+t.clanLeader[s]+"</td><td>OWNER</td></tr>":"<tr><td>"+t.clanLeader[s]+"</td><td>LEADER</td>"+(!0===Lt.clanOwner?'<td><div data-tooltip="Kick from clan" data-tooltip-location="top" style="display: inline-block"><i data-event="kick-clan" data-id="'+t.clanLeader[s]+'" class="icofont icofont-delete btn btn-danger clan-button"></i></div></td>':"")+"</tr>";i.append(n)}for(var a in t.clanMembers){t.clanLeader.includes(t.clanMembers[a])||(e="<tr><td>"+t.clanMembers[a]+"</td><td>MEMBER</td>"+(!0===Lt.clanOwner?'<td><div data-tooltip="Promote to clan leader" data-tooltip-location="top" style="display: inline-block"><i data-event="promote-clan" data-id="'+t.clanMembers[a]+'" class="icofont icofont-arrow-up btn btn-success clan-button"></i></div><div data-tooltip="Kick from clan" data-tooltip-location="top" style="display: inline-block"><i data-event="kick-clan" data-id="'+t.clanMembers[a]+'" class="icofont icofont-delete btn btn-danger clan-button"></i></div></td>':!0===Lt.clanLeader?'<td><div data-tooltip="Kick from clan" data-tooltip-location="top" style="display: inline-block"><i data-event="kick-clan" data-id="'+t.clanMembers[a]+'" class="icofont icofont-delete btn btn-danger clan-button"></i></div></td>':"")+"</tr>",i.append(e))}var r=$("#request-clan-button");if((!0===Lt.clanLeader||!0===Lt.clanOwner)&&($("#request-clan-button").show(),r.show(),t.clanRequests)){0<t.clanRequests.length?r.removeClass("btn-warning disabled").addClass("btn-success").text("View requests ("+t.clanRequests.length+")"):0===t.clanRequests.length&&r.removeClass("btn-success").addClass("btn-warning disabled").text("View requests ("+t.clanRequests.length+")");var l=$("#clan-request-table");for(var c in l.html("<tr><th>Player name</th><th>Action</th></tr>"),t.clanRequests){var h="<tr><td>"+t.clanRequests[c]+'<td><div data-tooltip="Accept request" data-tooltip-location="bottom" style="display: inline-block"><i data-event="accept-request" data-id="'+t.clanRequests[c]+'" class="icofont icofont-check btn btn-success clan-button"></i></div><div data-tooltip="Reject request" data-tooltip-location="bottom" style="display: inline-block"><i data-event="decline-request" data-id="'+t.clanRequests[c]+'" class="icofont icofont-close btn btn-danger clan-button"></i></div></td></tr>';l.append(h)}}})):($("#clan-name").text("You don't have any clan yet"),$("#yes-clan").hide(),$("#request-clan").hide(),$("#no-clan").show(),Ut.hideAllClanErrors())},hideAllClanErrors:function(){$("#errorInput").hide(),$("#errorLength").hide(),$("#error404").hide(),$("#errorExists").hide(),$("#errorUndefined").hide(),$("#errorUnauthorized").hide()},showShipStatus:function(){$("#clan-management").removeClass("active"),$("#ship-status").addClass("active"),$("#notLoggedIn-container").hide(),$("#ship-status-container").is(":visible")||($("#ship-status-container").show(),$("#clan-management-container").hide())},updateLeaderboard:function(t){var e=t.players,i=t.boats;if(Lt&&Lt.parent&&tt){if(tt&&(Lt=tt[myPlayerId],Pt=tt[Lt.parent.id]),0<t.boats.length)for(n in t.boats)t.boats[n]&&t.boats[n].id===Pt.id&&(Pt.overall_kills=t.boats[n].ok,Pt.overall_cargo=t.boats[n].oc);i.forEach(function(t){void 0!==tt[t.id]&&tt[t.id].setName(t.cN)});var o=i.filter(function(t){if(Pt)return t.id===Pt.id}).pop();if(Pt&&o){this.leadersUiConfiguration.active=o.cI===Lt.id,this.updateLeadersUi();var s=0;for(var n in o.players)s+=o.players[n].cargoUsed;$(".ship-cargo").html(s+"/"+dt[Pt.shipclassId].cargoSize),$(".my-krew-name").text(Pt.crewName)}else $(".ship-cargo").html("/"),$(".my-krew-name").html("Join a krew or buy a ship").css("fontSize",17);e.sort(function(t,e){return e.g-t.g});var a=e.slice(0,15),r=0,l=a.length,c=e.length+" players",h=$('<div id="player-leaderbord-data"/>');if(Lt)for(;r<15&&r<l;r++){var d=a[r].sS,p=a[r].d,u=a[r].l,m=void 0!==a[r].c&&""!==a[r].c?"["+a[r].c+"]":"",f=1050<=a[r].s&&a[r].s.length<=6?Math.floor((a[r].s-50)/1e3)+" K":a[r].s-50,g=1e3<=a[r].g&&a[r].g.toString().length<=6?Math.floor(a[r].g/1e3)+" K":7<=a[r].g.toString().length?Math.floor(a[r].g/1e3)/1e3+" M":a[r].g,y=$('<div style="max-width: 100%; grid-column: 1;"'+(a[r].id===Lt.id?' class="text-success"':"")+">"+(r+1)+'.</div><div style="grid-column: 2"><span class="playerName'+(a[r].id===Lt.id?' text-success"':'"')+'" style="margin-left:2px;font-size: 13px"></span></div><div style="grid-column: 3"><span'+(a[r].id===Lt.id?' class="text-success"':"")+">"+m+'</span></div><div style="grid-column: 4"><span'+(a[r].id===Lt.id?' class="text-success"':"")+">"+u+'</span></div><div style="grid-column: 5"><span'+(a[r].id===Lt.id?' class="text-success"':"")+">"+d+'</span></div><div style="grid-column: 6"><span'+(a[r].id===Lt.id?' class="text-success"':"")+">"+p+'</span></div><div style="grid-column: 7"><span'+(a[r].id===Lt.id?' class="text-success"':"")+">"+f+'</span></div><div style="grid-column: 8; text-align: right"><span'+(a[r].id===Lt.id?' class="text-success"':"")+">"+g+"</span></div>");y.find(".playerName").text(a[r].n),h.append(y)}$("#playerScoreData").html(h),$("#player-count").html(c),t.boats.sort(function(t,e){return e.g-t.g});var b=t.boats.slice(0,10),v=$('<div id="leaderboard-data-div"/>'),w=0,k=b.length;if(Pt)for(;w<10&&w<k;w++){var x=t.boats.length+" boats",E=b[w].ok,C=b[w].oc,m=void 0!==b[w].c&&""!==b[w].c?"["+b[w].c+"]":"",_=b[w].oql,T=1e3<=b[w].g&&b[w].g.toString().length<=6?Math.floor(b[w].g/1e3)+" K":7<=b[w].g.toString().length?Math.floor(b[w].g/1e3)/1e3+" M":b[w].g,S=$("<div"+(b[w].id===Pt.id?' class="text-success grid-left"':' class="grid-left"')+">"+m+'</div><div style="max-width: 100%;"'+(b[w].id===Pt.id?' class="text-success grid-middle"':' class="grid-middle"')+'><span class=\'krewName\' style=\'margin-left:2px;font-size: 13px\'></span></div><div class="grid-middle"><img id="img1" src="./assets/img/medal_'+(15e4<=C?"gold":5e4<=C?"silver":"bronze")+'.png"'+(12e3<=C?' style="height: 17px"':'style="height: 17px; display:none"')+'><img id="img2" src="./assets/img/medal_'+(50<=E?"gold":20<=E?"silver":"bronze")+'.png"'+(10<=E?' style="height: 17px"':'style="height: 17px; display:none"')+'><img id="img3" src="./assets/img/medal_'+(3===_?"gold":2===_?"silver":"bronze")+'.png"'+(0<_?' style="height: 17px"':'style="height: 17px; display:none"')+"></div><div"+(b[w].id===Pt.id?' class="text-success grid-right"':' class="grid-right"')+">"+T+"</div>");S.find(".krewName").text(b[w].cN),v.append(S)}$("#leaderboard-data").html(v),$("#boat-count").html(x);var M=[],R=0,I=$("<div/>");for(n in e)void 0!==tt[e[n].id]&&tt[e[n].id].setName(e[n].n),Pt&&e[n].pI===Pt.id&&M.push({key:n,value:e[n]});for(n in M.sort(function(t,e){return t.value.s-e.value.s}),M){var L=M[n].value,P='<div class="player-list-item">';if(P+=L.n+(L.id===myPlayerId?" (ME)":""),L.id!==myPlayerId&&!0===Lt.isCaptain&&(P+='<span class="btn btn-danger btn-kick-player float-sm-right" data-event="kick" data-id="'+L.id+'"><i data-event="kick" data-id="'+L.id+'" class="icofont icofont-delete"></i></span><span class="btn btn-warning btn-transfer-ship float-sm-right" data-event="transfer" data-id="'+L.id+'"><i data-event="transfer" data-id="'+L.id+'" class="icofont icofont-ship-wheel"></i></span>'),P+='<span class="float-sm-right">',L.id===myPlayerId&&void 0!==Lt.goods){for(var H in Lt.goods)0<Lt.goods[H]&&(P+=" "+Lt.goods[H]+" "+H);P+=' <i class="text-warning icofont icofont-cube"></i> '+L.cU}else P+=' <i class="text-warning icofont icofont-cube"></i> '+L.cU;P+="</span>",P+="</div>",$playerDiv=$(P),Pt.captainId===L.id&&$playerDiv.prepend($("<span/>",{class:"icofont icofont-ship-wheel text-warning",text:" "})),L.id===myPlayerId&&($playerDiv.addClass("text-success"),this.checkGoldDelta(L.g),Lt.clan=L.c,Lt.clanLeader=L.cL,Lt.clanOwner=L.cO,Lt.clanRequest=L.cR,Lt.gold=parseInt(L.g),Lt.score=parseInt(L.s),Lt.shipsSank=parseInt(L.sS),Lt.overall_cargo=parseInt(L.oc)),I.append($playerDiv),R++}Pt&&this.updateShipStats({krewCount:R}),$("#krew-list").html(I)}},getKrewioData:function(t){var i=this;return t&&$.ajaxSetup({headers:{Token:t}}),$.get(Ft+"/get_krewiodata").then(function(t){var e;"error"!==t.status?(Ut.isLoggedIn=!0,e=t.data,$("#logged-in").html("You are logged in as <b>"+e.name+"</b>").show(),$("#login-link").attr("href","/logout").html("Logout").show(),i.token=t.data.token):$("#login-with-moddio-button").attr("disabled",!1).show().on("click",function(){return $("#login-with-moddio-modal").modal("show"),!1})})},setSpawnPlace:function(){return spawn=$("#spawn-selection").val(),spawn},updateServerList:function(){var r=this;$.ajax({url:Ft+"/get_servers",data:{gameId:"59a714c837cc44805415df18"},dataType:"jsonp",type:"GET",success:function(t){Ut.servers=t;var e=!1;$("#server-list").html("");var i,o=0;for(i in t){var s=t[i];o++;var n=$("<option/>",{html:"Server "+o+" ("+s.playerCount+"/"+$e+")",value:i});$("#server-list").append(n),!e&&s.playerCount<$e&&($("#server-list").val(i),e=!0)}var a=r.getUrlVars();a.sid&&$("#server-list").val(a.sid)}})},createWallOfFame:function(){$.get("wall-of-fame",function(t,e){if("success"===e){var i="";for(var o in t){var s=t[o].highscore,n=""!==t[o].clan?"["+t[o].clan+"]":"";1e3<=s&&s.toString().length<=6?s=s/1e3+" K":7<=s.toString().length&&(s=Math.floor(s/1e3)/1e3+" M"),i=0==o?'<tr><td class="rank">'+(parseInt(o)+1)+'</td><td class="top-1">'+t[o].playerName+'</td><td class="top-1">'+n+'</td><td class="top-1">'+s+"</td></tr>":o<=2?'<tr><td class="rank">'+(parseInt(o)+1)+'</td><td class="top-2-3">'+t[o].playerName+'</td><td class="top-2-3">'+n+'</td><td class="top-2-3">'+s+"</td></tr>":o<=9?'<tr><td class="rank">'+(parseInt(o)+1)+"</td><td>"+t[o].playerName+"</td><td>"+n+"</td><td>"+s+"</td></tr>":'<tr class="top20" style="display:none"><td class="rank">'+(parseInt(o)+1)+"</td><td>"+t[o].playerName+"</td><td>"+n+"</td><td>"+s+"</td></tr>",$("#wall-of-fame-table").append(i)}}})},setQualitySettings:function(){$("#quality-list").html("");var t=$("<option/>",{html:"High Quality (slow)",value:3});$("#quality-list").append(t),t=$("<option/>",{html:"Medium Quality (fast)",value:2}),$("#quality-list").append(t),t=$("<option/>",{html:"Low Quality (faster)",value:1}),$("#quality-list").append(t)},getUrlVars:function(){var o={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,i){o[e]=i}),o},leadersUiConfiguration:{editingName:!1,active:!1},updateLeadersUi:function(){var t=$("#crew-name-edit-button");this.leadersUiConfiguration.active&&!this.leadersUiConfiguration.editingName?t.removeClass("hidden"):t.addClass("hidden")},LoadingWheel:function(t){"show"===t?$("#loading-wheel").show():$("#loading-wheel").hide()}},Wt=10,Vt=!1,Gt={},Kt=!1,Jt=document.createElement("div");Jt.innerHTML="&nbsp;",Jt.className="adsbox",document.body.appendChild(Jt),window.setTimeout(function(){0===Jt.offsetHeight&&(Kt=!0),Jt.remove(),Kt&&($("#KRW_krew-io_300x250_2").parent().html('<img src="./assets/img/251sbb.jpg" alt="" style="width: 100%"/>'),$("#div-gpt-ad-1491569839954-0").parent().html('<img src="./assets/img/251s91.jpg" alt="" style="width: 100%"/>'),$("#disable-adblock-message").show())},1e3),void 0===UA||UA.isFirefox()||UA.isMobile()||$("#we-play-better-on-firefox").show();setInterval(function(){he()},1e3),setInterval(function(){le()},9e4),window.logoutUser=function(){$.ajax({type:"GET",url:"/logout",success:function(){window.location="/"}})},window.userLogin=function(t){t&&t.preventDefault();var e={username:$("#username").val().trim(),password:$("#password").val()};$.ajax({type:"POST",url:Ft+"/login",data:e,headers:{accept:"application/json"},success:function(t){"success"===t.response?(document.cookie="loginToken="+t.message.token,document.cookie="username="+e.username,Ut.getKrewioData(t.message.token).then(function(){$("#login-with-moddio-modal").modal("hide"),$("#login-with-moddio-button").hide(),$("#play-button").removeClass("btn-success").addClass("btn-warning").text("Play as "+e.username)}),(Te.includes(e.username)||_e.includes(e.username))&&$("#chat-message").attr("maxlength","120")):$("#login-error").addClass("d-block").text(t.message)},async:!1})};function Xt(){var o=function(){var o=CanvasMap(document.getElementById("minimap"),rt,rt);o.useRadians=!0,o.zoom=.9;var t=rt/2,s=performance.now(),e={x:o.text({x:t,y:t,text:"+",fill:"rgba(84,48,13,0.7)",size:260,baseline:"middle"}),n:o.text({x:t,y:t-300,text:"N",fill:"rgba(84,48,13,0.7)",size:160,baseline:"middle"}),s:o.text({x:t,y:300+t,text:"S",fill:"rgba(84,48,13,0.7)",size:160,baseline:"middle"}),w:o.text({x:t-300,y:t,text:"W",fill:"rgba(84,48,13,0.7)",size:160,baseline:"middle"}),e:o.text({x:300+t,y:t,text:"E",fill:"rgba(84,48,13,0.7)",size:160,baseline:"middle"}),boundary:o.rect({x:0,y:0,width:rt,height:rt,stroke:{color:"rgba(84,48,13,1)",width:8}})};o.add(e.x).add(e.n).add(e.s).add(e.w).add(e.e).add(e.boundary);return o.update=function(){if(performance.now()-s>1e3/24){if(void 0===tt&&(o.elements={}),void 0!==tt){for(var t in o.elements)5!==o.elements[t].netType&&0!==o.elements[t].netType&&4!==o.elements[t].netType||void 0!==tt[t]||o.remove(o.elements[t]);for(var t in tt)5===tt[t].netType&&void 0===o.elements[t]&&o.add(o.point({x:tt[t].position.x,y:tt[t].position.z,r:tt[t].dockRadius,fill:"green",id:t,netType:5})).add(o.text({x:tt[t].position.x,y:tt[t].position.z-120,text:tt[t].name,fill:"rgba(84,48,13,1)",font:"serif",id:t+"-label",size:140})),4===tt[t].netType&&4===tt[t].type&&void 0===o.elements[t]&&o.add(o.text({x:tt[t].position.x,y:tt[t].position.z,text:"x",fill:"rgba(204, 10, 10, 1)",font:"sans-serif",id:t,size:140,netType:4}));for(var t in Gt)void 0===o.elements[t]&&o.add(o.point({x:Gt[t].x,y:Gt[t].y,r:30,d:.5,id:t,creatTime:performance.now(),fill:"rgba(255, 0, 0, 0.5)"})),void 0!==o.elements[t]&&(o.elements[t].creatTime<performance.now()-1e4?(o.remove(o.elements[t]),delete Gt[t]):(o.elements[t].r=o.elements[t].r+5*Math.sin(o.elements[t].d),o.elements[t].d+=.2))}var e,i;Lt&&Lt.geometry&&(e=Lt.geometry.getWorldPosition(),i=Lt.parent&&1===Lt.parent.netType&&0===Lt.parent.shipState?Lt.parent.geometry.getWorldRotation().y+Math.PI:Lt.geometry.getWorldRotation().y,i*=-1,void 0===o.elements[Lt.id]&&o.add(o.triangle({x:Lt.position.x,y:Lt.position.z,size:60,rotation:i,fill:"white",stroke:{color:"black",width:15},id:Lt.id,netType:0})),void 0!==o.elements[Lt.id]&&(o.elements[Lt.id].x=e.x,o.elements[Lt.id].y=e.z,o.elements[Lt.id].rotation=i)),o.draw(),s=performance.now()}},o}();Mt=new THREE.WebGLRenderer({antialias:!0}),document.body.appendChild(Mt.domElement),controls=new G,T=new window.keypress.Listener(document.getElementById("body"),{is_unordered:!0,prevent_repeat:!0,prevent_default:!0}),$("input[type=text], input[type=number], input[type=password]").bind("focus",function(){T.stop_listening()}).bind("blur",function(){T.listen()}),document.onkeyup=function(t){27===(t=t||window.event).keyCode?Lt&&(Lt.target=void 0):13===t.keyCode?$("#chat-message").is(":focus")?$("#chat-message").blur():$("#chat-message").focus():38!==t.keyCode||$("#chat-message").is(":focus")||$("#crew-name-edit-input").is(":focus")?39!==t.keyCode||$("#chat-message").is(":focus")||$("#crew-name-edit-input").is(":focus")?40!==t.keyCode||$("#chat-message").is(":focus")||$("#crew-name-edit-input").is(":focus")?37!==t.keyCode||$("#chat-message").is(":focus")||$("#crew-name-edit-input").is(":focus")?16!==t.keyCode||$("#chat-message").is(":focus")||$("#crew-name-edit-input").is(":focus")||$("#player-leaderboard").hide():D=!1:W=!1:j=!1:U=!1},K(),Rt=new THREE.Scene,(It=new THREE.PerspectiveCamera(75,1.8,.1,1e4)).position.set(0,10,0),new THREE.Raycaster,Rt.fog=new THREE.FogExp2(14016995,.007),Mt.setClearColor(50687),ambientlight=new THREE.AmbientLight(12898018),Rt.add(ambientlight),w.sphere=new THREE.Mesh((new THREE.BufferGeometry).fromGeometry(new THREE.SphereGeometry(4e3)),E.sky),Rt.add(w.sphere),w.sphere.scale.y=.05,THREE.Water=function(t,e){THREE.Mesh.call(this,t);var i=void 0!==(e=e||{}).textureWidth?e.textureWidth:512,o=void 0!==e.textureHeight?e.textureHeight:512,s=void 0!==e.alpha?e.alpha:1,n=void 0!==e.time?e.time:0,a=void 0!==e.waterNormals?e.waterNormals:null,r=void 0!==e.sunDirection?e.sunDirection:new THREE.Vector3(.70707,.70707,0),l=new THREE.Color(void 0!==e.sunColor?e.sunColor:16777215),c=new THREE.Color(void 0!==e.waterColor?e.waterColor:8355711),h=void 0!==e.eye?e.eye:new THREE.Vector3(0,0,0),d=void 0!==e.distortionScale?e.distortionScale:20,p=void 0!==e.side?e.side:THREE.FrontSide,u=void 0!==e.fog&&e.fog,m=(new THREE.Vector3,new THREE.Vector3,new THREE.Matrix4),f={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},g=new THREE.WebGLRenderTarget(i,o,f);THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(o)||(g.texture.generateMipmaps=!1);var y={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:10},distortionScale:{value:0},textureMatrix:{value:new THREE.Matrix4},sunColor:{value:new THREE.Color(8355711)},sunDirection:{value:new THREE.Vector3(0,.70707,0)},eye:{value:new THREE.Vector3},waterColor:{value:new THREE.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",THREE.ShaderChunk.fog_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.fog_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor -= pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor -= max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = vec3( 0.7, 0.5, 0.9 );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.001 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},b=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:THREE.UniformsUtils.clone(y.uniforms),transparent:!1,lights:!0,side:p,fog:u});b.uniforms.mirrorSampler.value=g.texture,b.uniforms.textureMatrix.value=m,b.uniforms.alpha.value=s,b.uniforms.time.value=n,b.uniforms.normalSampler.value=a,b.uniforms.sunColor.value=l,b.uniforms.waterColor.value=c,b.uniforms.sunDirection.value=r,b.uniforms.distortionScale.value=d,b.uniforms.eye.value=h,this.material=b,this.onBeforeRender=function(t,e,i){var o=t.getRenderTarget();t.setRenderTarget(g),t.clear(),t.setRenderTarget(o)}},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,function(){light=new THREE.DirectionalLight(16381658,.5),light.position.set(0,100,0),Rt.add(light);var t=new THREE.PlaneBufferGeometry(6e3,6e3);water=new THREE.Water(t,{textureWidth:512,textureHeight:512,waterNormals:P.water,alpha:1,sunDirection:light.position.clone().normalize(),sunColor:16777215,waterColor:9421810,distortionScale:10,fog:void 0!==Rt.fog}),water.rotation.x=-Math.PI/2,Rt.add(water)}(),w.boundaryLeft=new THREE.Mesh(k.box,E.boundary),w.boundaryLeft.position.set(.5*rt,1.5,0),w.boundaryLeft.scale.set(rt,.1,3),Rt.add(w.boundaryLeft),w.boundaryRight=new THREE.Mesh(k.box,E.boundary),w.boundaryRight.position.set(.5*rt,1.5,rt),w.boundaryRight.scale.set(rt,.1,3),Rt.add(w.boundaryRight),w.boundaryUp=new THREE.Mesh(k.box,E.boundary),w.boundaryUp.position.set(0,1.5,.5*rt),w.boundaryUp.scale.set(3,.1,rt),Rt.add(w.boundaryUp),w.boundaryDown=new THREE.Mesh(k.box,E.boundary),w.boundaryDown.position.set(rt,1.5,.5*rt),w.boundaryDown.scale.set(3,.1,rt),Rt.add(w.boundaryDown),v(),Ht=Mt.domElement,At=(At=Ht.getContext("webgl2"))||Ht.getContext("experimental-webgl"),Ot=At.canvas.width,zt=At.canvas.height,lastFrameTime=performance.now();var s=function(){var t=performance.now();water.material.uniforms.time.value+=1/60;var i=Math.min((t-lastFrameTime)/1e3,.1);lastFrameTime=t,function(t){for(e in tt)tt.hasOwnProperty(e)&&tt[e].tick(t)}(i),we(i),o.update(),requestAnimationFrame(s),Mt.clear(),Mt.render(Rt,It)};s()}function Yt(t){var e=t+"";return e.length<2?"0"+e:e}function Qt(){be.emit("chat message",{message:$("#chat-message").val(),recipient:xe?"local":ke?"clan":"global"}),$("#chat-message").val("").focus()}function Zt(){var t=+$("#make-deposit").val(),e=parseInt($("#my-deposits").text())+t;t<=Lt.gold&&e<=15e4?(be.emit("bank",{deposit:t}),$("#make-deposit").val("").focus(),$("#successMakeDepoMess").show(),$("#errorMakeDepoMess").hide(),$("#successTakeDepoMess").hide(),$("#errorTakeDepoMess").hide(),$("#errorFullDepoMess").hide()):15e4<e?($("#errorFullDepoMess").show(),$("#successMakeDepoMess").hide(),$("#errorMakeDepoMess").hide(),$("#successTakeDepoMess").hide(),$("#errorTakeDepoMess").hide()):($("#errorMakeDepoMess").show(),$("#successMakeDepoMess").hide(),$("#successTakeDepoMess").hide(),$("#errorTakeDepoMess").hide(),$("#errorFullDepoMess").hide())}function te(){var t=+$("#take-deposit").val();t<=+$("#my-deposits").text()?(be.emit("bank",{takedeposit:t}),$("#take-deposit").val("").focus(),$("#successTakeDepoMess").show(),$("#successMakeDepoMess").hide(),$("#errorMakeDepoMess").hide(),$("#errorTakeDepoMess").hide()):($("#errorTakeDepoMess").show(),$("#successTakeDepoMess").hide(),$("#successMakeDepoMess").hide(),$("#errorMakeDepoMess").hide()),$("#errorFullDepoMess").hide()}function ee(i,o){FB.login(function(t){var e=t.authResponse.accessToken;t.authResponse&&(FB.api("/me","get",{access_token:e},function(t){}),FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":"http://"+o,"og:title":"Krew.io","og:description":i,"og:image":"http://krew.io/assets/img/logo.png"}})}))},{scope:"publish_actions"})}var ie=function(){$("#toggle-shop-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md disabled toggle-krew-list-modal-button").addClass("btn btn-md enabled toggle-krew-list-modal-button"),"Labrador"===tt[Lt.parent.anchorIslandId].name&&$("#toggle-bank-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button").attr("data-tooltip","Deposit or withdraw gold"),$("#exit-island-button").hide(),Ut.updateStore($(".btn-shopping-modal.active")),Ut.updateKrewList()},oe=$("#docking-modal-button"),se=oe.find("span"),ne=$(".port-name"),ae=$("#cancel-exit-button").find("span"),re=$("#docking-modal"),le=function(){Rt.traverse(function(t){if(t instanceof THREE.Mesh)for(o in st){st[o]==t&&(Rt.remove(t),delete st[o])}if(t instanceof THREE.Line)for(l in nt){nt[l]==t&&(Rt.remove(t),nt[l].geometry.dispose(),delete nt[l])}})},ce=0,he=function(){if(++ce,$("#seconds").html(Yt(ce%60)),$("#minutes").html(Yt(parseInt(ce%3600/60))),$("#hours").html(Yt(parseInt(ce/3600))),Lt&&Lt.parent){if(-1===Lt.parent.shipState||3===Lt.parent.shipState)return oe.removeClass("btn btn-primary disabled btn-lg").addClass("btn btn-primary enabled btn-lg"),ne.text(tt[Lt.parent.anchorIslandId].name),se.text("Countdown..."),void ae.text("Sail (c)");5==Lt.parent.netType&&(ne.text(Lt.parent.name),re.is(":visible")&&(re.hide(),ie())),re.hasClass("initial")&&re.removeClass("initial").find("#you-are-docked-message").remove(),1!==Lt.parent.shipState&&(Wt=8),1===Lt.parent.shipState&&(8===Wt&&be.emit("dock"),ae.text("Cancel (c)"),0!==Wt&&0<Wt?se.text("Docking in "+Wt+" seconds"):(se.text("Dock (z)"),oe.removeClass("btn btn-primary disabled btn-lg").addClass("btn btn-primary enabled btn-lg")),Wt--),4===Lt.parent.shipState&&($("#docking-modal").hide(),$("#departure-modal").is(":visible")||$("#departure-modal").show(0),$("#cancel-departure-button").find("span").text((Lt&&Lt.isCaptain?"Departing in ":"Krew departing in ")+tt[Lt.id].parent.departureTime+" seconds")),(!Lt.isCaptain&&4!==Lt.parent.shipState||Lt.isCaptain&&0===Lt.parent.shipState)&&$("#departure-modal").is(":visible")&&$("#departure-modal").hide()}},de=function(){Lt&&tt[Lt.id]&&tt[Lt.id].parent&&($("#docking-modal").hide(),this.departureCounter=this.departureCounter||0,be.emit("departure",this.departureCounter),this.departureCounter+=1,2<this.departureCounter&&(this.departureCounter=0))},pe=function(){be.emit("bank")};$(document).ready(function(){z.loadObjWithMtl("./assets/models/cannon/cannon.obj"),z.loadObjWithMtl("./assets/models/hat_pirate.obj"),z.loadObjWithMtl("./assets/models/ships/bigship.obj"),z.loadObjWithMtl("./assets/models/ships/schooner.obj"),z.loadObjWithMtl("./assets/models/ships/sloop.obj"),z.loadObjWithMtl("./assets/models/ships/vessel.obj"),z.loadObjWithMtl("./assets/models/fish.obj"),z.loadObjWithMtl("./assets/models/shell.obj"),z.loadObjWithMtl("./assets/models/crab.obj"),z.loadObjWithMtl("./assets/models/clam.obj"),z.loadObjWithMtl("./assets/models/chest.obj"),z.loadModel("./assets/models/ships/raft.obj"),z.loadModel("./assets/models/ships/trader.obj"),z.loadModel("./assets/models/ships/boat.obj"),z.loadModel("./assets/models/ships/destroyer.obj"),z.loadModel("./assets/models/island.obj"),z.loadModel("./assets/models/dogs/dog_1.obj"),z.loadModel("./assets/models/fishingrod.obj"),z.loadTexture("./assets/models/colorset.png"),z.loadTexture("./assets/models/hook.png"),z.loadTexture("./assets/models/dogs/dog_diffuse.tga"),z.loadTexture("./assets/models/props_diffuse1.tga"),z.loadTexture("./assets/img/water.jpg"),z.loadTexture("./assets/img/cannonball.png"),z.loadTexture("./assets/img/crate.jpg"),z.loadTexture("./assets/models/tex_chest.png"),z.onFinish(function(){ga("create","UA-88411681-1","auto");var t,e=document.cookie.split("; ");for(var i in e){e[i].startsWith("_ga=")&&(t=e[i].substring(4))}sessionCookie=t,x.island=A.island.children[0].geometry,x.palm=A.island.children[1].geometry,x.dog_1=A.dog_1.children[0].geometry,x.fishingrod=A.fishingrod.children[0].geometry,A.sloop.children[0].name="sail",A.sloop.children[1].name="body",A.sloop.children[2].name="mast",A.bigship.children[0].name="body",A.bigship.children[1].name="mast",A.bigship.children[2].name="sail",A.schooner.children[0].name="body",A.schooner.children[1].name="mast",A.schooner.children[2].name="sail",A.vessel.children[0].name="body",A.vessel.children[1].name="mast",A.vessel.children[2].name="sail",A.raft.children[1].name="body",A.raft.children[0].name="sail",A.trader.children[2].name="body",A.trader.children[0].name="sail",A.boat.children[2].name="body",A.boat.children[0].name="sail",A.destroyer.children[1].name="body",A.destroyer.children[0].name="sail",A.raft.getObjectByName("body").material=E.boat,A.raft.getObjectByName("sail").material=E.sail,A.trader.getObjectByName("body").material=E.boat,A.trader.getObjectByName("sail").material=E.sail,A.boat.getObjectByName("body").material=E.boat,A.boat.getObjectByName("sail").material=E.sailRed,A.destroyer.getObjectByName("body").material=E.boat,A.destroyer.getObjectByName("sail").material=E.sail,mt(),Tt(),E.cannonball=new THREE.SpriteMaterial({map:P.cannonball,color:16777215,fog:!0}),E.fishingrod=new THREE.MeshPhongMaterial({color:16777215,map:P.props_diffuse1}),E.colorset=new THREE.MeshLambertMaterial({map:P.colorset,side:THREE.DoubleSide}),E.hook=new THREE.MeshLambertMaterial({map:P.hook,side:THREE.DoubleSide,transparent:!0}),E.colorset_captain=new THREE.MeshLambertMaterial({map:P.colorset,side:THREE.DoubleSide,emissive:1842204}),E.transparentDetails=new THREE.MeshLambertMaterial({map:P.colorset,side:THREE.DoubleSide,opacity:.025,transparent:!0}),E.crate=new THREE.MeshLambertMaterial({map:P.crate}),E.chest=new THREE.MeshLambertMaterial({map:P.chest}),P.water.wrapS=P.water.wrapT=THREE.RepeatWrapping,Xt(),Vt=!0,Ut.getKrewioData().then(function(){$("#play-button").text("Play as guest").attr("disabled",!1)})}),$("#show-more").on("click",function(){-1<$("#show-more").text().indexOf("Show more")?($(".top20").show(),$("#show-more").html('<i class="icofont icofont-medal"></i> Show less')):($(".top20").hide(),$("#show-more").html('<i class="icofont icofont-medal"></i> Show more'))}),$("#chat-message").on("keyup",function(){var t=$(this),e=t.val();150<e.trim().length&&t.val(e.slice(0,150))}),$("#play-button").on("click",function(){GameAnalytics("addDesignEvent","Game:Session:ClickedPlayButton"),Vt&&(Se($("#server-list").val()),Ut.setQualitySettings(),$("#quality-list").val(2),$("#quality-list").trigger("change"),Ut.LoadingWheel("show"))}).text("Loading...").attr("disabled",!0),$("#play-again-button").on("click",function(){Vt&&(Ut.showAdinplayCentered(),ce=0,be.emit("respawn"),Lt.itemId=void 0,Lt.state=2,$("#toggle-shop-modal-button").removeClass("btn btn-md enabled toggle-shop-modal-button").addClass("btn btn-md disabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md enabled toggle-krew-list-modal-button").addClass("btn btn-md disabled toggle-krew-list-modal-button"),$("#toggle-bank-modal-button").removeClass("btn btn-md enabled toggle-shop-modal-button").addClass("btn btn-md disabled toggle-shop-modal-button").attr("data-tooltip","Bank is available at Labrador"))}),$("#share-link").on("click",function(){ee("I just had an amazing game of krew.io and my score was "+Dt,"krew.io/"),Ut.showAdinplayCentered(),ce=0,be.emit("respawn"),Lt.state=2,Lt.itemId=void 0,$("#toggle-shop-modal-button").removeClass("btn btn-md enabled toggle-shop-modal-button").addClass("btn btn-md disabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md enabled toggle-krew-list-modal-button").addClass("btn btn-md disabled toggle-krew-list-modal-button"),$("#toggle-bank-modal-button").removeClass("btn btn-md enabled toggle-shop-modal-button").addClass("btn btn-md disabled toggle-shop-modal-button").attr("data-tooltip","Bank is available at Labrador"),Ut.updateStore($(".btn-shopping-modal.active")),$("#krew-list-modal").show(),Ut.updateKrewList()}),$("#quality-list").on("change",function(){switch(parseInt($("#quality-list").val())){case 1:void 0!==At&&(t=Ot/2.5,e=zt/2.5,At.canvas.height=e,At.canvas.width=t,At.viewport(0,0,t,t),Mt.setSize(t,t,!1));break;case 2:void 0!==At&&(t=Ot/1.45,e=zt/1.45,At.canvas.height=e,At.canvas.width=t,At.viewport(0,0,t,e),Mt.setSize(t,t,!1));break;case 3:var t,e;void 0!==At&&(t=Ot,e=zt,At.canvas.height=e,At.canvas.width=t,At.viewport(0,0,t,e),Mt.setSize(t,t,!1))}}),$("#share-invite-link").on("click",function(){var t=Ut.getInviteLink();ee("Join my krew!",t)}),Ut.setListeners(),$(window).on("unload",function(){be&&be.close()}),$("#chat-message").on("keypress",function(t){13==t.keyCode&&Qt()}),$("#make-deposit").on("keypress",function(t){13==t.keyCode&&Zt()}),$("#take-deposit").on("keypress",function(t){13==t.keyCode&&te()}),Ut.updateServerList(),Ut.createWallOfFame(),$("#send-message-button").on("click",function(){Qt()}),Re().sid&&Re().bid&&($("#invite-is-used").show(),$("#select-server").hide(),$("#select-spawn").hide()),$("#crew_count, #ship_health, #food").slider(),$("#crew_count").on("slide",function(t){$("#crew_count_val").text(t.value)}),$("#ship_health").on("slide",function(t){$("#ship_health_val").text(t.value)}),$("#hide-shopping-modal-button").on("click",function(){$("#shopping-modal").fadeOut(),3==Pt.shipState&&$("#show-shopping-modal-button").fadeIn()}),$("#show-shopping-modal-button").on("click",function(){$("#shopping-modal").fadeIn()});var e=$(".btn-shopping-modal");e.each(function(){var t=$(this);t.on("click",function(){e.removeClass("active"),t.addClass("active"),Ut.updateStore(t)})}),$("#docking-modal-button").on("click",function(){$("#docking-modal-button").hasClass("enabled")&&(Lt&&Lt.parent&&(be.emit("anchor"),e.eq(2).trigger("click"),"Labrador"===tt[Lt.parent.anchorIslandId].name&&$("#toggle-bank-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button").attr("data-tooltip","Deposit or withdraw gold"),1!=Lt.parent.netType||$("#exit-island-button").is(":visible")||$("#exit-island-button").show()),Dt=0,controls.unLockMouseLook(),$("#docking-modal").hide(),$("#supply").tooltip("show"),$("#toggle-shop-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md disabled toggle-krew-list-modal-button").addClass("btn btn-md enabled toggle-krew-list-modal-button"),Ut.updateStore($(".btn-shopping-modal.active")),$("#recruiting-div").fadeIn("slow"))}),$("#login-modal").modal({show:!0,backdrop:"static",keyboard:!1}),$(".modal-custom").on("show.bs.modal",function(t){setTimeout(function(){$(".modal-backdrop").addClass("modal-backdrop-custom"),$(".modal-custom").removeClass("modal-open")})}),$("#game-over-modal").modal({show:!1,backdrop:"static",keyboard:!1}),$("#chat-global").on("click",function(){ue()}),$("#chat-local").on("click",function(){me()}),$("#chat-clan").on("click",function(){fe()}),$("#hide-chat").on("click",function(){$("#show-chat").show(),$("#chat-div").hide()}),$("#show-chat").on("click",function(){$("#show-chat").hide(),$("#chat-div").show()}),$("#toggle-invite-link-button").on("click",function(){$("#invite-div").is(":visible")?$("#invite-div").hide():($("#invite-link").val(Ut.getInviteLink()),$("#invite-div").show())}),$("#exit-island-button").on("click",function(){de()}),$("#toggle-help-button").on("click",function(){$("#help-modal").is(":visible")?$("#help-modal").hide():(Ut.closeAllPagesExcept("#help-modal"),$("#help-modal").show())}),$("#close-help-button").on("click",function(){$("#help-modal").hide()}),$("#close-bank-button").on("click",function(){$("#bank-modal").hide()}),$("#btn-make-deposit").on("click",function(){Zt()}),$("#btn-take-deposit").on("click",function(){te()}),$("#toggle-quest-button").on("click",function(){$("#quests-modal").is(":visible")?$("#quests-modal").hide():(be.emit("get-stats",function(t){var e=JSON.parse(t);$(".pirate-progress").text(e.shipsSank),$(".crew-pirate-progress").text(e.overall_kills),1<=e.shipsSank&&($("#completed-quest-table").append($("#pirate-quest-1").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#pirate-quest-2").show(),$("#crew-pirate-quest-1").show()),5<=e.shipsSank&&($("#completed-quest-table").append($("#pirate-quest-2").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#pirate-quest-3").show()),10<=e.shipsSank&&($("#completed-quest-table").append($("#pirate-quest-3").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#pirate-quest-4").show()),20<=e.shipsSank&&($("#completed-quest-table").append($("#pirate-quest-4").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>')),10<=e.overall_kills&&($("#completed-quest-table").append($("#crew-pirate-quest-1").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#crew-pirate-quest-2").show()),20<=e.overall_kills&&($("#completed-quest-table").append($("#crew-pirate-quest-2").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#crew-pirate-quest-3").show()),50<=e.overall_kills&&($("#completed-quest-table").append($("#crew-pirate-quest-3").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>')),$(".trade-progress").text(e.overall_cargo),$(".crew-trade-progress").text(e.crew_overall_cargo),1e3<=e.overall_cargo&&($("#completed-quest-table").append($("#trade-quest-1").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#trade-quest-2").show(),$("#crew-trade-quest-1").show()),6e3<=e.overall_cargo&&($("#completed-quest-table").append($("#trade-quest-2").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#trade-quest-3").show()),15e3<=e.overall_cargo&&($("#completed-quest-table").append($("#trade-quest-3").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#trade-quest-4").show()),3e4<=e.overall_cargo&&($("#completed-quest-table").append($("#trade-quest-4").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>')),12e3<=e.crew_overall_cargo&&($("#completed-quest-table").append($("#crew-trade-quest-1").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#crew-trade-quest-2").show()),5e4<=e.crew_overall_cargo&&($("#completed-quest-table").append($("#crew-trade-quest-2").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#crew-trade-quest-3").show()),15e4<=e.crew_overall_cargo&&($("#completed-quest-table").append($("#crew-trade-quest-3").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>')),$("#other-progress-1").text(Lt.jump_count),50<=Lt.jump_count&&($("#completed-quest-table").append($("#other-quest-1").last()),$("#completed-quest-table .quest-progress").html('<i class="icofont icofont-check-circled"></i>'),$("#other-quest-2").show())}),Ut.closeAllPagesExcept("#quests-modal"),$("#quests-modal").show())}),$("#close-quests-button").on("click",function(){$("#quests-modal").css("display","none")}),$("#cancel-exit-button").on("click",function(){"Cancel (c)"===ae.text()&&(be.emit("exitIsland"),se.text("Countdown..."))}),$("#abandon-ship-button").on("click",function(){if(!(Pt.hp<=0)){if(Lt.goods&&(3===Pt.shipState||4===Pt.shipState))for(var t in Lt.goods)0<Lt.goods[t]&&be.emit("buy-goods",{quantity:Lt.goods[t],action:"sell",good:t},function(t,e){t&&console.log(t),t||(Lt.gold=e.gold,Lt.goods=e.goods)});be.emit("abandonShip"),$("#abandon-ship-button").hide(),void 0!==Pt&&(3===Pt.shipState||-1===Pt.shipState||4===Pt.shipState?($("#supply").tooltip("show"),$("#toggle-shop-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md disabled toggle-krew-list-modal-button").addClass("btn btn-md enabled toggle-krew-list-modal-button"),"Labrador"===tt[Lt.parent.anchorIslandId].name&&$("#toggle-bank-modal-button").removeClass("btn btn-md disabled toggle-shop-modal-button").addClass("btn btn-md enabled toggle-shop-modal-button").attr("data-tooltip","Deposit or withdraw gold"),Ut.updateStore($(".btn-shopping-modal.active"))):1===Pt.shipState&&$("#docking-modal").show())}}),$("#lock-krew-button").on("click",function(){$("#lock-krew-button").is(":checked")?($("#lock-krew-text").removeClass("lock-text-info").addClass("lock-text-error").text("Unlock krew..."),be.emit("lock-krew",!0)):($("#lock-krew-text").removeClass("lock-text-error").addClass("lock-text-info").text("Lock krew..."),be.emit("lock-krew",!1))}),localStorage.setItem("lastAdTime",Date.now()-1e7);var t=t||{};t.cmd=t.cmd||[],t.cmd.display=t.cmd.display||[],t.cmd.display.push(function(){aipDisplayTag.display("KRW_krew-io_300x250_2")}),t.gdprShowConsentTool=!0,t.gdprShowConsentToolButton=!0,adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!0,PREROLL_ELEM:document.getElementById("preroll"),AIP_COMPLETE:function(){},AIP_REMOVE:function(){}}),window.adplayerCentered=new aipPlayer({AD_WIDTH:560,AD_HEIGHT:315,AD_FULLSCREEN:!1,PREROLL_ELEM:document.getElementById("preroll-centered"),AIP_COMPLETE:function(){},AIP_REMOVE:function(){}})}),$("#global-chat-alert").hide();var ue=function(){$("#chat-global").addClass("active"),$("#chat-local").removeClass("active"),$("#chat-clan").removeClass("active"),$(".global-chat").show(),$(".local-chat").hide(),$(".clan-chat").hide(),Ee=!(xe=ke=!1),$("#global-chat-alert").hide(),$("#chat-history").scrollTop(function(){return this.scrollHeight})},me=function(){$("#chat-global").removeClass("active"),$("#chat-clan").removeClass("active"),$("#chat-local").addClass("active"),$(".global-chat").hide(),$(".clan-chat").hide(),$(".local-chat").show(),Ee=!(xe=!(ke=!1)),$("#local-chat-alert").hide(),$("#chat-history").scrollTop(function(){return this.scrollHeight})},fe=function(){$("#chat-global").removeClass("active"),$("#chat-local").removeClass("active"),$("#chat-clan").addClass("active"),$(".global-chat").hide(),$(".local-chat").hide(),$(".clan-chat").show(),Ee=xe=!(ke=!0),$("#clan-chat-alert").hide(),$("#chat-history").scrollTop(function(){return this.scrollHeight})},ge={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}},ye=[];y.prototype.tick=function(t){this.vy-=this.gravity*t,this.geometry.position.set(this.geometry.position.x+this.vx*t,this.geometry.position.y+this.vy*t,this.geometry.position.z+this.vz*t),this.geometry.rotation.set(this.geometry.rotation.x+this.rotaSpeed*t,this.geometry.rotation.y+this.rotaSpeed*t,this.geometry.rotation.z+this.rotaSpeed*t),this.globalscale+=this.sizeSpeed*t,this.geometry.scale.set(this.w*this.globalscale,this.h*this.globalscale,this.d*this.globalscale),this.timeleft-=t,(this.timeleft<=0||this.globalscale<=0)&&(Rt.remove(this.geometry),this.deleteMe=!0)};var be,ve=function(t){!Lt||!Lt.parent||1e4<Math.pow(t.x-Lt.parent.position.x,2)+Math.pow(t.z-Lt.parent.position.z,2)||ye.push(new y(t))},we=function(t){for(var e=ye.length;e--;)ye[e].tick(t),ye[e].deleteMe&&ye.splice(e,1)},ke=(document.location.host,!1),xe=!1,Ee=!0,$e=100,Ce=void 0,_e=["LeoLeoLeo","LeoLeoLeo2","harderman","ITSDABOMB"],Te=["Speedy_Sloth","Sj"],Se=function(t){var e,i;null==be&&(Re().pid&&Ut.serverList[Re().pid]&&(t=Re().pid),e=Ut.servers[t],"localhost"==window.location.hostname&&(e={ip:"http://localhost",port:"2001"}),i=e.ip,80!==parseInt(e.port)&&(i+=":"+e.port),be=io(i),Me(),$("#game-ui").show(),$("#login-modal").modal("hide"))},Me=function(){be.on("handshake",function(t){$(window).on("beforeunload",function(){return"Do you really want to leave your ship and lose your progress?"}),Ie(),Lt=void 0,myPlayerId=t.socketId,be.emit("createPIayer",{boatId:Re().bid,token:Ut.token,spawn:Ut.setSpawnPlace(),cookie:sessionCookie}),ce=0,be.on("startGame",function(){Ut.LoadingWheel("hide"),Ut.showCenterMessage("Use WASD to move. Click to shoot/fish. Use 1 & 2 to switch weapons.",4,15e3)}),be.on("playerNames",function(t){ot=t}),be.on("s",function(t){for(e in t=JSON.parse(LZString.decompress(t)))!function(t,i){if(null==tt[t]){switch(i.n){case 0:tt[t]=new h(i),t==myPlayerId&&((Lt=tt[t]).isPlayer=!0);break;case 1:tt[t]=new r(i.t.b);break;case 2:tt[t]=new f;break;case 3:tt[t]=new d(parseInt(i.t.a),parseFloat(i.x),parseFloat(i.z));break;case 4:tt[t]=new u(parseInt(i.t.s),parseFloat(i.x),parseFloat(i.z),parseInt(i.t.t));break;case 5:tt[t]=new m(parseInt(i.t.t),parseFloat(i.x),parseFloat(i.z),i.t);break;case 6:tt[t]=new Bot}void 0!==tt[t]&&(tt[t].id=e,tt[t].clientInit())}void 0!==tt[t]&&tt[t].parseSnap(i,t)}(e,t[e])}),be.on("disconnect",Ie),be.on("end",Le),be.on("scores",function(t){t=JSON.parse(LZString.decompress(t)),Ut.updateLeaderboard(t)}),be.on("setBankData",function(t){Ut.setBankData(t)}),be.on("updateKrewsList",function(){Ut.updateKrewList()}),be.on("cargoUpdated",function(){$("#buy-goods").hasClass("active")&&GOODSCOMPONENT.getList()}),be.on("enterIsland",function(t){t.captainId==myPlayerId&&Lt&&Lt.parent&&2!=Lt.parent.shipState&&$("#docking-modal").show(),$("#toggle-shop-modal-button").hasClass("enabled")&&$("#docking-modal").hide()}),be.on("showIslandMenu",function(){ie()}),be.on("exitIsland",function(t){var e;e=t,controls.lockMouseLook(),e.captainId==myPlayerId&&($("#docking-modal").hide(),$("#departure-modal").hide()),qt=!1,Ut.hideSuggestionBox=!0,$("#toggle-bank-modal-button").removeClass("btn btn-md enabled toggle-shop-modal-button").addClass("btn btn-md disabled toggle-shop-modal-button").attr("data-tooltip","Bank is available at Labrador"),$("#exit-island-button").hide(),$("#shopping-modal").hide(),$("#krew-list-modal").hide(),Ut.updateStore($(".btn-shopping-modal.active")),$("#docking-modal-button").removeClass("btn btn-primary enabled btn-lg").addClass("btn btn-primary disabled btn-lg"),$("#toggle-shop-modal-button").removeClass("btn btn-md enabled toggle-shop-modal-button").addClass("btn btn-md disabled toggle-shop-modal-button"),$("#toggle-krew-list-modal-button").removeClass("btn btn-md enabled toggle-krew-list-modal-button").addClass("btn btn-md disabled toggle-krew-list-modal-button")}),be.on("showAdinplayCentered",function(){Ut.showAdinplayCentered()}),be.on("departureWarning",function(){$("#toggle-krew-list-modal-button").hasClass("enabled")&&($("#toggle-krew-list-modal-button").addClass("glowing"),setTimeout(function(){$("#toggle-krew-list-modal-button").removeClass("glowing")},5e3))}),be.on("showCenterMessage",function(t,e,i){Ut&&Ut.showCenterMessage&&Ut.showCenterMessage(t,e||3,i),t.startsWith("Achievement trading")&&$("#shopping-modal").hide()}),be.on("showKillMessage",function(t){Ut&&Ut.showKillMessage&&Ut.showKillMessage(t)}),be.on("showDamageMessage",function(t,e){Ut&&Ut.showDamageMessage&&Ut.showDamageMessage(t,e)}),be.on("showAdminMessage",function(t){Ut&&Ut.showAdminMessage&&Ut.showAdminMessage(t)}),be.on("levelUpdate",function(t){void 0!==tt[t.id]&&0===tt[t.id].netType&&(tt[t.id].level=t.level,t.id===myPlayerId&&(Lt.updateExperience(),Lt.notifiscationHeap[Math.random().toString(36).substring(6,10)]={text:"Level Up!",type:2,isNew:!0}))}),be.on("clanMarker",function(t){var e=Math.random().toString(36).substring(6,10);Gt[e]=t}),void 0!==Ce&&(clearInterval(Ce),Ce=void 0),Ce=setInterval(function(){Lt&&(t=Lt.getDelta())&&be.emit("u",t)},100)}),be.on("chat message",function(t){if(Lt&&Lt.parent&&(Lt.parent.hasChild(t.playerId)||"global"===t.recipient||"local"===t.recipient||"clan"===t.recipient)&&void 0!==tt[t.playerId]){var e=1===Lt.parent.netType&&Lt.parent.hasChild(t.playerId),i=t.playerId===myPlayerId,o=""!==Lt.clan&&void 0!==Lt.clan&&Lt.clan===tt[t.playerId].clan&&!i,s=_e.includes(t.playerName),n=Te.includes(t.playerName),a=$("#chat-history"),r="global"===t.recipient?"global-chat":"local"===t.recipient?"local-chat":"clan-chat",l=$("<div/>",{text:(s?"[admin] ":n?"[mod] ":"")+t.playerName+": "+t.message,class:r+" text-"+(s||n?"mod-color":o?"clan-color":i||e?i?"success":tt[t.playerId].isCaptain?"danger":"info":"white")});messageTypes=["clan-chat","local-chat","global-chat"];for(var c=0;c<messageTypes.length;c++){var h=messageTypes[c];messageCount=$("."+h).length,15<messageCount&&$("."+h).first().remove()}"global"!==t.recipient||Ee||($("#global-chat-alert").show(),l.hide()),"local"!==t.recipient||xe||($("#local-chat-alert").show(),l.hide()),"clan"!==t.recipient||ke||($("#clan-chat-alert").show(),l.hide());var d=!1;$(a).scrollTop()+$(a).innerHeight()>=$(a)[0].scrollHeight&&(d=!0),a.append(l),!0===d&&a.scrollTop(function(){return this.scrollHeight})}})},Re=function(){var o={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,i){o[e]=i}),o},Ie=function(){for(e in tt)tt.hasOwnProperty(e)&&tt[e].onDestroy();tt={},Lt=void 0},Le=function(t,e,i,o){controls.unLockMouseLook(),$(".local-chat").remove(),$("#game-over-modal").modal("show"),Pe(t,e,i,o),Lt.state=1},Pe=function(t,e,i,o){$("#total-score").html(Dt),$("#total-damage").html(Dt),$("#total-gold-collected").html(t.toFixed(0)),$("#total-shots-fired").html(e),$("#total-shots-hit").html(i),$("#accuracy").html(Math.round(i/e*100)),$("#total-ships-sank").html(o),$("#supplies-cut").html((.3*t).toFixed(0)),$("#docking-modal").is(":visible")&&$("#docking-modal").hide()}}((window,document));
